<html><head><title>DW::User::Rename</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw " type="text/css" href="../../blkbluw_.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk " type="text/css" href="../../whtpurk_.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng " type="text/css" href="../../whtgrng_.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw " type="text/css" href="../../grygrnw_.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.13,
  using Pod::Simple::PullParser v3.13,
  under Perl v5.010001 at Wed Feb 27 00:00:03 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24self-%3Ecan_rename_to(_%24tousername_%5B%2C_%25opts_%5D_)'>$self-&#62;can_rename_to( $tousername [, %opts ] )</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Erename(_%24tousername%2C_token_%3D%3E_%24rename_token_obj_%5B%2C_%25opts%5D_)'>$self-&#62;rename( $tousername, token =&#62; $rename_token_obj [, %opts] )</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eswap_usernames(_%24touser_%5B%2C_%25opts_%5D_)'>$self-&#62;swap_usernames( $touser [, %opts ] )</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_clear_from_cache'>$self-&#62;_clear_from_cache</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_are_same_person'>$self-&#62;_are_same_person</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_is_authorized_for_comm'>$self-&#62;_is_authorized_for_comm</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_rename(_%24tousername%2C_%25opts_)'>$self-&#62;_rename( $tousername, %opts )</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eapply_rename_opts'>$self-&#62;apply_rename_opts</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Ebreak_redirects'>$self-&#62;break_redirects</a>
    <li class='indexItem indexItem2'><a href='#DW%3A%3AUser%3A%3ARename-%3Ecreate_redirect_journal'>DW::User::Rename-&#62;create_redirect_journal</a>
    <li class='indexItem indexItem2'><a href='#DW%3A%3AUser%3A%3ARename-%3Ebreak_email_redirection(_%24from_user%2C_%24to_user_)'>DW::User::Rename-&#62;break_email_redirection( $from_user, $to_user )</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Edelete_relationships'>$self-&#62;delete_relationships</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_rename_to_ex(_%24tousername_)'>$self-&#62;_rename_to_ex( $tousername )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DW::User::Rename - Contains logic to handle account renaming.
Based on bin/renameuser.pl,
from the LiveJournal code</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use DW::User::Rename;

  # on a user object
  my $u = LJ::load_user( &#34;exampleusername&#34; );
  if ( $u-&#62;can_rename_to( &#34;to_username&#34; ) ) {
    # print message, whatever...

    # do rename
    $u-&#62;rename( &#34;to_username&#34;, token =&#62; $token_object );

    # this user object retains old name
    # but all caches should have been cleared after the rename, so you can get
    # an updated copy of the user when you do LJ::load_userid
    $u = LJ::load_userid( $u-&#62;userid );
  }

  my $user_a = LJ::load_user( &#34;swap_a&#34; );
  my $user_b = LJ::load_user( &#34;swap_b&#34; );
  $user_a-&#62;swap_usernames( $user_b ) if $user_a-&#62;can_rename_to( $user_b-&#62;user );

  # can also force a rename, which doesn&#39;t take into consideration any of the 
  # safeguards. Only call this from an admin page:
  $u-&#62;rename( &#34;to_username&#34;, token =&#62; $token, force =&#62; 1 )</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;can_rename_to(_$tousername_[,_%opts_]_)"
><code>$self-&#62;can_rename_to( $tousername [, %opts ] )</code></a></h2>

<p>Return true if this user can be renamed to the given username</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;rename(_$tousername,_token_=&#62;_$rename_token_obj_[,_%opts]_)"
><code>$self-&#62;rename( $tousername, token =&#62; $rename_token_obj [, %opts] )</code></a></h2>

<p>Rename the given user to the provided username. Requires a user name to rename to, and a token object to store the rename action data. If the username we&#39;re returning to is of an existing user then it shall be moved aside to a username of the form &#34;ex_oldusernam123&#34;. Returns 1 on success, 0 on failure</p>

<p>Optional arguments are: =item force =&#62; bool, default false =item redirect =&#62; bool, default false =item errref =&#62; array ref of errors =item del_watched_by/del_trusted_by/del_trusted/del_watched/del_communities =&#62; bool, default false =item redirect_email =&#62; bool, default false (also forced to false if redirect is false)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;swap_usernames(_$touser_[,_%opts_]_)"
><code>$self-&#62;swap_usernames( $touser [, %opts ] )</code></a></h2>

<p>Swap the usernames of these two users.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_clear_from_cache"
><code>$self-&#62;_clear_from_cache</code></a></h2>

<p>Internal function to clear a user from various caches.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_are_same_person"
><code>$self-&#62;_are_same_person</code></a></h2>

<p>Internal function to determine whether two personal accounts are controlled by the same person</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_is_authorized_for_comm"
><code>$self-&#62;_is_authorized_for_comm</code></a></h2>

<p>Internal function to determine whether an account can control / manage another account</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_rename(_$tousername,_%opts_)"
><code>$self-&#62;_rename( $tousername, %opts )</code></a></h2>

<p>Internal function to do renames. Low-level, no error-checking on inputs. Only call this when you are sure that all conditions for a rename are satisfied. Returns 1 on success, 0 on failure.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;apply_rename_opts"
><code>$self-&#62;apply_rename_opts</code></a></h2>

<p>Apply the stated rename options. Will log.</p>

<p>Arguments are: =item from, original username (required) =item to, new username (required) =item user, user doing the work if separate from user being renamed, e.g., admin of a community (optional) =item redirect =&#62; hashref. (optional) If provided, will handle initial redirect information. If false, will leave as-is. =item del =&#62; hashref. (optional) If provided, will delete all relationships of the provided types. =item break_redirect =&#62; hashref. (optional) If provided, will break existing redirects</p>

<p>redirect/break_redirect hashref: =item username, bool, forward or disconnect username. Default disconnect =item email, bool, forward or disconnect email. Default disconnect</p>

<p>del hashref: =item del_trusted_by =item del_watched_by =item del_trusted =item del_watched =item del_communities</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;break_redirects"
><code>$self-&#62;break_redirects</code></a></h2>

<p>Break outgoing redirects.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DW::User::Rename-&#62;create_redirect_journal"
><code>DW::User::Rename-&#62;create_redirect_journal</code></a></h2>

<p>Set up a new user which will redirect to an existing one. Don&#39;t allow to set redirects for existing users.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DW::User::Rename-&#62;break_email_redirection(_$from_user,_$to_user_)"
><code>DW::User::Rename-&#62;break_email_redirection( $from_user, $to_user )</code></a></h2>

<p>Break email redirection from one user which redirects to another user</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;delete_relationships"
><code>$self-&#62;delete_relationships</code></a></h2>

<p>Delete a list of relationships. Returns a string representation of which relationships were deleted.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_rename_to_ex(_$tousername_)"
><code>$self-&#62;_rename_to_ex( $tousername )</code></a></h2>

<p>Internal function to do renames away from the current username. Low-level, no error-checking on inputs. Accepts a username, renames the user to a form of ex_oldusernam123.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Afuna &#60;coder.dw@afunamatata.com&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright (c) 2010 by Dreamwidth Studios, LLC.</p>

<p>This program is free software; you may redistribute it and/or modify it under the same terms as Perl itself. For a copy of the license, please reference &#39;perldoc perlartistic&#39; or &#39;perldoc perlgpl&#39;.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
