<html><head><title>DW::InviteCodes</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw " type="text/css" href="../blkbluw_.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk " type="text/css" href="../whtpurk_.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng " type="text/css" href="../whtgrng_.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw " type="text/css" href="../grygrnw_.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.13,
  using Pod::Simple::PullParser v3.13,
  under Perl v5.010001 at Tue Oct 25 14:03:59 2011 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24class-%3Egenerate(_%5B_count_%3D%3E_%24howmany%2C_%5D_owner_%3D%3E_%24forwho%2C_reason_%3D%3E_%24why'>$class-&#62;generate( [ count =&#62; $howmany, ] owner =&#62; $forwho, reason =&#62; $why</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Ecould_be_code(_string_%3D%3E_%24string_)'>$class-&#62;could_be_code( string =&#62; $string )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Echeck_code(_code_%3D%3E_%24invite_%5B%2C_userid_%3D%3E_%24recipient%5D_)'>$class-&#62;check_code( code =&#62; $invite [, userid =&#62; $recipient] )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Epaid_status(_code_%3D%3E_%24code_)'>$class-&#62;paid_status( code =&#62; $code )</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Euse_code(_user_%3D%3E_%24recipient_)'>$object-&#62;use_code( user =&#62; $recipient )</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Esend_code_(_%5B_email_%3D%3E_%24email_%5D_)'>$object-&#62;send_code ( [ email =&#62; $email ] )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Enew(_code_%3D%3E_%24invite_)'>$class-&#62;new( code =&#62; $invite )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eby_owner(_userid_%3D%3E_%24userid_)'>$class-&#62;by_owner( userid =&#62; $userid )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eby_owner_unused(_userid_%3D%3E_%24userid_)'>$class-&#62;by_owner_unused( userid =&#62; $userid )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eby_recipient(_userid_%3D%3E_%24userid_)'>$class-&#62;by_recipient( userid =&#62; $userid )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eunused_count(_user_%3D%3E_%24userid_)'>$class-&#62;unused_count( user =&#62; $userid )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eload_by(_%24field%2C_%24userid_)'>$class-&#62;load_by( $field, $userid )</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Ecode'>$object-&#62;code</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Eowner'>$object-&#62;owner</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Erecipient'>$object-&#62;recipient</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Ereason'>$object-&#62;reason</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Etimegenerate'>$object-&#62;timegenerate</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Etimesent'>$object-&#62;timesent</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Eemail'>$object-&#62;email</a>
    <li class='indexItem indexItem2'><a href='#%24object-%3Eis_used'>$object-&#62;is_used</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eencode(_%24acid%2C_%24auth_)'>$class-&#62;encode( $acid, $auth )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Edecode(_%24invite_)'>$class-&#62;decode( $invite )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eacid_encode(_%24num_)'>$class-&#62;acid_encode( $num )</a>
    <li class='indexItem indexItem2'><a href='#%24class-%3Eacid_decode(_%24acid_)'>$class-&#62;acid_decode( $acid )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DW::InviteCodes - Invite code management backend for Dreamwidth</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use DW::InviteCodes;

  # Reward the module authors
  my @ic = DW::InviteCodes-&#62;generate( owner =&#62; LJ::load_user(&#34;system&#34;),
                                      count =&#62; 2,
                                      reason =&#62; &#34;For DW::InviteCodes authors&#34; );

  # Check whether a code is valid
  my $valid = DW::InviteCodes-&#62;check_code( code =&#62; $code [, userid =&#62; $recipient] );

  # Retrieve DW::InviteCodes object(s) by code, owner (all or just unused), or recipient
  # (note: these return objects, not strings)
  my $object = DW::InviteCodes-&#62;new( code =&#62; $invite );
  my @owned = DW::InviteCodes-&#62;by_owner( userid =&#62; $userid );
  my @unused = DW::InviteCodes-&#62;by_owner_unused( userid =&#62; $userid);
  my @used = DW::InviteCodes-&#62;by_recipient( userid =&#62; $userid );

  # Retrieve a count of all invite codes
  my $count = DW::InviteCodes-&#62;unused_count( userid =&#62; $userid );

  # Access object data
  my $invite = $object-&#62;code;
  my $owner = $object-&#62;owner; # userid, not LJ::User object
  my $recipient = $object-&#62;recipient; # userid or 0
  my $reason = $object-&#62;reason;
  my $email = $object-&#62;email;
  my $timegenerate = $object-&#62;timegenerate; # unix timestamp
  my $timesent = $object-&#62;timesent; #unix timestamp
  my $is_used = $object-&#62;is_used; # true if used to create an account

  # Mark the invite code as sent
  $code-&#62;send_code( email =&#62; $email );

  # Mark the invite code as used
  $code-&#62;use_code( user =&#62; LJ::load_user(&#39;new&#39;) );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;generate(_[_count_=&#62;_$howmany,_]_owner_=&#62;_$forwho,_reason_=&#62;_$why"
><code>$class-&#62;generate( [ count =&#62; $howmany, ] owner =&#62; $forwho, reason =&#62; $why</code></a></h2>

<p>Generates $howmany invite codes (default 1) and sets their reason to $why and owner to $forwho.</p>

<p>If owner is undef, the codes will be &#39;system codes&#39; and have no source.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;could_be_code(_string_=&#62;_$string_)"
><code>$class-&#62;could_be_code( string =&#62; $string )</code></a></h2>

<p>Checks whether $string could possibly be a code. It makes sure that it only contains DIGITS and is CODE_LEN long.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;check_code(_code_=&#62;_$invite_[,_userid_=&#62;_$recipient]_)"
><code>$class-&#62;check_code( code =&#62; $invite [, userid =&#62; $recipient] )</code></a></h2>

<p>Checks whether code $invite is valid before trying to create an account. Takes an optional $recipient userid, to protect the code from accidentally being used if the form is double-submitted.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;paid_status(_code_=&#62;_$code_)"
><code>$class-&#62;paid_status( code =&#62; $code )</code></a></h2>

<p>Checks whether this code comes loaded with a paid account. Returns a DW::Shop::Item::Account if yes; undef if not</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;use_code(_user_=&#62;_$recipient_)"
><code>$object-&#62;use_code( user =&#62; $recipient )</code></a></h2>

<p>Marks an invite code as having been used to create the $recipient account.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;send_code_(_[_email_=&#62;_$email_]_)"
><code>$object-&#62;send_code ( [ email =&#62; $email ] )</code></a></h2>

<p>Marks an invite code as having been sent. The code may or may not have been used to create a new account. Make sure if passing email to validate first!</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;new(_code_=&#62;_$invite_)"
><code>$class-&#62;new( code =&#62; $invite )</code></a></h2>

<p>Returns object for invite, or undef if none exists.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;by_owner(_userid_=&#62;_$userid_)"
><code>$class-&#62;by_owner( userid =&#62; $userid )</code></a></h2>

<p>Returns (as objects) the list of all invite codes generated by (or on behalf of) $userid.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;by_owner_unused(_userid_=&#62;_$userid_)"
><code>$class-&#62;by_owner_unused( userid =&#62; $userid )</code></a></h2>

<p>Returns (as objects) the list of all unused invite codes generated by (or on behalf of) $userid.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;by_recipient(_userid_=&#62;_$userid_)"
><code>$class-&#62;by_recipient( userid =&#62; $userid )</code></a></h2>

<p>Returns (as objects) the list of all invite codes used by $userid. (This will normally be a singleton, but the table declaration doesn&#39;t make that key unique, so going for safety.)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;unused_count(_user_=&#62;_$userid_)"
><code>$class-&#62;unused_count( user =&#62; $userid )</code></a></h2>

<p>Returns a count of unused invite codes owned by $userid.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;load_by(_$field,_$userid_)"
><code>$class-&#62;load_by( $field, $userid )</code></a></h2>

<p>Internal. Loads all invite codes with $field (that should be one of the userid fields) set to $userid. Note: this has protection against most SQL injection attempts, but is not guaranteed to be 100% safe. Caller should take care not to pass externally generated values in $field.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;code"
><code>$object-&#62;code</code></a></h2>

<p>Returns the object&#39;s invite code.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;owner"
><code>$object-&#62;owner</code></a></h2>

<p>Returns the object&#39;s owner (userid, not LJ::User object).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;recipient"
><code>$object-&#62;recipient</code></a></h2>

<p>Returns the object&#39;s recipient (userid or 0).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;reason"
><code>$object-&#62;reason</code></a></h2>

<p>Returns the object&#39;s reason for creation.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;timegenerate"
><code>$object-&#62;timegenerate</code></a></h2>

<p>Returns the object&#39;s generated date and time as a unix timestamp.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;timesent"
><code>$object-&#62;timesent</code></a></h2>

<p>Returns the date and time the invite code was sent through the interface, as a unix timestamp. The code may or may not have been used since.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;email"
><code>$object-&#62;email</code></a></h2>

<p>Returns the email address the invite code was sent to through the interface. The code may or may not have been used since.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$object-&#62;is_used"
><code>$object-&#62;is_used</code></a></h2>

<p>Returns true if the object was used to create an account, false otherwise.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;encode(_$acid,_$auth_)"
><code>$class-&#62;encode( $acid, $auth )</code></a></h2>

<p>Internal. Given an invite code id and a 13-digit auth code, returns a 20-digit all-uppercase invite code.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;decode(_$invite_)"
><code>$class-&#62;decode( $invite )</code></a></h2>

<p>Internal. Given an invite code, break it down into its component parts: an invite code id and a 13-character auth code.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;acid_encode(_$num_)"
><code>$class-&#62;acid_encode( $num )</code></a></h2>

<p>Internal. Converts a 32-bit unsigned integer into a fixed-width string representation in base DIGITS_LEN, based on an alphabet of letters and numbers that are not easily mistaken for each other.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$class-&#62;acid_decode(_$acid_)"
><code>$class-&#62;acid_decode( $acid )</code></a></h2>

<p>Internal. Given an acid encoding from <code>DW::InviteCodes::acid_encode</code>, returns the original decimal number.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>Bound to be some.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Afuna &#60;coder.dw@afunamatata.com&#62;</p>

<p>Pau Amma &#60;pauamma@dreamwidth.org&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright (c) 2009 by Dreamwidth Studios, LLC.</p>

<p>This program is free software; you may redistribute it and/or modify it under the same terms as Perl itself. For a copy of the license, please reference &#39;perldoc perlartistic&#39; or &#39;perldoc perlgpl&#39;.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
