<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: cgi-bin/weblib.pl</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">cgi-bin/weblib.pl</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">1.4%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#!/usr/bin/perl</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">3</td><td colspan="7"></td></tr><tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ;</td></tr>
<tr><td class="h">5</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L5">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">6</td><td colspan="7"></td></tr><tr><td class="h">7</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L7">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use lib &quot;$LJ::HOME/cgi-bin&quot;;</td></tr>
<tr><td class="h">8</td><td colspan="7"></td></tr><tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># load the bread crumb hash</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">require &quot;crumbs.pl&quot;;</td></tr>
<tr><td class="h">11</td><td colspan="7"></td></tr><tr><td class="h">12</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L12">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use Carp;</td></tr>
<tr><td class="h">13</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L13">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use DW::Request;</td></tr>
<tr><td class="h">14</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L14">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::Event;</td></tr>
<tr><td class="h">15</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L15">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::Subscription::Pending;</td></tr>
<tr><td class="h">16</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L16">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::M::ProfilePage;</td></tr>
<tr><td class="h">17</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L17">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::Directory::Search;</td></tr>
<tr><td class="h">18</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L18">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::Directory::Constraint;</td></tr>
<tr><td class="h">19</td><td><div class="c3">5</div><div class="c3">5</div><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-weblib-pl--subroutine.html#L19">5</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use LJ::M::FriendsOf;</td></tr>
<tr><td class="h">20</td><td colspan="7"></td></tr><tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::img</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns an HTML &amp;lt;img&amp;gt; or &amp;lt;input&amp;gt; tag to an named image</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      code, which each site may define with a different image file with</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      its own dimensions.  This prevents hard-coding filenames &amp; sizes</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      into the source.  The real image data is stored in LJ::Img, which</td></tr>
<tr><td class="h">27</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      has default values provided in cgi-bin/imageconf.pl but can be</td></tr>
<tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      overridden in etc/ljconfig.pl.</td></tr>
<tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: imagecode, type?, attrs?</td></tr>
<tr><td class="h">30</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-imagecode: The unique string key to reference the image.  Not a filename,</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#                but the purpose or location of the image.</td></tr>
<tr><td class="h">32</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-type: By default, the tag returned is an &amp;lt;img&amp;gt; tag, but if &#39;type&#39;</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           is &quot;input&quot;, then an input tag is returned.</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-attrs: Optional hashref of other attributes.  If this isn&#39;t a hashref,</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#            then it&#39;s assumed to be a scalar for the &#39;name&#39; attribute for</td></tr>
<tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#            input controls.</td></tr>
<tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub img</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">40</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L40">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ic = shift;</td></tr>
<tr><td class="h">41</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $type = shift;  # either &quot;&quot; or &quot;input&quot;</td></tr>
<tr><td class="h">42</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $attr = shift;</td></tr>
<tr><td class="h">43</td><td colspan="7"></td></tr><tr><td class="h">44</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $attrs;</td></tr>
<tr><td class="h">45</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $alt;</td></tr>
<tr><td class="h">46</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L46">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($attr) {</td></tr>
<tr><td class="h">47</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L47">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ref $attr eq &quot;HASH&quot;) {</td></tr>
<tr><td class="h">48</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L48">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$alt = LJ::ehtml($attr-&gt;{alt}) if (exists $attr-&gt;{alt});</td></tr>
<tr><td class="h">49</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (keys %$attr) {</td></tr>
<tr><td class="h">50</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L50">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs .= &quot; $_=\&quot;&quot; . LJ::ehtml($attr-&gt;{$_}) . &quot;\&quot;&quot;</td></tr>
<tr><td class="h">51</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ((lc $_) eq &#39;alt&#39;);</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">54</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attrs = &quot; name=\&quot;$attr\&quot;&quot;;</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">57</td><td colspan="7"></td></tr><tr><td class="h">58</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $i = $LJ::Img::img{$ic};</td></tr>
<tr><td class="h">59</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L59">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L59">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$alt ||= LJ::Lang::string_exists($i-&gt;{&#39;alt&#39;}) ? LJ::Lang::ml($i-&gt;{&#39;alt&#39;}) : $i-&gt;{&#39;alt&#39;};</td></tr>
<tr><td class="h">60</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L60">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($type eq &quot;&quot;) {</td></tr>
<tr><td class="h">61</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;img src=\&quot;$LJ::IMGPREFIX$i-&gt;{&#39;src&#39;}\&quot; width=\&quot;$i-&gt;{&#39;width&#39;}\&quot; &quot;.</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;height=\&quot;$i-&gt;{&#39;height&#39;}\&quot; alt=\&quot;$alt\&quot; title=\&quot;$alt\&quot; &quot;.</td></tr>
<tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;border=&#39;0&#39;$attrs /&gt;&quot;;</td></tr>
<tr><td class="h">64</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">65</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L65">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($type eq &quot;input&quot;) {</td></tr>
<tr><td class="h">66</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;input type=\&quot;image\&quot; src=\&quot;$LJ::IMGPREFIX$i-&gt;{&#39;src&#39;}\&quot; &quot;.</td></tr>
<tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;width=\&quot;$i-&gt;{&#39;width&#39;}\&quot; height=\&quot;$i-&gt;{&#39;height&#39;}\&quot; title=\&quot;$alt\&quot; &quot;.</td></tr>
<tr><td class="h">68</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;alt=\&quot;$alt\&quot; border=&#39;0&#39;$attrs /&gt;&quot;;</td></tr>
<tr><td class="h">69</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">70</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;b&gt;XXX&lt;/b&gt;&quot;;</td></tr>
<tr><td class="h">71</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">74</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::date_to_view_links</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: component</td></tr>
<tr><td class="h">76</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns HTML of date with links to user&#39;s journal.</td></tr>
<tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: u, date</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-date: date in yyyy-mm-dd form.</td></tr>
<tr><td class="h">79</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: HTML with yyyy, mm, and dd all links to respective views.</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub date_to_view_links</td></tr>
<tr><td class="h">82</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">83</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L83">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($u, $date) = @_;</td></tr>
<tr><td class="h">84</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L84">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $date =~ /^(\d\d\d\d)-(\d\d)-(\d\d)/;</td></tr>
<tr><td class="h">85</td><td colspan="7"></td></tr><tr><td class="h">86</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($y, $m, $d) = ($1, $2, $3);</td></tr>
<tr><td class="h">87</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($nm, $nd) = ($m+0, $d+0);   # numeric, without leading zeros</td></tr>
<tr><td class="h">88</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = $u-&gt;{&#39;user&#39;};</td></tr>
<tr><td class="h">89</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $base = LJ::journal_base($u);</td></tr>
<tr><td class="h">90</td><td colspan="7"></td></tr><tr><td class="h">91</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">92</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;a href=\&quot;$base/$y/\&quot;&gt;$y&lt;/a&gt;-&quot;;</td></tr>
<tr><td class="h">93</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;a href=\&quot;$base/$y/$m/\&quot;&gt;$m&lt;/a&gt;-&quot;;</td></tr>
<tr><td class="h">94</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;a href=\&quot;$base/$y/$m/$d/\&quot;&gt;$d&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">95</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">96</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">97</td><td colspan="7"></td></tr><tr><td class="h">98</td><td colspan="7"></td></tr><tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::auto_linkify</td></tr>
<tr><td class="h">101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Takes a plain-text string and changes URLs into &lt;a href&gt; tags (auto-linkification).</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: str</td></tr>
<tr><td class="h">103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-str: The string to perform auto-linkification on.</td></tr>
<tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: The auto-linkified text.</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub auto_linkify</td></tr>
<tr><td class="h">107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">108</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L108">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $str = shift;</td></tr>
<tr><td class="h">109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $match = sub {</td></tr>
<tr><td class="h">110</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L110">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $str = shift;</td></tr>
<tr><td class="h">111</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L111">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($str =~ /^(.*?)(&amp;(#39|quot|lt|gt)(;.*)?)$/) {</td></tr>
<tr><td class="h">112</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;a href=&#39;$1&#39;&gt;$1&lt;/a&gt;$2&quot;;</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">114</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;a href=&#39;$str&#39;&gt;$str&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">116</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">117</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$str =~ s!https?://[^\s\&#39;\&quot;\&lt;\&gt;]+[a-zA-Z0-9_/&amp;=\-]! $match-&gt;($&amp;); !ge;</td></tr>
<tr><td class="h">118</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $str;</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">120</td><td colspan="7"></td></tr><tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return 1 if URL is a safe stylesheet that S1/S2/etc can pull in.</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return 0 to reject the link tag</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return a URL to rewrite the stylesheet URL</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># $href will always be present.  $host and $path may not.</td></tr>
<tr><td class="h">125</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub valid_stylesheet_url {</td></tr>
<tr><td class="h">126</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L126">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($href, $host, $path) = @_;</td></tr>
<tr><td class="h">127</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L127">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L127">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($host &amp;&amp; $path) {</td></tr>
<tr><td class="h">128</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L128">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $href =~ m!^https?://([^/]+?)(/.*)$!;</td></tr>
<tr><td class="h">129</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($host, $path) = ($1, $2);</td></tr>
<tr><td class="h">130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">131</td><td colspan="7"></td></tr><tr><td class="h">132</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cleanit = sub {</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# allow tag, if we&#39;re doing no css cleaning</td></tr>
<tr><td class="h">134</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L134">0</a></div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L134">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 1 unless LJ::is_enabled(&#39;css_cleaner&#39;);</td></tr>
<tr><td class="h">135</td><td colspan="7"></td></tr><tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# remove tag, if we have no CSSPROXY configured</td></tr>
<tr><td class="h">137</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L137">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $LJ::CSSPROXY;</td></tr>
<tr><td class="h">138</td><td colspan="7"></td></tr><tr><td class="h">139</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# rewrite tag for CSS cleaning</td></tr>
<tr><td class="h">140</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$LJ::CSSPROXY?u=&quot; . LJ::eurl($href);</td></tr>
<tr><td class="h">141</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">142</td><td colspan="7"></td></tr><tr><td class="h">143</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L143">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $LJ::TRUSTED_CSS_HOST{$host};</td></tr>
<tr><td class="h">144</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L144">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $cleanit-&gt;() unless $host =~ /\Q$LJ::DOMAIN\E$/i;</td></tr>
<tr><td class="h">145</td><td colspan="7"></td></tr><tr><td class="h">146</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# let users use system stylesheets.</td></tr>
<tr><td class="h">147</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L147">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L147">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $host eq $LJ::DOMAIN || $host eq $LJ::DOMAIN_WEB ||</td></tr>
<tr><td class="h">148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$href =~ /^\Q$LJ::STATPREFIX\E/;</td></tr>
<tr><td class="h">149</td><td colspan="7"></td></tr><tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# S2 stylesheets:</td></tr>
<tr><td class="h">151</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L151">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $path =~ m!^(/\w+)?/res/(\d+)/stylesheet(\?\d+)?$!;</td></tr>
<tr><td class="h">152</td><td colspan="7"></td></tr><tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# unknown, reject.</td></tr>
<tr><td class="h">154</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $cleanit-&gt;();</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">156</td><td colspan="7"></td></tr><tr><td class="h">157</td><td colspan="7"></td></tr><tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::make_authas_select</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Given a u object and some options, determines which users the given user</td></tr>
<tr><td class="h">161</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      can switch to.  If the list exists, returns a select list and a submit</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      button with labels.  Otherwise returns a hidden element.</td></tr>
<tr><td class="h">163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: string of HTML elements</td></tr>
<tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: u, opts?</td></tr>
<tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-opts: Optional.  Valid keys are:</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;authas&#39; - current user, gets selected in drop-down;</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;label&#39; - label to go before form elements;</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;button&#39; - button label for submit button;</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           others - arguments to pass to [func[LJ::get_authas_list]].</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_authas_select {</td></tr>
<tr><td class="h">172</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L172">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($u, $opts) = @_; # type, authas, label, button</td></tr>
<tr><td class="h">173</td><td colspan="7"></td></tr><tr><td class="h">174</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = LJ::get_authas_list($u, $opts);</td></tr>
<tr><td class="h">175</td><td colspan="7"></td></tr><tr><td class="h">176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# only do most of form if there are options to select from</td></tr>
<tr><td class="h">177</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L177">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L177">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@list &gt; 1 || $list[0] ne $u-&gt;{&#39;user&#39;}) {</td></tr>
<tr><td class="h">178</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $label = $BML::ML{&#39;web.authas.label&#39;};</td></tr>
<tr><td class="h">180</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L180">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$label = $BML::ML{&#39;web.authas.label.comm&#39;} if ($opts-&gt;{&#39;type&#39;} eq &quot;C&quot;);</td></tr>
<tr><td class="h">181</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L181">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret = ($opts-&gt;{&#39;label&#39;} || $label) . &quot; &quot;;</td></tr>
<tr><td class="h">182</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_select({ &#39;name&#39; =&gt; &#39;authas&#39;,</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $opts-&gt;{&#39;authas&#39;} || $u-&gt;{&#39;user&#39;},</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39; =&gt; &#39;hideable&#39;,</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">186</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L186">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { $_, $_ } @list) . &quot; &quot;;</td></tr>
<tr><td class="h">187</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L187">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_submit(undef, $opts-&gt;{&#39;button&#39;} || $BML::ML{&#39;web.authas.btn&#39;});</td></tr>
<tr><td class="h">188</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">190</td><td colspan="7"></td></tr><tr><td class="h">191</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# no communities to choose from, give the caller a hidden</td></tr>
<tr><td class="h">192</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L192">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return  LJ::html_hidden(&#39;authas&#39;, $opts-&gt;{&#39;authas&#39;} || $u-&gt;{&#39;user&#39;});</td></tr>
<tr><td class="h">193</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">194</td><td colspan="7"></td></tr><tr><td class="h">195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">196</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::make_postto_select</td></tr>
<tr><td class="h">197</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Given a u object and some options, determines which users the given user</td></tr>
<tr><td class="h">198</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      can post to.  If the list exists, returns a select list and a submit</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      button with labels.  Otherwise returns a hidden element.</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: string of HTML elements</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: u, opts?</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-opts: Optional.  Valid keys are:</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;postto&#39; - current user, gets selected in drop-down;</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;label&#39; - label to go before form elements;</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           &#39;button&#39; - button label for submit button;</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           others - arguments to pass to [func[LJ::get_postto_list]].</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_postto_select {</td></tr>
<tr><td class="h">209</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L209">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($u, $opts) = @_; # type, authas, label, button</td></tr>
<tr><td class="h">210</td><td colspan="7"></td></tr><tr><td class="h">211</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list = LJ::get_postto_list($u, $opts);</td></tr>
<tr><td class="h">212</td><td colspan="7"></td></tr><tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# only do most of form if there are options to select from</td></tr>
<tr><td class="h">214</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L214">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@list &gt; 1) {</td></tr>
<tr><td class="h">215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return ($opts-&gt;{&#39;label&#39;} || $BML::ML{&#39;web.postto.label&#39;}) . &quot; &quot; .</td></tr>
<tr><td class="h">216</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::html_select({ &#39;name&#39; =&gt; &#39;authas&#39;,</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $opts-&gt;{&#39;authas&#39;} || $u-&gt;{&#39;user&#39;}},</td></tr>
<tr><td class="h">218</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L218">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L218">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L218">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { $_, $_ } @list) . &quot; &quot; .</td></tr>
<tr><td class="h">219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::html_submit(undef, $opts-&gt;{&#39;button&#39;} || $BML::ML{&#39;web.postto.btn&#39;});</td></tr>
<tr><td class="h">220</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">221</td><td colspan="7"></td></tr><tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# no communities to choose from, give the caller a hidden</td></tr>
<tr><td class="h">223</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L223">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return  LJ::html_hidden(&#39;authas&#39;, $opts-&gt;{&#39;authas&#39;} || $u-&gt;{&#39;user&#39;});</td></tr>
<tr><td class="h">224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">225</td><td colspan="7"></td></tr><tr><td class="h">226</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">227</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::help_icon</td></tr>
<tr><td class="h">228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns BML to show a help link/icon given a help topic, or nothing</td></tr>
<tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      if the site hasn&#39;t defined a URL for that topic.  Optional arguments</td></tr>
<tr><td class="h">230</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      include HTML/BML to place before and after the link/icon, should it</td></tr>
<tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      be returned.</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: topic, pre?, post?</td></tr>
<tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-topic: Help topic key.</td></tr>
<tr><td class="h">234</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#            See doc/ljconfig.pl.txt, or [special[helpurls]] for examples.</td></tr>
<tr><td class="h">235</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-pre: HTML/BML to place before the help icon.</td></tr>
<tr><td class="h">236</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-post: HTML/BML to place after the help icon.</td></tr>
<tr><td class="h">237</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">238</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub help_icon</td></tr>
<tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">240</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L240">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = shift;</td></tr>
<tr><td class="h">241</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pre = shift;</td></tr>
<tr><td class="h">242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $post = shift;</td></tr>
<tr><td class="h">243</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L243">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&quot; unless (defined $LJ::HELPURL{$topic});</td></tr>
<tr><td class="h">244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$pre&lt;?help $LJ::HELPURL{$topic} help?&gt;$post&quot;;</td></tr>
<tr><td class="h">245</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">246</td><td colspan="7"></td></tr><tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># like help_icon, but no BML.</td></tr>
<tr><td class="h">248</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub help_icon_html {</td></tr>
<tr><td class="h">249</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L249">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $topic = shift;</td></tr>
<tr><td class="h">250</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L250">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $url = $LJ::HELPURL{$topic} or return &quot;&quot;;</td></tr>
<tr><td class="h">251</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L251">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pre = shift || &quot;&quot;;</td></tr>
<tr><td class="h">252</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L252">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $post = shift || &quot;&quot;;</td></tr>
<tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: use LJ::img() here, not hard-coding width/height</td></tr>
<tr><td class="h">254</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$pre&lt;a href=\&quot;$url\&quot; class=\&quot;helplink\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;$LJ::IMGPREFIX/silk/site/help.png\&quot; alt=\&quot;Help\&quot; title=\&quot;Help\&quot; width=&#39;14&#39; height=&#39;14&#39; border=&#39;0&#39; /&gt;&lt;/a&gt;$post&quot;;</td></tr>
<tr><td class="h">255</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">256</td><td colspan="7"></td></tr><tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">258</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::bad_input</td></tr>
<tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns common BML for reporting form validation errors in</td></tr>
<tr><td class="h">260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      a bulleted list.</td></tr>
<tr><td class="h">261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: BML showing errors.</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: error*</td></tr>
<tr><td class="h">263</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-error: A list of errors</td></tr>
<tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub bad_input</td></tr>
<tr><td class="h">266</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">267</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L267">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @errors = @_;</td></tr>
<tr><td class="h">268</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;&quot;;</td></tr>
<tr><td class="h">269</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;?badcontent?&gt;\n&lt;ul&gt;\n&quot;;</td></tr>
<tr><td class="h">270</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $ei (@errors) {</td></tr>
<tr><td class="h">271</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L271">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $err  = LJ::errobj($ei) or next;</td></tr>
<tr><td class="h">272</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err-&gt;log;</td></tr>
<tr><td class="h">273</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $err-&gt;as_bullets;</td></tr>
<tr><td class="h">274</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">275</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/ul&gt;\n&quot;;</td></tr>
<tr><td class="h">276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">277</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">278</td><td colspan="7"></td></tr><tr><td class="h">279</td><td colspan="7"></td></tr><tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::error_list</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns an error bar with bulleted list of errors.</td></tr>
<tr><td class="h">283</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: BML showing errors.</td></tr>
<tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: error*</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-error: A list of errors</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">287</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub error_list</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">289</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: retrofit like bad_input above?  merge?  make aliases for each other?</td></tr>
<tr><td class="h">290</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L290">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @errors = @_;</td></tr>
<tr><td class="h">291</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">292</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;?errorbar &quot;;</td></tr>
<tr><td class="h">293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;strong&gt;&quot;;</td></tr>
<tr><td class="h">294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= BML::ml(&#39;error.procrequest&#39;);</td></tr>
<tr><td class="h">295</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/strong&gt;&lt;ul&gt;&quot;;</td></tr>
<tr><td class="h">296</td><td colspan="7"></td></tr><tr><td class="h">297</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $ei (@errors) {</td></tr>
<tr><td class="h">298</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L298">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $err  = LJ::errobj($ei) or next;</td></tr>
<tr><td class="h">299</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$err-&gt;log;</td></tr>
<tr><td class="h">300</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $err-&gt;as_bullets;</td></tr>
<tr><td class="h">301</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">302</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot; &lt;/ul&gt; errorbar?&gt;&quot;;</td></tr>
<tr><td class="h">303</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">305</td><td colspan="7"></td></tr><tr><td class="h">306</td><td colspan="7"></td></tr><tr><td class="h">307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">308</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::error_noremote</td></tr>
<tr><td class="h">309</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns an error telling the user to log in.</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: Translation string &quot;error.notloggedin&quot;</td></tr>
<tr><td class="h">311</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub error_noremote</td></tr>
<tr><td class="h">313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">314</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L314">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;?needlogin?&gt;&quot;;</td></tr>
<tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">316</td><td colspan="7"></td></tr><tr><td class="h">317</td><td colspan="7"></td></tr><tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::warning_list</td></tr>
<tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns a warning bar with bulleted list of warnings.</td></tr>
<tr><td class="h">321</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: BML showing warnings</td></tr>
<tr><td class="h">322</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: warnings*</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-warnings: A list of warnings</td></tr>
<tr><td class="h">324</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">325</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub warning_list</td></tr>
<tr><td class="h">326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">327</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L327">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @warnings = @_;</td></tr>
<tr><td class="h">328</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">329</td><td colspan="7"></td></tr><tr><td class="h">330</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;?warningbar &quot;;</td></tr>
<tr><td class="h">331</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;strong&gt;&quot;;</td></tr>
<tr><td class="h">332</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= BML::ml(&#39;label.warning&#39;);</td></tr>
<tr><td class="h">333</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/strong&gt;&lt;ul&gt;&quot;;</td></tr>
<tr><td class="h">334</td><td colspan="7"></td></tr><tr><td class="h">335</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach (@warnings) {</td></tr>
<tr><td class="h">336</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;li&gt;$_&lt;/li&gt;&quot;;</td></tr>
<tr><td class="h">337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">338</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot; &lt;/ul&gt; warningbar?&gt;&quot;;</td></tr>
<tr><td class="h">339</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">340</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">341</td><td colspan="7"></td></tr><tr><td class="h">342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tosagree_widget {</td></tr>
<tr><td class="h">343</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L343">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($checked, $errstr) = @_;</td></tr>
<tr><td class="h">344</td><td colspan="7"></td></tr><tr><td class="h">345</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return</td></tr>
<tr><td class="h">346</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L346">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;div class=&#39;formitemDesc&#39;&gt;&quot; .</td></tr>
<tr><td class="h">347</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BML::ml(&#39;tos.mustread&#39;,</td></tr>
<tr><td class="h">348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ aopts =&gt; &quot;target=&#39;_new&#39; href=&#39;$LJ::SITEROOT/legal/tos&#39;&quot; }) .</td></tr>
<tr><td class="h">349</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;/div&gt;&quot; .</td></tr>
<tr><td class="h">350</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;iframe width=&#39;684&#39; height=&#39;300&#39; src=&#39;/legal/tos-mini&#39; &quot; .</td></tr>
<tr><td class="h">351</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;style=&#39;border: 1px solid gray;&#39;&gt;&lt;/iframe&gt;&quot; .</td></tr>
<tr><td class="h">352</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;div&gt;&quot; . LJ::html_check({ name =&gt; &#39;agree_tos&#39;, id =&gt; &#39;agree_tos&#39;,</td></tr>
<tr><td class="h">353</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; &#39;1&#39;, selected =&gt;  $checked }) .</td></tr>
<tr><td class="h">354</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;label for=&#39;agree_tos&#39;&gt;&quot; . BML::ml(&#39;tos.haveread&#39;) . &quot;&lt;/label&gt;&lt;/div&gt;&quot; .</td></tr>
<tr><td class="h">355</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($errstr ? &quot;&lt;?inerr $errstr inerr?&gt;&quot; : &#39;&#39;);</td></tr>
<tr><td class="h">356</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">357</td><td colspan="7"></td></tr><tr><td class="h">358</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tosagree_html {</td></tr>
<tr><td class="h">359</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L359">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $domain = shift;</td></tr>
<tr><td class="h">360</td><td colspan="7"></td></tr><tr><td class="h">361</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;&lt;?h1 $LJ::REQUIRED_TOS{title} h1?&gt;&quot;;</td></tr>
<tr><td class="h">362</td><td colspan="7"></td></tr><tr><td class="h">363</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $html_str = LJ::tosagree_str($domain =&gt; &#39;html&#39;);</td></tr>
<tr><td class="h">364</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L364">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;?p $html_str p?&gt;&quot; if $html_str;</td></tr>
<tr><td class="h">365</td><td colspan="7"></td></tr><tr><td class="h">366</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;div style=&#39;margin-left: 40px; margin-bottom: 20px;&#39;&gt;&quot;;</td></tr>
<tr><td class="h">367</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::tosagree_widget(@_);</td></tr>
<tr><td class="h">368</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">369</td><td colspan="7"></td></tr><tr><td class="h">370</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">371</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">372</td><td colspan="7"></td></tr><tr><td class="h">373</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tosagree_str {</td></tr>
<tr><td class="h">374</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L374">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($domain, $key) = @_;</td></tr>
<tr><td class="h">375</td><td colspan="7"></td></tr><tr><td class="h">376</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L376">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L376">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ref $LJ::REQUIRED_TOS{$domain} &amp;&amp; $LJ::REQUIRED_TOS{$domain}-&gt;{$key} ?</td></tr>
<tr><td class="h">377</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$LJ::REQUIRED_TOS{$domain}-&gt;{$key} : $LJ::REQUIRED_TOS{$key};</td></tr>
<tr><td class="h">378</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">379</td><td colspan="7"></td></tr><tr><td class="h">380</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">381</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::did_post</td></tr>
<tr><td class="h">382</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Cookies should only show pages which make no action.</td></tr>
<tr><td class="h">383</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      When an action is being made, check the request coming</td></tr>
<tr><td class="h">384</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      from the remote user is a POST request.</td></tr>
<tr><td class="h">385</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># info: When web pages are using cookie authentication, you can&#39;t just trust that</td></tr>
<tr><td class="h">386</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       the remote user wants to do the action they&#39;re requesting.  It&#39;s way too</td></tr>
<tr><td class="h">387</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       easy for people to force other people into making GET requests to</td></tr>
<tr><td class="h">388</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       a server.  What if a user requested http://server/delete_all_journal.bml,</td></tr>
<tr><td class="h">389</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       and that URL checked the remote user and immediately deleted the whole</td></tr>
<tr><td class="h">390</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       journal?  Now anybody has to do is embed that address in an image</td></tr>
<tr><td class="h">391</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       tag and a lot of people&#39;s journals will be deleted without them knowing.</td></tr>
<tr><td class="h">392</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       Cookies should only show pages which make no action.  When an action is</td></tr>
<tr><td class="h">393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#       being made, check that it&#39;s a POST request.</td></tr>
<tr><td class="h">394</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: true if REQUEST_METHOD == &quot;POST&quot;</td></tr>
<tr><td class="h">395</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">396</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub did_post</td></tr>
<tr><td class="h">397</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">398</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L398">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return (BML::get_method() eq &quot;POST&quot;);</td></tr>
<tr><td class="h">399</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">400</td><td colspan="7"></td></tr><tr><td class="h">401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::robot_meta_tags</td></tr>
<tr><td class="h">403</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns meta tags to instruct a robot/crawler to not index or follow links.</td></tr>
<tr><td class="h">404</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: A string with appropriate meta tags</td></tr>
<tr><td class="h">405</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">406</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub robot_meta_tags</td></tr>
<tr><td class="h">407</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">408</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L408">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;meta name=\&quot;robots\&quot; content=\&quot;noindex, nofollow, noarchive\&quot; /&gt;\n&quot; .</td></tr>
<tr><td class="h">409</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;meta name=\&quot;googlebot\&quot; content=\&quot;noindex, nofollow, noarchive, nosnippet\&quot; /&gt;\n&quot;;</td></tr>
<tr><td class="h">410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">411</td><td colspan="7"></td></tr><tr><td class="h">412</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub paging_bar</td></tr>
<tr><td class="h">413</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">414</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L414">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($page, $pages, $opts) = @_;</td></tr>
<tr><td class="h">415</td><td colspan="7"></td></tr><tr><td class="h">416</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self_link = $opts-&gt;{&#39;self_link&#39;} ||</td></tr>
<tr><td class="h">417</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L417">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L417">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub { BML::self_link({ &#39;page&#39; =&gt; $_[0] }) };</td></tr>
<tr><td class="h">418</td><td colspan="7"></td></tr><tr><td class="h">419</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L419">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L419">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $href_opts = $opts-&gt;{&#39;href_opts&#39;} || sub { &#39;&#39; };</td></tr>
<tr><td class="h">420</td><td colspan="7"></td></tr><tr><td class="h">421</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $navcrap;</td></tr>
<tr><td class="h">422</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L422">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($pages &gt; 1) {</td></tr>
<tr><td class="h">423</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= &quot;&lt;center&gt;&lt;font face=&#39;Arial,Helvetica&#39; size=&#39;-1&#39;&gt;&lt;b&gt;&quot;;</td></tr>
<tr><td class="h">424</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= BML::ml(&#39;ljlib.pageofpages&#39;,{&#39;page&#39;=&gt;$page, &#39;total&#39;=&gt;$pages}) . &quot;&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">425</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $left = &quot;&lt;b&gt;&amp;lt;&amp;lt;&lt;/b&gt;&quot;;</td></tr>
<tr><td class="h">426</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L426">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($page &gt; 1) { $left = &quot;&lt;a href=&#39;&quot; . $self_link-&gt;($page-1) . &quot;&#39;&quot; . $href_opts-&gt;($page-1) . &quot;&gt;$left&lt;/a&gt;&quot;; }</td></tr>
<tr><td class="h">427</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $right = &quot;&lt;b&gt;&amp;gt;&amp;gt;&lt;/b&gt;&quot;;</td></tr>
<tr><td class="h">428</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L428">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($page &lt; $pages) { $right = &quot;&lt;a href=&#39;&quot; . $self_link-&gt;($page+1) . &quot;&#39;&quot; . $href_opts-&gt;($page+1) . &quot;&gt;$right&lt;/a&gt;&quot;; }</td></tr>
<tr><td class="h">429</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= $left . &quot; &quot;;</td></tr>
<tr><td class="h">430</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (my $i=1; $i&lt;=$pages; $i++) {</td></tr>
<tr><td class="h">431</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $link = &quot;[$i]&quot;;</td></tr>
<tr><td class="h">432</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L432">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($i != $page) { $link = &quot;&lt;a href=&#39;&quot; . $self_link-&gt;($i) . &quot;&#39;&quot; .  $href_opts-&gt;($i) . &quot;&gt;$link&lt;/a&gt;&quot;; }</td></tr>
<tr><td class="h">433</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else { $link = &quot;&lt;font size=&#39;+1&#39;&gt;&lt;b&gt;$link&lt;/b&gt;&lt;/font&gt;&quot;; }</td></tr>
<tr><td class="h">434</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= &quot;$link &quot;;</td></tr>
<tr><td class="h">435</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= &quot;$right&quot;;</td></tr>
<tr><td class="h">437</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap .= &quot;&lt;/font&gt;&lt;/center&gt;\n&quot;;</td></tr>
<tr><td class="h">438</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$navcrap = BML::fill_template(&quot;standout&quot;, { &#39;DATA&#39; =&gt; $navcrap });</td></tr>
<tr><td class="h">439</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $navcrap;</td></tr>
<tr><td class="h">441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">442</td><td colspan="7"></td></tr><tr><td class="h">443</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">444</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">445</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::make_cookie</td></tr>
<tr><td class="h">446</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Prepares cookie header lines.</td></tr>
<tr><td class="h">447</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: An array of cookie lines.</td></tr>
<tr><td class="h">448</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: name, value, expires, path?, domain?</td></tr>
<tr><td class="h">449</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-name: The name of the cookie.</td></tr>
<tr><td class="h">450</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-value: The value to set the cookie to.</td></tr>
<tr><td class="h">451</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-expires: The time (in seconds) when the cookie is supposed to expire.</td></tr>
<tr><td class="h">452</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#              Set this to 0 to expire when the browser closes. Set it to</td></tr>
<tr><td class="h">453</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#              undef to delete the cookie.</td></tr>
<tr><td class="h">454</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-path: The directory path to bind the cookie to.</td></tr>
<tr><td class="h">455</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-domain: The domain (or domains) to bind the cookie to.</td></tr>
<tr><td class="h">456</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_cookie</td></tr>
<tr><td class="h">458</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">459</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L459">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($name, $value, $expires, $path, $domain) = @_;</td></tr>
<tr><td class="h">460</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cookie = &quot;&quot;;</td></tr>
<tr><td class="h">461</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @cookies = ();</td></tr>
<tr><td class="h">462</td><td colspan="7"></td></tr><tr><td class="h">463</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# let the domain argument be an array ref, so callers can set</td></tr>
<tr><td class="h">464</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# cookies in both .foo.com and foo.com, for some broken old browsers.</td></tr>
<tr><td class="h">465</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L465">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L465">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($domain &amp;&amp; ref $domain eq &quot;ARRAY&quot;) {</td></tr>
<tr><td class="h">466</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (@$domain) {</td></tr>
<tr><td class="h">467</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(@cookies, LJ::make_cookie($name, $value, $expires, $path, $_));</td></tr>
<tr><td class="h">468</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">469</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">470</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">471</td><td colspan="7"></td></tr><tr><td class="h">472</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = gmtime($expires);</td></tr>
<tr><td class="h">473</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$year+=1900;</td></tr>
<tr><td class="h">474</td><td colspan="7"></td></tr><tr><td class="h">475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @day = qw{Sunday Monday Tuesday Wednesday Thursday Friday Saturday};</td></tr>
<tr><td class="h">476</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @month = qw{Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec};</td></tr>
<tr><td class="h">477</td><td colspan="7"></td></tr><tr><td class="h">478</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cookie = sprintf &quot;%s=%s&quot;, LJ::eurl($name), LJ::eurl($value);</td></tr>
<tr><td class="h">479</td><td colspan="7"></td></tr><tr><td class="h">480</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# this logic is confusing potentially</td></tr>
<tr><td class="h">481</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L481">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L481">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (defined $expires &amp;&amp; $expires==0) {</td></tr>
<tr><td class="h">482</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cookie .= sprintf &quot;; expires=$day[$wday], %02d-$month[$mon]-%04d %02d:%02d:%02d GMT&quot;,</td></tr>
<tr><td class="h">483</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$mday, $year, $hour, $min, $sec;</td></tr>
<tr><td class="h">484</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">485</td><td colspan="7"></td></tr><tr><td class="h">486</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L486">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cookie .= &quot;; path=$path&quot; if $path;</td></tr>
<tr><td class="h">487</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L487">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cookie .= &quot;; domain=$domain&quot; if $domain;</td></tr>
<tr><td class="h">488</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push(@cookies, $cookie);</td></tr>
<tr><td class="h">489</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @cookies;</td></tr>
<tr><td class="h">490</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">491</td><td colspan="7"></td></tr><tr><td class="h">492</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_active_crumb</td></tr>
<tr><td class="h">493</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">494</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L494">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$LJ::ACTIVE_CRUMB = shift;</td></tr>
<tr><td class="h">495</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">496</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">497</td><td colspan="7"></td></tr><tr><td class="h">498</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_dynamic_crumb</td></tr>
<tr><td class="h">499</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">500</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L500">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($title, $parent) = @_;</td></tr>
<tr><td class="h">501</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$LJ::ACTIVE_CRUMB = [ $title, $parent ];</td></tr>
<tr><td class="h">502</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">503</td><td colspan="7"></td></tr><tr><td class="h">504</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_parent_crumb</td></tr>
<tr><td class="h">505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">506</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L506">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $thiscrumb = LJ::get_crumb(LJ::get_active_crumb());</td></tr>
<tr><td class="h">507</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return LJ::get_crumb($thiscrumb-&gt;[2]);</td></tr>
<tr><td class="h">508</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">509</td><td colspan="7"></td></tr><tr><td class="h">510</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_active_crumb</td></tr>
<tr><td class="h">511</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">512</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L512">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $LJ::ACTIVE_CRUMB;</td></tr>
<tr><td class="h">513</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">514</td><td colspan="7"></td></tr><tr><td class="h">515</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_crumb_path</td></tr>
<tr><td class="h">516</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">517</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L517">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cur = LJ::get_active_crumb();</td></tr>
<tr><td class="h">518</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @list;</td></tr>
<tr><td class="h">519</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ($cur) {</td></tr>
<tr><td class="h">520</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# get crumb, fix it up, and then put it on the list</td></tr>
<tr><td class="h">521</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L521">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ref $cur) {</td></tr>
<tr><td class="h">522</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# dynamic crumb</td></tr>
<tr><td class="h">523</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @list, [ $cur-&gt;[0], &#39;&#39;, $cur-&gt;[1], &#39;dynamic&#39; ];</td></tr>
<tr><td class="h">524</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cur = $cur-&gt;[1];</td></tr>
<tr><td class="h">525</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">526</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# just a regular crumb</td></tr>
<tr><td class="h">527</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $crumb = LJ::get_crumb($cur);</td></tr>
<tr><td class="h">528</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L528">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last unless $crumb;</td></tr>
<tr><td class="h">529</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L529">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last if $cur eq $crumb-&gt;[2];</td></tr>
<tr><td class="h">530</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$crumb-&gt;[3] = $cur;</td></tr>
<tr><td class="h">531</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @list, $crumb;</td></tr>
<tr><td class="h">532</td><td colspan="7"></td></tr><tr><td class="h">533</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# now get the next one we&#39;re going after</td></tr>
<tr><td class="h">534</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cur = $crumb-&gt;[2]; # parent of this crumb</td></tr>
<tr><td class="h">535</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">536</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @list;</td></tr>
<tr><td class="h">538</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">539</td><td colspan="7"></td></tr><tr><td class="h">540</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_crumb</td></tr>
<tr><td class="h">541</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">542</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L542">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $crumbkey = shift;</td></tr>
<tr><td class="h">543</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L543">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (defined $LJ::CRUMBS_LOCAL{$crumbkey}) {</td></tr>
<tr><td class="h">544</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $LJ::CRUMBS_LOCAL{$crumbkey};</td></tr>
<tr><td class="h">545</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">546</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $LJ::CRUMBS{$crumbkey};</td></tr>
<tr><td class="h">547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">548</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">549</td><td colspan="7"></td></tr><tr><td class="h">550</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">551</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::check_referer</td></tr>
<tr><td class="h">552</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">553</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Checks if the user is coming from a given URI.</td></tr>
<tr><td class="h">554</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: uri?, referer?</td></tr>
<tr><td class="h">555</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-uri: string; the URI we want the user to come from.</td></tr>
<tr><td class="h">556</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-referer: string; the location the user is posting from.</td></tr>
<tr><td class="h">557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#              If not supplied, will be retrieved with BML::get_client_header.</td></tr>
<tr><td class="h">558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#              In general, you don&#39;t want to pass this yourself unless</td></tr>
<tr><td class="h">559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#              you already have it or know we can&#39;t get it from BML.</td></tr>
<tr><td class="h">560</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: 1 if they&#39;re coming from that URI, else undef</td></tr>
<tr><td class="h">561</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">562</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub check_referer {</td></tr>
<tr><td class="h">563</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L563">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L563">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $uri = shift(@_) || &#39;&#39;;</td></tr>
<tr><td class="h">564</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L564">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $referer = shift(@_) || BML::get_client_header(&#39;Referer&#39;);</td></tr>
<tr><td class="h">565</td><td colspan="7"></td></tr><tr><td class="h">566</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# get referer and check</td></tr>
<tr><td class="h">567</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L567">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 unless $referer;</td></tr>
<tr><td class="h">568</td><td colspan="7"></td></tr><tr><td class="h">569</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $origuri, $origreferer ) = ( $uri, $referer );</td></tr>
<tr><td class="h">570</td><td colspan="7"></td></tr><tr><td class="h">571</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# escape any regex characters, like the &#39;.&#39; in &#39;.bml&#39;</td></tr>
<tr><td class="h">572</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$uri = quotemeta( $uri );</td></tr>
<tr><td class="h">573</td><td colspan="7"></td></tr><tr><td class="h">574</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# allow us to properly check URIs without .bml extensions</td></tr>
<tr><td class="h">575</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L575">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $origuri =~ /\.bml($|\?)/ ) {</td></tr>
<tr><td class="h">576</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L576">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $checkend = ( $1 eq &#39;?&#39; ? &#39;&#39; : &#39;(?:$|\\?)&#39; );</td></tr>
<tr><td class="h">577</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uri     =~ s/\\.bml($|\\\?)/$1$checkend/;</td></tr>
<tr><td class="h">578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$referer =~ s/\.bml($|\?)/$1/;</td></tr>
<tr><td class="h">579</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">580</td><td colspan="7"></td></tr><tr><td class="h">581</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L581">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L581">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $LJ::SITEROOT   &amp;&amp; $referer =~ m!^\Q$LJ::SITEROOT\E$uri!;</td></tr>
<tr><td class="h">582</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L582">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L582">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $LJ::DOMAIN     &amp;&amp; $referer =~ m!^http://\Q$LJ::DOMAIN\E$uri!;</td></tr>
<tr><td class="h">583</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L583">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L583">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $LJ::DOMAIN_WEB &amp;&amp; $referer =~ m!^http://\Q$LJ::DOMAIN_WEB\E$uri!;</td></tr>
<tr><td class="h">584</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L584">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L584">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $LJ::USER_VHOSTS &amp;&amp; $referer =~ m!^http://([A-Za-z0-9_\-]{1,25})\.\Q$LJ::DOMAIN\E$uri!;</td></tr>
<tr><td class="h">585</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L585">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L585">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 1 if $origuri =~ m!^http://! &amp;&amp; $origreferer eq $origuri;</td></tr>
<tr><td class="h">586</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef;</td></tr>
<tr><td class="h">587</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">588</td><td colspan="7"></td></tr><tr><td class="h">589</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">590</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::form_auth</td></tr>
<tr><td class="h">591</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">592</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Creates an authentication token to be used later to verify that a form</td></tr>
<tr><td class="h">593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      submission came from a particular user.</td></tr>
<tr><td class="h">594</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: raw?</td></tr>
<tr><td class="h">595</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-raw: boolean; If true, returns only the token (no HTML).</td></tr>
<tr><td class="h">596</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: HTML hidden field to be inserted into the output of a page.</td></tr>
<tr><td class="h">597</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">598</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub form_auth {</td></tr>
<tr><td class="h">599</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L599">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $raw = shift;</td></tr>
<tr><td class="h">600</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $chal = $LJ::REQ_GLOBAL{form_auth_chal};</td></tr>
<tr><td class="h">601</td><td colspan="7"></td></tr><tr><td class="h">602</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L602">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($chal) {</td></tr>
<tr><td class="h">603</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">604</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L604">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $id     = $remote ? $remote-&gt;id : 0;</td></tr>
<tr><td class="h">605</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L605">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L605">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sess   = $remote &amp;&amp; $remote-&gt;session ? $remote-&gt;session-&gt;id : LJ::UniqCookie-&gt;current_uniq;</td></tr>
<tr><td class="h">606</td><td colspan="7"></td></tr><tr><td class="h">607</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $auth = join(&#39;-&#39;, LJ::rand_chars(10), $id, $sess);</td></tr>
<tr><td class="h">608</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$chal = LJ::challenge_generate(86400, $auth);</td></tr>
<tr><td class="h">609</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$LJ::REQ_GLOBAL{form_auth_chal} = $chal;</td></tr>
<tr><td class="h">610</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">611</td><td colspan="7"></td></tr><tr><td class="h">612</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L612">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $raw ? $chal : LJ::html_hidden(&quot;lj_form_auth&quot;, $chal);</td></tr>
<tr><td class="h">613</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">614</td><td colspan="7"></td></tr><tr><td class="h">615</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">616</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::check_form_auth</td></tr>
<tr><td class="h">617</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">618</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Verifies form authentication created with [func[LJ::form_auth]].</td></tr>
<tr><td class="h">619</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: Boolean; true if the current data in %POST is a valid form, submitted</td></tr>
<tr><td class="h">620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#          by the user in $remote using the current session,</td></tr>
<tr><td class="h">621</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#          or false if the user has changed, the challenge has expired,</td></tr>
<tr><td class="h">622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#          or the user has changed session (logged out and in again, or something).</td></tr>
<tr><td class="h">623</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">624</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub check_form_auth {</td></tr>
<tr><td class="h">625</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L625">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L625">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $formauth = shift || $BMLCodeBlock::POST{&#39;lj_form_auth&#39;};</td></tr>
<tr><td class="h">626</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L626">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $formauth;</td></tr>
<tr><td class="h">627</td><td colspan="7"></td></tr><tr><td class="h">628</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">629</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L629">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $id     = $remote ? $remote-&gt;id : 0;</td></tr>
<tr><td class="h">630</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L630">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L630">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sess   = $remote &amp;&amp; $remote-&gt;session ? $remote-&gt;session-&gt;id : LJ::UniqCookie-&gt;current_uniq;</td></tr>
<tr><td class="h">631</td><td colspan="7"></td></tr><tr><td class="h">632</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# check the attributes are as they should be</td></tr>
<tr><td class="h">633</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $attr = LJ::get_challenge_attributes($formauth);</td></tr>
<tr><td class="h">634</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($randchars, $chal_id, $chal_sess) = split(/\-/, $attr);</td></tr>
<tr><td class="h">635</td><td colspan="7"></td></tr><tr><td class="h">636</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L636">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $id   == $chal_id;</td></tr>
<tr><td class="h">637</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L637">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 0 unless $sess eq $chal_sess;</td></tr>
<tr><td class="h">638</td><td colspan="7"></td></tr><tr><td class="h">639</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# check the signature is good and not expired</td></tr>
<tr><td class="h">640</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $opts = { dont_check_count =&gt; 1 };  # in/out</td></tr>
<tr><td class="h">641</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::challenge_check($formauth, $opts);</td></tr>
<tr><td class="h">642</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L642">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $opts-&gt;{valid} &amp;&amp; ! $opts-&gt;{expired};</td></tr>
<tr><td class="h">643</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">644</td><td colspan="7"></td></tr><tr><td class="h">645</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">646</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::create_qr_div</td></tr>
<tr><td class="h">647</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">648</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Creates the hidden div that stores the QuickReply form.</td></tr>
<tr><td class="h">649</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: undef upon failure or HTML for the div upon success</td></tr>
<tr><td class="h">650</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: user, remote, ditemid, stylemine, userpic</td></tr>
<tr><td class="h">651</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-u: user object or userid for journal reply in.</td></tr>
<tr><td class="h">652</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-ditemid: ditemid for this comment.</td></tr>
<tr><td class="h">653</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-stylemine: if the user has specified style=mine for this page.</td></tr>
<tr><td class="h">654</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-userpic: alternate default userpic.</td></tr>
<tr><td class="h">655</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">656</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub create_qr_div {</td></tr>
<tr><td class="h">657</td><td colspan="7"></td></tr><tr><td class="h">658</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L658">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($user, $ditemid, $stylemine, $userpic, $viewing_thread) = @_;</td></tr>
<tr><td class="h">659</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $u = LJ::want_user($user);</td></tr>
<tr><td class="h">660</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">661</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L661">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L661">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $u &amp;&amp; $remote &amp;&amp; $ditemid;</td></tr>
<tr><td class="h">662</td><td colspan="7"></td></tr><tr><td class="h">663</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L663">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$stylemine ||= 0;</td></tr>
<tr><td class="h">664</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $qrhtml;</td></tr>
<tr><td class="h">665</td><td colspan="7"></td></tr><tr><td class="h">666</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::load_user_props($remote, &quot;opt_no_quickreply&quot;);</td></tr>
<tr><td class="h">667</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L667">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef if $remote-&gt;{&#39;opt_no_quickreply&#39;};</td></tr>
<tr><td class="h">668</td><td colspan="7"></td></tr><tr><td class="h">669</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;div id=&#39;qrformdiv&#39;&gt;&lt;form id=&#39;qrform&#39; name=&#39;qrform&#39; method=&#39;POST&#39; action=&#39;$LJ::SITEROOT/talkpost_do&#39;&gt;&quot;;</td></tr>
<tr><td class="h">670</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::form_auth();</td></tr>
<tr><td class="h">671</td><td colspan="7"></td></tr><tr><td class="h">672</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L672">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $stylemineuri = $stylemine ? &quot;style=mine&amp;&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">673</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $basepath =  LJ::journal_base($u) . &quot;/$ditemid.html?${stylemineuri}&quot;;</td></tr>
<tr><td class="h">674</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L674">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L674">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $usertype = ($remote-&gt;openid_identity &amp;&amp; $remote-&gt;is_validated) ? &#39;openid_cookie&#39; : &#39;cookieuser&#39;;</td></tr>
<tr><td class="h">675</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::html_hidden({&#39;name&#39; =&gt; &#39;replyto&#39;, &#39;id&#39; =&gt; &#39;replyto&#39;, &#39;value&#39; =&gt; &#39;&#39;},</td></tr>
<tr><td class="h">676</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;parenttalkid&#39;, &#39;id&#39; =&gt; &#39;parenttalkid&#39;, &#39;value&#39; =&gt; &#39;&#39;},</td></tr>
<tr><td class="h">677</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;journal&#39;, &#39;id&#39; =&gt; &#39;journal&#39;, &#39;value&#39; =&gt; $u-&gt;{&#39;user&#39;}},</td></tr>
<tr><td class="h">678</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;itemid&#39;, &#39;id&#39; =&gt; &#39;itemid&#39;, &#39;value&#39; =&gt; $ditemid},</td></tr>
<tr><td class="h">679</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;usertype&#39;, &#39;id&#39; =&gt; &#39;usertype&#39;, &#39;value&#39; =&gt; $usertype },</td></tr>
<tr><td class="h">680</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;qr&#39;, &#39;id&#39; =&gt; &#39;qr&#39;, &#39;value&#39; =&gt; &#39;1&#39;},</td></tr>
<tr><td class="h">681</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;cookieuser&#39;, &#39;id&#39; =&gt; &#39;cookieuser&#39;, &#39;value&#39; =&gt; $remote-&gt;{&#39;user&#39;}},</td></tr>
<tr><td class="h">682</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;dtid&#39;, &#39;id&#39; =&gt; &#39;dtid&#39;, &#39;value&#39; =&gt; &#39;&#39;},</td></tr>
<tr><td class="h">683</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;basepath&#39;, &#39;id&#39; =&gt; &#39;basepath&#39;, &#39;value&#39; =&gt; $basepath},</td></tr>
<tr><td class="h">684</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;stylemine&#39;, &#39;id&#39; =&gt; &#39;stylemine&#39;, &#39;value&#39; =&gt; $stylemine},</td></tr>
<tr><td class="h">685</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;viewing_thread&#39;, &#39;id&#39; =&gt; &#39;viewing_thread&#39;, &#39;value&#39; =&gt; $viewing_thread},</td></tr>
<tr><td class="h">686</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">687</td><td colspan="7"></td></tr><tr><td class="h">688</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# rate limiting challenge</td></tr>
<tr><td class="h">689</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">690</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($time, $secret) = LJ::get_secret();</td></tr>
<tr><td class="h">691</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rchars = LJ::rand_chars(20);</td></tr>
<tr><td class="h">692</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $chal = $ditemid . &quot;-$u-&gt;{userid}-$time-$rchars&quot;;</td></tr>
<tr><td class="h">693</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $res = Digest::MD5::md5_hex($secret . $chal);</td></tr>
<tr><td class="h">694</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::html_hidden(&quot;chrp1&quot;, &quot;$chal-$res&quot;);</td></tr>
<tr><td class="h">695</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">696</td><td colspan="7"></td></tr><tr><td class="h">697</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Start making the div itself</td></tr>
<tr><td class="h">698</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;table style=&#39;border: 1px solid black&#39;&gt;&quot;;</td></tr>
<tr><td class="h">699</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;tr valign=&#39;center&#39;&gt;&quot;;</td></tr>
<tr><td class="h">700</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;td align=&#39;right&#39;&gt;&lt;b&gt;&quot;.BML::ml(&#39;/talkpost.bml.opt.from&#39;).&quot;&lt;/b&gt;&lt;/td&gt;&lt;td align=&#39;left&#39;&gt;&quot;;</td></tr>
<tr><td class="h">701</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::ljuser($remote-&gt;{&#39;user&#39;});</td></tr>
<tr><td class="h">702</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/td&gt;&lt;td align=&#39;center&#39;&gt;&quot;;</td></tr>
<tr><td class="h">703</td><td colspan="7"></td></tr><tr><td class="h">704</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Userpic selector</td></tr>
<tr><td class="h">705</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">706</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %res;</td></tr>
<tr><td class="h">707</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L707">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::do_request({ &quot;mode&quot; =&gt; &quot;login&quot;,</td></tr>
<tr><td class="h">708</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ver&quot; =&gt; ($LJ::UNICODE ? &quot;1&quot; : &quot;0&quot;),</td></tr>
<tr><td class="h">709</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;user&quot; =&gt; $remote-&gt;{&#39;user&#39;},</td></tr>
<tr><td class="h">710</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;getpickws&quot; =&gt; 1, },</td></tr>
<tr><td class="h">711</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\%res, { &quot;noauth&quot; =&gt; 1, &quot;userid&quot; =&gt; $remote-&gt;{&#39;userid&#39;}}</td></tr>
<tr><td class="h">712</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">713</td><td colspan="7"></td></tr><tr><td class="h">714</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L714">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($res{&#39;pickw_count&#39;}) {</td></tr>
<tr><td class="h">715</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= BML::ml(&#39;/talkpost.bml.label.picturetouse2&#39;,</td></tr>
<tr><td class="h">716</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">717</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;aopts&#39;=&gt;&quot;href=&#39;&quot; . $remote-&gt;allpics_base . &quot;&#39;&quot;});</td></tr>
<tr><td class="h">718</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @pics;</td></tr>
<tr><td class="h">719</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (my $i=1; $i&lt;=$res{&#39;pickw_count&#39;}; $i++) {</td></tr>
<tr><td class="h">720</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @pics, $res{&quot;pickw_$i&quot;};</td></tr>
<tr><td class="h">721</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">722</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pics = sort { lc($a) cmp lc($b) } @pics;</td></tr>
<tr><td class="h">723</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::html_select({&#39;name&#39; =&gt; &#39;prop_picture_keyword&#39;,</td></tr>
<tr><td class="h">724</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $userpic, &#39;id&#39; =&gt; &#39;prop_picture_keyword&#39; },</td></tr>
<tr><td class="h">725</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&quot;&quot;, BML::ml(&#39;/talkpost.bml.opt.defpic&#39;), map { ($_, $_) } @pics));</td></tr>
<tr><td class="h">726</td><td colspan="7"></td></tr><tr><td class="h">727</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# userpic browse button</td></tr>
<tr><td class="h">728</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L728">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L728">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= qq {</td></tr>
<tr><td class="h">729</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;button&quot; id=&quot;lj_userpicselect&quot; value=&quot;Browse&quot; /&gt;</td></tr>
<tr><td class="h">730</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} if LJ::is_enabled(&#39;userpicselect&#39;) &amp;&amp; $remote-&gt;get_cap(&#39;userpicselect&#39;);</td></tr>
<tr><td class="h">731</td><td colspan="7"></td></tr><tr><td class="h">732</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::help_icon_html(&quot;userpics&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">733</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">734</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">735</td><td colspan="7"></td></tr><tr><td class="h">736</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">737</td><td colspan="7"></td></tr><tr><td class="h">738</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;tr&gt;&lt;td align=&#39;right&#39;&gt;&quot;;</td></tr>
<tr><td class="h">739</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;b&gt;&quot;.BML::ml(&#39;/talkpost.bml.opt.subject&#39;).&quot;&lt;/b&gt;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">740</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;td colspan=&#39;2&#39; align=&#39;left&#39;&gt;&quot;;</td></tr>
<tr><td class="h">741</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;input class=&#39;textbox&#39; type=&#39;text&#39; size=&#39;50&#39; maxlength=&#39;100&#39; name=&#39;subject&#39; id=&#39;subject&#39; value=&#39;&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">742</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">743</td><td colspan="7"></td></tr><tr><td class="h">744</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;tr valign=&#39;top&#39;&gt;&quot;;</td></tr>
<tr><td class="h">745</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;td align=&#39;right&#39;&gt;&lt;b&gt;&quot;.BML::ml(&#39;/talkpost.bml.opt.message&#39;).&quot;&lt;/b&gt;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">746</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;td colspan=&#39;3&#39; style=&#39;width: 90%&#39;&gt;&quot;;</td></tr>
<tr><td class="h">747</td><td colspan="7"></td></tr><tr><td class="h">748</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;textarea class=&#39;textbox&#39; rows=&#39;10&#39; cols=&#39;50&#39; wrap=&#39;soft&#39; name=&#39;body&#39; id=&#39;body&#39; style=&#39;width: 99%&#39;&gt;&lt;/textarea&gt;&quot;;</td></tr>
<tr><td class="h">749</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">750</td><td colspan="7"></td></tr><tr><td class="h">751</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">752</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;td colspan=&#39;3&#39; align=&#39;left&#39;&gt;&quot;;</td></tr>
<tr><td class="h">753</td><td colspan="7"></td></tr><tr><td class="h">754</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::html_submit(&#39;submitpost&#39;, BML::ml(&#39;/talkread.bml.button.post&#39;),</td></tr>
<tr><td class="h">755</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;id&#39; =&gt; &#39;submitpost&#39;,</td></tr>
<tr><td class="h">756</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;raw&#39; =&gt; &#39;onclick=&quot;if (checkLength()) {submitform();}&quot;&#39;</td></tr>
<tr><td class="h">757</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">758</td><td colspan="7"></td></tr><tr><td class="h">759</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .=&quot;&amp;nbsp;&quot; . LJ::html_submit(&#39;submitpview&#39;, BML::ml(&#39;talk.btn.preview&#39;),</td></tr>
<tr><td class="h">760</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;id&#39; =&gt; &#39;submitpview&#39;,</td></tr>
<tr><td class="h">761</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;raw&#39; =&gt; &#39;onclick=&quot;preview()&quot;&#39;</td></tr>
<tr><td class="h">762</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">763</td><td colspan="7"></td></tr><tr><td class="h">764</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::html_hidden(&#39;submitpreview&#39;, &#39;0&#39;);</td></tr>
<tr><td class="h">765</td><td colspan="7"></td></tr><tr><td class="h">766</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&amp;nbsp;&quot; . LJ::html_submit(&#39;submitmoreopts&#39;, BML::ml(&#39;/talkread.bml.button.more&#39;),</td></tr>
<tr><td class="h">767</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;id&#39; =&gt; &#39;submitmoreopts&#39;,</td></tr>
<tr><td class="h">768</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;raw&#39; =&gt; &#39;onclick=&quot;if (moreopts()) {submitform();}&quot;&#39;</td></tr>
<tr><td class="h">769</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">770</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L770">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($LJ::SPELLER) {</td></tr>
<tr><td class="h">771</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&amp;nbsp;&lt;input type=&#39;checkbox&#39; name=&#39;do_spellcheck&#39; value=&#39;1&#39; id=&#39;do_spellcheck&#39; /&gt; &lt;label for=&#39;do_spellcheck&#39;&gt;&quot;;</td></tr>
<tr><td class="h">772</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= BML::ml(&#39;/talkread.bml.qr.spellcheck&#39;);</td></tr>
<tr><td class="h">773</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">774</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">775</td><td colspan="7"></td></tr><tr><td class="h">776</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L776">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($u-&gt;opt_logcommentips eq &#39;A&#39;) {</td></tr>
<tr><td class="h">777</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &#39;&lt;br /&gt;&#39;;</td></tr>
<tr><td class="h">778</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::deemp(BML::ml(&#39;/talkpost.bml.logyourip&#39;));</td></tr>
<tr><td class="h">779</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= LJ::help_icon_html(&quot;iplogging&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">780</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">781</td><td colspan="7"></td></tr><tr><td class="h">782</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;</td></tr>
<tr><td class="h">783</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml .= &quot;&lt;/form&gt;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">784</td><td colspan="7"></td></tr><tr><td class="h">785</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">786</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret = &quot;&lt;script language=&#39;JavaScript&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">787</td><td colspan="7"></td></tr><tr><td class="h">788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$qrhtml = LJ::ejs($qrhtml);</td></tr>
<tr><td class="h">789</td><td colspan="7"></td></tr><tr><td class="h">790</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# here we create some separate fields for saving the quickreply entry</td></tr>
<tr><td class="h">791</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# because the browser will not save to a dynamically-created form.</td></tr>
<tr><td class="h">792</td><td colspan="7"></td></tr><tr><td class="h">793</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $qrsaveform .= LJ::ejs(LJ::html_hidden(</td></tr>
<tr><td class="h">794</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_subject&#39;, &#39;id&#39; =&gt; &#39;saved_subject&#39;},</td></tr>
<tr><td class="h">795</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_body&#39;, &#39;id&#39; =&gt; &#39;saved_body&#39;},</td></tr>
<tr><td class="h">796</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_spell&#39;, &#39;id&#39; =&gt; &#39;saved_spell&#39;},</td></tr>
<tr><td class="h">797</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_upic&#39;, &#39;id&#39; =&gt; &#39;saved_upic&#39;},</td></tr>
<tr><td class="h">798</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_dtid&#39;, &#39;id&#39; =&gt; &#39;saved_dtid&#39;},</td></tr>
<tr><td class="h">799</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;saved_ptid&#39;, &#39;id&#39; =&gt; &#39;saved_ptid&#39;},</td></tr>
<tr><td class="h">800</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</td></tr>
<tr><td class="h">801</td><td colspan="7"></td></tr><tr><td class="h">802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq{</td></tr>
<tr><td class="h">803</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var de;</td></tr>
<tr><td class="h">804</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (document.createElement &amp;&amp; document.body.insertBefore &amp;&amp; !(xMac &amp;&amp; xIE4Up)) {</td></tr>
<tr><td class="h">805</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write(&quot;$qrsaveform&quot;);</td></tr>
<tr><td class="h">806</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;de = document.createElement(&quot;div&quot;);</td></tr>
<tr><td class="h">807</td><td colspan="7"></td></tr><tr><td class="h">808</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (de) {</td></tr>
<tr><td class="h">809</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;de.id = &quot;qrdiv&quot;;</td></tr>
<tr><td class="h">810</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;de.innerHTML = &quot;$qrhtml&quot;;</td></tr>
<tr><td class="h">811</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var bodye = document.getElementsByTagName(&quot;body&quot;);</td></tr>
<tr><td class="h">812</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (bodye[0])</td></tr>
<tr><td class="h">813</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bodye[0].insertBefore(de, bodye[0].firstChild);</td></tr>
<tr><td class="h">814</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;de.style.display = &#39;none&#39;;</td></tr>
<tr><td class="h">815</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">816</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">817</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">818</td><td colspan="7"></td></tr><tr><td class="h">819</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;\n&lt;/script&gt;&quot;;</td></tr>
<tr><td class="h">820</td><td colspan="7"></td></tr><tr><td class="h">821</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L821">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L821">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq {</td></tr>
<tr><td class="h">822</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript&quot;&gt;</td></tr>
<tr><td class="h">823</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(window, &quot;load&quot;, function (evt) {</td></tr>
<tr><td class="h">824</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// attach userpicselect code to userpicbrowse button</td></tr>
<tr><td class="h">825</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups_btn = \$(&quot;lj_userpicselect&quot;);</td></tr>
<tr><td class="h">826</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ups_btn) {</td></tr>
<tr><td class="h">827</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(ups_btn, &quot;click&quot;, function (evt) {</td></tr>
<tr><td class="h">828</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups = new UserpicSelect();</td></tr>
<tr><td class="h">829</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.init();</td></tr>
<tr><td class="h">830</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.setPicSelectedCallback(function (picid, keywords) {</td></tr>
<tr><td class="h">831</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var kws_dropdown = \$(&quot;prop_picture_keyword&quot;);</td></tr>
<tr><td class="h">832</td><td colspan="7"></td></tr><tr><td class="h">833</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (kws_dropdown) {</td></tr>
<tr><td class="h">834</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var items = kws_dropdown.options;</td></tr>
<tr><td class="h">835</td><td colspan="7"></td></tr><tr><td class="h">836</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// select the keyword in the dropdown</td></tr>
<tr><td class="h">837</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keywords.forEach(function (kw) {</td></tr>
<tr><td class="h">838</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i = 0; i &lt; items.length; i++) {</td></tr>
<tr><td class="h">839</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var item = items[i];</td></tr>
<tr><td class="h">840</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (item.value == kw) {</td></tr>
<tr><td class="h">841</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kws_dropdown.selectedIndex = i;</td></tr>
<tr><td class="h">842</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">843</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">844</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">845</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">846</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">847</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">848</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.show();</td></tr>
<tr><td class="h">849</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">850</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">851</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">852</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</td></tr>
<tr><td class="h">853</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} if LJ::is_enabled(&#39;userpicselect&#39;) &amp;&amp; $remote-&gt;get_cap(&#39;userpicselect&#39;);</td></tr>
<tr><td class="h">854</td><td colspan="7"></td></tr><tr><td class="h">855</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">856</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">857</td><td colspan="7"></td></tr><tr><td class="h">858</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">859</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::make_qr_link</td></tr>
<tr><td class="h">860</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">861</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Creates the link to toggle the QR reply form or if</td></tr>
<tr><td class="h">862</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      JavaScript is not enabled, then forwards the user through</td></tr>
<tr><td class="h">863</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      to replyurl.</td></tr>
<tr><td class="h">864</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: undef upon failure or HTML for the link</td></tr>
<tr><td class="h">865</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: dtid, basesubject, linktext, replyurl</td></tr>
<tr><td class="h">866</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-dtid: dtalkid for this comment</td></tr>
<tr><td class="h">867</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-basesubject: parent comment&#39;s subject</td></tr>
<tr><td class="h">868</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-linktext: text for the user to click</td></tr>
<tr><td class="h">869</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-replyurl: URL to forward user to if their browser</td></tr>
<tr><td class="h">870</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#               does not support QR.</td></tr>
<tr><td class="h">871</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">872</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_qr_link</td></tr>
<tr><td class="h">873</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">874</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L874">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($dtid, $basesubject, $linktext, $replyurl) = @_;</td></tr>
<tr><td class="h">875</td><td colspan="7"></td></tr><tr><td class="h">876</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L876">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L876">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless defined $dtid &amp;&amp; $linktext &amp;&amp; $replyurl;</td></tr>
<tr><td class="h">877</td><td colspan="7"></td></tr><tr><td class="h">878</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::load_user_props($remote, &quot;opt_no_quickreply&quot;);</td></tr>
<tr><td class="h">880</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L880">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($remote-&gt;{&#39;opt_no_quickreply&#39;}) {</td></tr>
<tr><td class="h">881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pid = int($dtid / 256);</td></tr>
<tr><td class="h">882</td><td colspan="7"></td></tr><tr><td class="h">883</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basesubject =~ s/^(Re:\s*)*//i;</td></tr>
<tr><td class="h">884</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L884">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basesubject = &quot;Re: $basesubject&quot; if $basesubject;</td></tr>
<tr><td class="h">885</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$basesubject = LJ::ehtml(LJ::ejs($basesubject));</td></tr>
<tr><td class="h">886</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $onclick = &quot;return quickreply(\&quot;$dtid\&quot;, $pid, \&quot;$basesubject\&quot;)&quot;;</td></tr>
<tr><td class="h">887</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;a onclick=&#39;$onclick&#39; href=&#39;$replyurl&#39; &gt;$linktext&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">888</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else { # QR Disabled</td></tr>
<tr><td class="h">889</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;a href=&#39;$replyurl&#39; &gt;$linktext&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">890</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">891</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">892</td><td colspan="7"></td></tr><tr><td class="h">893</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">894</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::get_lastcomment</td></tr>
<tr><td class="h">895</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">896</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Looks up the last talkid and journal the remote user posted in.</td></tr>
<tr><td class="h">897</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: talkid, jid</td></tr>
<tr><td class="h">898</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args:</td></tr>
<tr><td class="h">899</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">900</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub get_lastcomment {</td></tr>
<tr><td class="h">901</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L901">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">902</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L902">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return (undef, undef) unless $remote;</td></tr>
<tr><td class="h">903</td><td colspan="7"></td></tr><tr><td class="h">904</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Figure out their last post</td></tr>
<tr><td class="h">905</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memkey = [$remote-&gt;{&#39;userid&#39;}, &quot;lastcomm:$remote-&gt;{&#39;userid&#39;}&quot;];</td></tr>
<tr><td class="h">906</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memval = LJ::MemCache::get($memkey);</td></tr>
<tr><td class="h">907</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L907">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($jid, $talkid) = split(/:/, $memval) if $memval;</td></tr>
<tr><td class="h">908</td><td colspan="7"></td></tr><tr><td class="h">909</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return ($talkid, $jid);</td></tr>
<tr><td class="h">910</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">911</td><td colspan="7"></td></tr><tr><td class="h">912</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">913</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::make_qr_target</td></tr>
<tr><td class="h">914</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">915</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns a div usable for QuickReply boxes.</td></tr>
<tr><td class="h">916</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: HTML for the div</td></tr>
<tr><td class="h">917</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args:</td></tr>
<tr><td class="h">918</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">919</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub make_qr_target {</td></tr>
<tr><td class="h">920</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L920">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $name = shift;</td></tr>
<tr><td class="h">921</td><td colspan="7"></td></tr><tr><td class="h">922</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;div id=&#39;ljqrt$name&#39; name=&#39;ljqrt$name&#39;&gt;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">923</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">924</td><td colspan="7"></td></tr><tr><td class="h">925</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">926</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::set_lastcomment</td></tr>
<tr><td class="h">927</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">928</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Sets the lastcomm memcached key for this user&#39;s last comment.</td></tr>
<tr><td class="h">929</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: undef on failure</td></tr>
<tr><td class="h">930</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: u, remote, dtalkid, life?</td></tr>
<tr><td class="h">931</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-u: Journal they just posted in, either u or userid</td></tr>
<tr><td class="h">932</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-remote: Remote user</td></tr>
<tr><td class="h">933</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-dtalkid: Talkid for the comment they just posted</td></tr>
<tr><td class="h">934</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-life: How long, in seconds, the memcached key should live.</td></tr>
<tr><td class="h">935</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">936</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_lastcomment</td></tr>
<tr><td class="h">937</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">938</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L938">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($u, $remote, $dtalkid, $life) = @_;</td></tr>
<tr><td class="h">939</td><td colspan="7"></td></tr><tr><td class="h">940</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $userid = LJ::want_userid($u);</td></tr>
<tr><td class="h">941</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L941">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L941">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $userid &amp;&amp; $remote &amp;&amp; $dtalkid;</td></tr>
<tr><td class="h">942</td><td colspan="7"></td></tr><tr><td class="h">943</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# By default, this key lasts for 10 seconds.</td></tr>
<tr><td class="h">944</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L944">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$life ||= 10;</td></tr>
<tr><td class="h">945</td><td colspan="7"></td></tr><tr><td class="h">946</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Set memcache key for highlighting the comment</td></tr>
<tr><td class="h">947</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $memkey = [$remote-&gt;{&#39;userid&#39;}, &quot;lastcomm:$remote-&gt;{&#39;userid&#39;}&quot;];</td></tr>
<tr><td class="h">948</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::MemCache::set($memkey, &quot;$userid:$dtalkid&quot;, time()+$life);</td></tr>
<tr><td class="h">949</td><td colspan="7"></td></tr><tr><td class="h">950</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">951</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">952</td><td colspan="7"></td></tr><tr><td class="h">953</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub deemp {</td></tr>
<tr><td class="h">954</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L954">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;span class=&#39;de&#39;&gt;$_[0]&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">955</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">956</td><td colspan="7"></td></tr><tr><td class="h">957</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">958</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::entry_form</td></tr>
<tr><td class="h">959</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">960</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns a properly formatted form for creating/editing entries.</td></tr>
<tr><td class="h">961</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: head, onload, opts</td></tr>
<tr><td class="h">962</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-head: string reference for the &lt;head&gt; section (JavaScript previews, etc).</td></tr>
<tr><td class="h">963</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-onload: string reference for JavaScript functions to be called on page load</td></tr>
<tr><td class="h">964</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-opts: hashref of keys/values:</td></tr>
<tr><td class="h">965</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           mode: either &quot;update&quot; or &quot;edit&quot;, depending on context;</td></tr>
<tr><td class="h">966</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           datetime: date and time, formatted yyyy-mm-dd hh:mm;</td></tr>
<tr><td class="h">967</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           remote: remote u object;</td></tr>
<tr><td class="h">968</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           subject: entry subject;</td></tr>
<tr><td class="h">969</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           event: entry text;</td></tr>
<tr><td class="h">970</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           richtext: allow rich text formatting;</td></tr>
<tr><td class="h">971</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#           auth_as_remote: bool option to authenticate as remote user, pre-filling pic/friend groups/etc.</td></tr>
<tr><td class="h">972</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return: form to include in BML pages.</td></tr>
<tr><td class="h">973</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">974</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form {</td></tr>
<tr><td class="h">975</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L975">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($opts, $head, $onload, $errors) = @_;</td></tr>
<tr><td class="h">976</td><td colspan="7"></td></tr><tr><td class="h">977</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $out = &quot;&quot;;</td></tr>
<tr><td class="h">978</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = $opts-&gt;{&#39;remote&#39;};</td></tr>
<tr><td class="h">979</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $altlogin = $opts-&gt;{&#39;altlogin&#39;};</td></tr>
<tr><td class="h">980</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L980">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $userpic_display = $altlogin ? &#39;none&#39; : &#39;block&#39;;</td></tr>
<tr><td class="h">981</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($moodlist, $moodpics, $userpics, $altcode);</td></tr>
<tr><td class="h">982</td><td colspan="7"></td></tr><tr><td class="h">983</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# usejournal has no point if you&#39;re trying to use the account you&#39;re logged in as,</td></tr>
<tr><td class="h">984</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# so disregard it so we can assume that if it exists, we&#39;re trying to post to an</td></tr>
<tr><td class="h">985</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# account that isn&#39;t us</td></tr>
<tr><td class="h">986</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L986">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L986">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($remote &amp;&amp; $opts-&gt;{usejournal} &amp;&amp; $remote-&gt;{user} eq $opts-&gt;{usejournal}) {</td></tr>
<tr><td class="h">987</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $opts-&gt;{usejournal};</td></tr>
<tr><td class="h">988</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">989</td><td colspan="7"></td></tr><tr><td class="h">990</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Temp fix for FF 2.0.0.17</td></tr>
<tr><td class="h">991</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rte_is_supported = LJ::is_enabled(&#39;rte_support&#39;, BML::get_client_header(&quot;User-Agent&quot;));</td></tr>
<tr><td class="h">992</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L992">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;richtext_default&#39;} = 0 unless $rte_is_supported;</td></tr>
<tr><td class="h">993</td><td colspan="7"></td></tr><tr><td class="h">994</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;richtext&#39;} = $opts-&gt;{&#39;richtext_default&#39;};</td></tr>
<tr><td class="h">995</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tabnum = 10; #make allowance for username and password</td></tr>
<tr><td class="h">996</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L996">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tabindex = sub { return $tabnum++; };</td></tr>
<tr><td class="h">997</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L997">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;event&#39;} = LJ::durl($opts-&gt;{&#39;event&#39;}) if $opts-&gt;{&#39;mode&#39;} eq &quot;edit&quot;;</td></tr>
<tr><td class="h">998</td><td colspan="7"></td></tr><tr><td class="h">999</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# 1 hour auth token, should be adequate</td></tr>
<tr><td class="h">1000</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $chal = LJ::challenge_generate(3600);</td></tr>
<tr><td class="h">1001</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;\n\n&lt;div id=&#39;entry-form-wrapper&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1002</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;\n&lt;input type=&#39;hidden&#39; name=&#39;chal&#39; id=&#39;login_chal&#39; value=&#39;$chal&#39; /&gt;\n&quot;;</td></tr>
<tr><td class="h">1003</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;response&#39; id=&#39;login_response&#39; value=&#39;&#39; /&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1004</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1004">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::error_list($errors-&gt;{entry}) if $errors-&gt;{entry};</td></tr>
<tr><td class="h">1005</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# do a login action to get pics and usejournals, but only if using remote</td></tr>
<tr><td class="h">1006</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $res;</td></tr>
<tr><td class="h">1007</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1007">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;auth_as_remote&#39;}) {</td></tr>
<tr><td class="h">1008</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$res = LJ::Protocol::do_request(&quot;login&quot;, {</td></tr>
<tr><td class="h">1009</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ver&quot; =&gt; $LJ::PROTOCOL_VER,</td></tr>
<tr><td class="h">1010</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;username&quot; =&gt; $remote-&gt;{&#39;user&#39;},</td></tr>
<tr><td class="h">1011</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;getpickws&quot; =&gt; 1,</td></tr>
<tr><td class="h">1012</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;getpickwurls&quot; =&gt; 1,</td></tr>
<tr><td class="h">1013</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, undef, {</td></tr>
<tr><td class="h">1014</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;noauth&quot; =&gt; 1,</td></tr>
<tr><td class="h">1015</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;u&quot; =&gt; $remote,</td></tr>
<tr><td class="h">1016</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1017</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1018</td><td colspan="7"></td></tr><tr><td class="h">1019</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Userpic</td></tr>
<tr><td class="h">1020</td><td colspan="7"></td></tr><tr><td class="h">1021</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $userpic_preview = &quot;&quot;;</td></tr>
<tr><td class="h">1022</td><td colspan="7"></td></tr><tr><td class="h">1023</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# User Picture</td></tr>
<tr><td class="h">1024</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1024">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1024">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1024">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1024">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1024">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$altlogin &amp;&amp; ($res &amp;&amp; ref $res-&gt;{&#39;pickws&#39;} eq &#39;ARRAY&#39; &amp;&amp; scalar @{$res-&gt;{&#39;pickws&#39;}} &gt; 0)) {</td></tr>
<tr><td class="h">1025</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @pickws = map { ($_, $_) } @{$res-&gt;{&#39;pickws&#39;}};</td></tr>
<tr><td class="h">1026</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $num = 0;</td></tr>
<tr><td class="h">1027</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpics .= &quot;    userpics[$num] = \&quot;$res-&gt;{defaultpicurl}\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1028</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$altcode .= &quot;     alttext[$num] = \&quot;&quot; . BML::ml(&#39;entryform.opt.defpic&#39;) . &quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1029</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (@{$res-&gt;{&#39;pickwurls&#39;}}) {</td></tr>
<tr><td class="h">1030</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num++;</td></tr>
<tr><td class="h">1031</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpics .= &quot;    userpics[$num] = \&quot;$_\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1032</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1033</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num = 0;</td></tr>
<tr><td class="h">1034</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach ( @{$res-&gt;{pickws}} ) {</td></tr>
<tr><td class="h">1035</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num++;</td></tr>
<tr><td class="h">1036</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$altcode .= &quot;     alttext[$num] = \&quot;&quot; . LJ::ejs($_) . &quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1037</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1038</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; userpic_preview();&quot;;</td></tr>
<tr><td class="h">1039</td><td colspan="7"></td></tr><tr><td class="h">1040</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $userpic_link_text;</td></tr>
<tr><td class="h">1041</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1041">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpic_link_text = BML::ml(&#39;entryform.userpic.choose&#39;) if $remote;</td></tr>
<tr><td class="h">1042</td><td colspan="7"></td></tr><tr><td class="h">1043</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$head .= qq {</td></tr>
<tr><td class="h">1044</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript&quot;&gt;&lt;!--</td></tr>
<tr><td class="h">1045</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (document.getElementById) {</td></tr>
<tr><td class="h">1046</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var userpics = new Array();</td></tr>
<tr><td class="h">1047</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var alttext = new Array();</td></tr>
<tr><td class="h">1048</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpics</td></tr>
<tr><td class="h">1049</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$altcode</td></tr>
<tr><td class="h">1050</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function userpic_preview() {</td></tr>
<tr><td class="h">1051</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! document.getElementById) return false;</td></tr>
<tr><td class="h">1052</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var userpic_select          = document.getElementById(&#39;prop_picture_keyword&#39;);</td></tr>
<tr><td class="h">1053</td><td colspan="7"></td></tr><tr><td class="h">1054</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (\$(&#39;userpic&#39;) &amp;&amp; \$(&#39;userpic&#39;).style.display == &#39;none&#39;) {</td></tr>
<tr><td class="h">1055</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\$(&#39;userpic&#39;).style.display = &#39;block&#39;;</td></tr>
<tr><td class="h">1056</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1057</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var userpic_msg;</td></tr>
<tr><td class="h">1058</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (userpics[0] == &quot;&quot;) { userpic_msg = &#39;Choose default userpic&#39; }</td></tr>
<tr><td class="h">1059</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (userpics.length == 0) { userpic_msg = &#39;Upload a userpic&#39; }</td></tr>
<tr><td class="h">1060</td><td colspan="7"></td></tr><tr><td class="h">1061</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (userpic_select &amp;&amp; userpics[userpic_select.selectedIndex] != &quot;&quot;) {</td></tr>
<tr><td class="h">1062</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\$(&#39;userpic_preview&#39;).className = &#39;&#39;;</td></tr>
<tr><td class="h">1063</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var userpic_preview_image = \$(&#39;userpic_preview_image&#39;);</td></tr>
<tr><td class="h">1064</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview_image.style.display = &#39;block&#39;;</td></tr>
<tr><td class="h">1065</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (\$(&#39;userpic_msg&#39;)) {</td></tr>
<tr><td class="h">1066</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\$(&#39;userpic_msg&#39;).style.display = &#39;none&#39;;</td></tr>
<tr><td class="h">1067</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1068</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview_image.src = userpics[userpic_select.selectedIndex];</td></tr>
<tr><td class="h">1069</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview_image.alt = alttext[userpic_select.selectedIndex];</td></tr>
<tr><td class="h">1070</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1071</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview.className += &quot; userpic_preview_border&quot;;</td></tr>
<tr><td class="h">1072</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview.innerHTML = &#39;&lt;a href=&quot;$LJ::SITEROOT/editpics&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;selected userpic&quot; id=&quot;userpic_preview_image&quot; style=&quot;display: none;&quot; /&gt;&lt;span id=&quot;userpic_msg&quot;&gt;&#39; + userpic_msg + &#39;&lt;/span&gt;&lt;/a&gt;&#39;;</td></tr>
<tr><td class="h">1073</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1074</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1075</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1076</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//--&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">1077</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1078</td><td colspan="7"></td></tr><tr><td class="h">1079</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $thumbnail_text = BML::ml( &#39;/update.bml.link.view_thumbnails&#39; );</td></tr>
<tr><td class="h">1080</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1080">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1080">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$head .= qq {</td></tr>
<tr><td class="h">1081</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript&quot;&gt;</td></tr>
<tr><td class="h">1082</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// &lt;![CDATA[</td></tr>
<tr><td class="h">1083</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ml = new Object();</td></tr>
<tr><td class="h">1084</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ml.viewthumbnails_link = &quot;$thumbnail_text&quot;;</td></tr>
<tr><td class="h">1085</td><td colspan="7"></td></tr><tr><td class="h">1086</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(window, &quot;load&quot;, function (evt) {</td></tr>
<tr><td class="h">1087</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// attach userpicselect code to userpicbrowse button</td></tr>
<tr><td class="h">1088</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups_btn = \$(&quot;lj_userpicselect&quot;);</td></tr>
<tr><td class="h">1089</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups_btn_img = \$(&quot;lj_userpicselect_img&quot;);</td></tr>
<tr><td class="h">1090</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ups_btn) {</td></tr>
<tr><td class="h">1091</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(ups_btn, &quot;click&quot;, function (evt) {</td></tr>
<tr><td class="h">1092</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups = new UserpicSelect();</td></tr>
<tr><td class="h">1093</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.init();</td></tr>
<tr><td class="h">1094</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.setPicSelectedCallback(function (picid, keywords) {</td></tr>
<tr><td class="h">1095</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var kws_dropdown = \$(&quot;prop_picture_keyword&quot;);</td></tr>
<tr><td class="h">1096</td><td colspan="7"></td></tr><tr><td class="h">1097</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (kws_dropdown) {</td></tr>
<tr><td class="h">1098</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var items = kws_dropdown.options;</td></tr>
<tr><td class="h">1099</td><td colspan="7"></td></tr><tr><td class="h">1100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// select the keyword in the dropdown</td></tr>
<tr><td class="h">1101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keywords.forEach(function (kw) {</td></tr>
<tr><td class="h">1102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i = 0; i &lt; items.length; i++) {</td></tr>
<tr><td class="h">1103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var item = items[i];</td></tr>
<tr><td class="h">1104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (item.value == kw) {</td></tr>
<tr><td class="h">1105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kws_dropdown.selectedIndex = i;</td></tr>
<tr><td class="h">1106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview();</td></tr>
<tr><td class="h">1107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">1108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1111</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.show();</td></tr>
<tr><td class="h">1114</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1116</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (ups_btn_img) {</td></tr>
<tr><td class="h">1117</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(ups_btn_img, &quot;click&quot;, function (evt) {</td></tr>
<tr><td class="h">1118</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ups = new UserpicSelect();</td></tr>
<tr><td class="h">1119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.init();</td></tr>
<tr><td class="h">1120</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.setPicSelectedCallback(function (picid, keywords) {</td></tr>
<tr><td class="h">1121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var kws_dropdown = \$(&quot;prop_picture_keyword&quot;);</td></tr>
<tr><td class="h">1122</td><td colspan="7"></td></tr><tr><td class="h">1123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (kws_dropdown) {</td></tr>
<tr><td class="h">1124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var items = kws_dropdown.options;</td></tr>
<tr><td class="h">1125</td><td colspan="7"></td></tr><tr><td class="h">1126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// select the keyword in the dropdown</td></tr>
<tr><td class="h">1127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keywords.forEach(function (kw) {</td></tr>
<tr><td class="h">1128</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i = 0; i &lt; items.length; i++) {</td></tr>
<tr><td class="h">1129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var item = items[i];</td></tr>
<tr><td class="h">1130</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (item.value == kw) {</td></tr>
<tr><td class="h">1131</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kws_dropdown.selectedIndex = i;</td></tr>
<tr><td class="h">1132</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userpic_preview();</td></tr>
<tr><td class="h">1133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</td></tr>
<tr><td class="h">1134</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1137</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1138</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1139</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ups.show();</td></tr>
<tr><td class="h">1140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1141</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(ups_btn_img, &quot;mouseover&quot;, function (evt) {</td></tr>
<tr><td class="h">1142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var msg = \$(&quot;lj_userpicselect_img_txt&quot;);</td></tr>
<tr><td class="h">1143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg.style.display = &#39;block&#39;;</td></tr>
<tr><td class="h">1144</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(ups_btn_img, &quot;mouseout&quot;, function (evt) {</td></tr>
<tr><td class="h">1146</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var msg = \$(&quot;lj_userpicselect_img_txt&quot;);</td></tr>
<tr><td class="h">1147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg.style.display = &#39;none&#39;;</td></tr>
<tr><td class="h">1148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1151</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ]]&gt;</td></tr>
<tr><td class="h">1152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</td></tr>
<tr><td class="h">1153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} if LJ::is_enabled(&#39;userpicselect&#39;) &amp;&amp; $remote-&gt;get_cap(&#39;userpicselect&#39;);</td></tr>
<tr><td class="h">1154</td><td colspan="7"></td></tr><tr><td class="h">1155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# libs for userpicselect</td></tr>
<tr><td class="h">1156</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1156">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1156">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(qw(</td></tr>
<tr><td class="h">1157</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/core.js</td></tr>
<tr><td class="h">1158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/dom.js</td></tr>
<tr><td class="h">1159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/json.js</td></tr>
<tr><td class="h">1160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/template.js</td></tr>
<tr><td class="h">1161</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/ippu.js</td></tr>
<tr><td class="h">1162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/lj_ippu.js</td></tr>
<tr><td class="h">1163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/userpicselect.js</td></tr>
<tr><td class="h">1164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/httpreq.js</td></tr>
<tr><td class="h">1165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/hourglass.js</td></tr>
<tr><td class="h">1166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/inputcomplete.js</td></tr>
<tr><td class="h">1167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stc/ups.css</td></tr>
<tr><td class="h">1168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/datasource.js</td></tr>
<tr><td class="h">1169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/selectable_table.js</td></tr>
<tr><td class="h">1170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)) if LJ::is_enabled(&#39;userpicselect&#39;) &amp;&amp; $remote-&gt;get_cap(&#39;userpicselect&#39;);</td></tr>
<tr><td class="h">1171</td><td colspan="7"></td></tr><tr><td class="h">1172</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;userpic&#39; style=&#39;display: none;&#39;&gt;&lt;p id=&#39;userpic_preview&#39;&gt;&lt;a href=&#39;javascript:void(0);&#39; id=&#39;lj_userpicselect_img&#39;&gt;&lt;img src=&#39;&#39; alt=&#39;selected userpic&#39; id=&#39;userpic_preview_image&#39; /&gt;&lt;span id=&#39;lj_userpicselect_img_txt&#39;&gt;$userpic_link_text&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">1173</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;\n&quot;;</td></tr>
<tr><td class="h">1174</td><td colspan="7"></td></tr><tr><td class="h">1175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif (!$remote || $altlogin)  {</td></tr>
<tr><td class="h">1176</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;userpic&#39;&gt;&lt;p id=&#39;userpic_preview&#39;&gt;&lt;img src=&#39;/img/nouserpic.png&#39; alt=&#39;selected userpic&#39; id=&#39;userpic_preview_image&#39; class=&#39;userpic_loggedout&#39;  /&gt;&lt;/p&gt;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">1177</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1178</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;userpic&#39;&gt;&lt;p id=&#39;userpic_preview&#39; class=&#39;userpic_preview_border&#39;&gt;&lt;a href=&#39;$LJ::SITEROOT/editpics&#39;&gt;Upload a userpic&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">1179</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1180</td><td colspan="7"></td></tr><tr><td class="h">1181</td><td colspan="7"></td></tr><tr><td class="h">1182</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Meta Information Column 1</td></tr>
<tr><td class="h">1183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1184</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;metainfo&#39;&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1185</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# login info</td></tr>
<tr><td class="h">1186</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= $opts-&gt;{&#39;auth&#39;};</td></tr>
<tr><td class="h">1187</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1187">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;update&quot;) {</td></tr>
<tr><td class="h">1188</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# communities the user can post in</td></tr>
<tr><td class="h">1189</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $usejournal = $opts-&gt;{&#39;usejournal&#39;};</td></tr>
<tr><td class="h">1190</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1190">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1190">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1190">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($usejournal) {</td></tr>
<tr><td class="h">1191</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p id=&#39;usejournal_single&#39; class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1192</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;usejournal&#39; class=&#39;left&#39;&gt;&quot; . BML::ml(&#39;entryform.postto&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1193</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::ljuser($usejournal);</td></tr>
<tr><td class="h">1194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_hidden({ name =&gt; &#39;usejournal&#39;, value =&gt; $usejournal, id =&gt; &#39;usejournal_username&#39; });</td></tr>
<tr><td class="h">1195</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_hidden( usejournal_set =&gt; &#39;true&#39; );</td></tr>
<tr><td class="h">1196</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1197</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($res &amp;&amp; ref $res-&gt;{&#39;usejournals&#39;} eq &#39;ARRAY&#39;) {</td></tr>
<tr><td class="h">1198</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $submitprefix = BML::ml(&#39;entryform.update3&#39;);</td></tr>
<tr><td class="h">1199</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p id=&#39;usejournal_list&#39; class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1200</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;usejournal&#39; class=&#39;left&#39;&gt;&quot; . BML::ml(&#39;entryform.postto&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1201</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({ &#39;name&#39; =&gt; &#39;usejournal&#39;, &#39;id&#39; =&gt; &#39;usejournal&#39;, &#39;selected&#39; =&gt; $usejournal,</td></tr>
<tr><td class="h">1202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(), &#39;class&#39; =&gt; &#39;select&#39;,</td></tr>
<tr><td class="h">1203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;onchange&quot; =&gt; &quot;changeSubmit(&#39;&quot;.$submitprefix.&quot;&#39;,&#39;&quot;.$remote-&gt;{&#39;user&#39;}.&quot;&#39;); getUserTags(&#39;$remote-&gt;{user}&#39;); changeSecurityOptions(&#39;$remote-&gt;{user}&#39;); LiveJournal.updateXpostFromJournal(&#39;$remote-&gt;{user}&#39;);&quot; },</td></tr>
<tr><td class="h">1204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;, $remote-&gt;{&#39;user&#39;},</td></tr>
<tr><td class="h">1205</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { $_, $_ } @{$res-&gt;{&#39;usejournals&#39;}}) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1206</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1207</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1209</td><td colspan="7"></td></tr><tr><td class="h">1210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Authentication box</td></tr>
<tr><td class="h">1211</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1211">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;update-errors&#39;&gt;&lt;?inerr $errors-&gt;{&#39;auth&#39;} inerr?&gt;&lt;/p&gt;\n&quot; if $errors-&gt;{&#39;auth&#39;};</td></tr>
<tr><td class="h">1212</td><td colspan="7"></td></tr><tr><td class="h">1213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Date / Time</td></tr>
<tr><td class="h">1214</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1215</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($year, $mon, $mday, $hour, $min) = split( /\D/, $opts-&gt;{&#39;datetime&#39;});</td></tr>
<tr><td class="h">1216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $monthlong = LJ::Lang::month_long($mon);</td></tr>
<tr><td class="h">1217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# date entry boxes / formatting note</td></tr>
<tr><td class="h">1218</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $datetime = LJ::html_datetime({ &#39;name&#39; =&gt; &quot;date_ymd&quot;, &#39;notime&#39; =&gt; 1, &#39;default&#39; =&gt; &quot;$year-$mon-$mday&quot;, &#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_save&#39;}});</td></tr>
<tr><td class="h">1219</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$datetime .= &quot;&lt;span class=&#39;float-left&#39;&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">1220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$datetime .=   LJ::html_text({ size =&gt; 2, class =&gt; &#39;text&#39;, maxlength =&gt; 2, value =&gt; $hour, name =&gt; &quot;hour&quot;, tabindex =&gt; $tabindex-&gt;(), disabled =&gt; $opts-&gt;{&#39;disabled_save&#39;} }) . &quot;&lt;span class=&#39;float-left&#39;&gt;:&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">1221</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$datetime .=   LJ::html_text({ size =&gt; 2, class =&gt; &#39;text&#39;, maxlength =&gt; 2, value =&gt; $min, name =&gt; &quot;min&quot;, tabindex =&gt; $tabindex-&gt;(), disabled =&gt; $opts-&gt;{&#39;disabled_save&#39;} });</td></tr>
<tr><td class="h">1222</td><td colspan="7"></td></tr><tr><td class="h">1223</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# JavaScript sets this value, so we know that the time we get is correct</td></tr>
<tr><td class="h">1224</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# but always trust the time if we&#39;ve been through the form already</td></tr>
<tr><td class="h">1225</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1225">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1225">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $date_diff = ($opts-&gt;{&#39;mode&#39;} eq &quot;edit&quot; || $opts-&gt;{&#39;spellcheck_html&#39;}) ? 1 : 0;</td></tr>
<tr><td class="h">1226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$datetime .= LJ::html_hidden(&quot;date_diff&quot;, $date_diff);</td></tr>
<tr><td class="h">1227</td><td colspan="7"></td></tr><tr><td class="h">1228</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# but if we don&#39;t have JS, give a signal to trust the given time</td></tr>
<tr><td class="h">1229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$datetime .= &quot;&lt;noscript&gt;&quot; .  LJ::html_hidden(&quot;date_diff_nojs&quot;, &quot;1&quot;) . &quot;&lt;/noscript&gt;&quot;;</td></tr>
<tr><td class="h">1230</td><td colspan="7"></td></tr><tr><td class="h">1231</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1232</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;modifydate&#39; class=&#39;left&#39;&gt;&quot; . BML::ml(&#39;entryform.date&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1233</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span id=&#39;currentdate&#39; class=&#39;float-left&#39;&gt;&lt;span id=&#39;currentdate-date&#39;&gt;$monthlong $mday, $year, $hour&quot; . &quot;:&quot; . &quot;$min&lt;/span&gt; &lt;a href=&#39;javascript:void(0)&#39; onclick=&#39;editdate();&#39; id=&#39;currentdate-edit&#39;&gt;&quot; . BML::ml(&#39;entryform.date.edit&#39;) . &quot;&lt;/a&gt;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1234</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span id=&#39;modifydate&#39;&gt;$datetime &lt;?de &quot; . BML::ml(&#39;entryform.date.24hournote&#39;) . &quot; de?&gt;&lt;br /&gt;\n&quot;;</td></tr>
<tr><td class="h">1235</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_check({ &#39;type&#39; =&gt; &quot;check&quot;, &#39;id&#39; =&gt; &quot;prop_opt_backdated&quot;,</td></tr>
<tr><td class="h">1236</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39; =&gt; &quot;prop_opt_backdated&quot;, &quot;value&quot; =&gt; 1,</td></tr>
<tr><td class="h">1237</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $opts-&gt;{&#39;prop_opt_backdated&#39;},</td></tr>
<tr><td class="h">1238</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() });</td></tr>
<tr><td class="h">1239</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_opt_backdated&#39; class=&#39;right&#39;&gt;&quot; . BML::ml(&#39;entryform.backdated3&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1240</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;backdate&quot;, &quot;&quot;, &quot;&quot;) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1241</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;&lt;!-- end #modifydate --&gt;\n&quot;;</td></tr>
<tr><td class="h">1242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1243</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;noscript&gt;&lt;p id=&#39;time-correct&#39; class=&#39;small&#39;&gt;&quot; . BML::ml(&#39;entryform.nojstime.note&#39;) . &quot;&lt;/p&gt;&lt;/noscript&gt;\n&quot;;</td></tr>
<tr><td class="h">1244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; defaultDate();&quot;;</td></tr>
<tr><td class="h">1245</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1246</td><td colspan="7"></td></tr><tr><td class="h">1247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# User Picture</td></tr>
<tr><td class="h">1248</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1248">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1248">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($res &amp;&amp; ref $res-&gt;{&#39;pickws&#39;} eq &#39;ARRAY&#39; &amp;&amp; scalar @{$res-&gt;{&#39;pickws&#39;}} &gt; 0) {</td></tr>
<tr><td class="h">1249</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @pickws = map { ($_, $_) } @{$res-&gt;{&#39;pickws&#39;}};</td></tr>
<tr><td class="h">1250</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $num = 0;</td></tr>
<tr><td class="h">1251</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpics .= &quot;    userpics[$num] = \&quot;$res-&gt;{&#39;defaultpicurl&#39;}\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1252</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (@{$res-&gt;{&#39;pickwurls&#39;}}) {</td></tr>
<tr><td class="h">1253</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num++;</td></tr>
<tr><td class="h">1254</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$userpics .= &quot;    userpics[$num] = \&quot;$_\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1255</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p id=&#39;userpic_select_wrapper&#39; class=&#39;pkg&#39; style=&#39;display: $userpic_display;&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1257</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_picture_keyword&#39; class=&#39;left&#39;&gt;&quot; . BML::ml(&#39;entryform.userpic&#39;) . &quot;&lt;/label&gt;\n&quot; ;</td></tr>
<tr><td class="h">1258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({&#39;name&#39; =&gt; &#39;prop_picture_keyword&#39;, &#39;id&#39; =&gt; &#39;prop_picture_keyword&#39;, &#39;class&#39; =&gt; &#39;select&#39;,</td></tr>
<tr><td class="h">1259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $opts-&gt;{&#39;prop_picture_keyword&#39;}, &#39;onchange&#39; =&gt; &quot;userpic_preview()&quot;,</td></tr>
<tr><td class="h">1260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() },</td></tr>
<tr><td class="h">1261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;, BML::ml(&#39;entryform.opt.defpic&#39;),</td></tr>
<tr><td class="h">1262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@pickws) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1263</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;a href=&#39;javascript:void(0);&#39; id=&#39;lj_userpicselect&#39;&gt; &lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">1264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# userpic browse button</td></tr>
<tr><td class="h">1265</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1265">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1265">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; insertViewThumbs();&quot; if LJ::is_enabled(&#39;userpicselect&#39;) &amp;&amp; $remote-&gt;get_cap(&#39;userpicselect&#39;);</td></tr>
<tr><td class="h">1266</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;userpics&quot;, &quot;&quot;, &quot; &quot;) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1267</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1268</td><td colspan="7"></td></tr><tr><td class="h">1269</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1270</td><td colspan="7"></td></tr><tr><td class="h">1271</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #metainfo --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1272</td><td colspan="7"></td></tr><tr><td class="h">1273</td><td colspan="7"></td></tr><tr><td class="h">1274</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;### Other Posting Options</td></tr>
<tr><td class="h">1275</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1276</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;infobox&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1277</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::run_hook(&#39;entryforminfo&#39;, $opts-&gt;{&#39;usejournal&#39;}, $opts-&gt;{&#39;remote&#39;});</td></tr>
<tr><td class="h">1278</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #infobox --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1279</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1280</td><td colspan="7"></td></tr><tr><td class="h">1281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;### Subject</td></tr>
<tr><td class="h">1282</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;compose-entry&#39; class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1283</td><td colspan="7"></td></tr><tr><td class="h">1284</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1284">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1284">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{prop_qotdid} &amp;&amp; !$opts-&gt;{richtext}) {</td></tr>
<tr><td class="h">1285</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $qotd = LJ::QotD-&gt;get_single_question($opts-&gt;{prop_qotdid});</td></tr>
<tr><td class="h">1286</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div style=&#39;margin-bottom: 10px;&#39; id=&#39;qotd_html_preview&#39;&gt;&quot; . LJ::Widget::QotD-&gt;qotd_display_embed( questions =&gt; [ $qotd ], no_answer_link =&gt; 1 ) . &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">1287</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1288</td><td colspan="7"></td></tr><tr><td class="h">1289</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label class=&#39;left&#39; for=&#39;subject&#39;&gt;&quot; . BML::ml(&#39;entryform.subject&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1290</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text({ &#39;name&#39; =&gt; &#39;subject&#39;, &#39;value&#39; =&gt; $opts-&gt;{&#39;subject&#39;},</td></tr>
<tr><td class="h">1291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39; =&gt; &#39;text&#39;, &#39;id&#39; =&gt; &#39;subject&#39;, &#39;size&#39; =&gt; &#39;43&#39;, &#39;maxlength&#39; =&gt; &#39;100&#39;,</td></tr>
<tr><td class="h">1292</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1293</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_save&#39;}}) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;ul id=&#39;entry-tabs&#39; style=&#39;display: none;&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1295</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1295">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;li id=&#39;jrich&#39;&gt;&quot; . BML::ml(&quot;entryform.htmlokay.rich4&quot;, { &#39;opts&#39; =&gt; &#39;href=&quot;javascript:void(0);&quot; onclick=&quot;return useRichText(\&#39;draft\&#39;, \&#39;&#39; . $LJ::WSTATPREFIX. &#39;\&#39;);&quot;&#39; })  . &quot;&lt;/li&gt;\n&quot; if $rte_is_supported;</td></tr>
<tr><td class="h">1296</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;li id=&#39;jplain&#39; class=&#39;on&#39;&gt;&quot; . BML::ml(&quot;entryform.plainswitch2&quot;, { &#39;aopts&#39; =&gt; &#39;href=&quot;javascript:void(0);&quot; onclick=&quot;return usePlainText(\&#39;draft\&#39;);&quot;&#39; }) . &quot;&lt;/li&gt;\n&quot;;</td></tr>
<tr><td class="h">1297</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/ul&gt;&quot;;</td></tr>
<tr><td class="h">1298</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #entry --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1299</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; showEntryTabs();&quot;;</td></tr>
<tr><td class="h">1300</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1301</td><td colspan="7"></td></tr><tr><td class="h">1302</td><td colspan="7"></td></tr><tr><td class="h">1303</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;### Display Spell Check Results:</td></tr>
<tr><td class="h">1304</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1304">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;spellcheck-results&#39;&gt;&lt;strong&gt;&quot; . BML::ml(&#39;entryform.spellchecked&#39;) . &quot;&lt;/strong&gt;&lt;br /&gt;$opts-&gt;{&#39;spellcheck_html&#39;}&lt;/div&gt;\n&quot;</td></tr>
<tr><td class="h">1305</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $opts-&gt;{&#39;spellcheck_html&#39;};</td></tr>
<tr><td class="h">1306</td><td colspan="7"></td></tr><tr><td class="h">1307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Insert Object Toolbar:</td></tr>
<tr><td class="h">1308</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(qw(</td></tr>
<tr><td class="h">1309</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/core.js</td></tr>
<tr><td class="h">1310</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/dom.js</td></tr>
<tr><td class="h">1311</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/ippu.js</td></tr>
<tr><td class="h">1312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/lj_ippu.js</td></tr>
<tr><td class="h">1313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</td></tr>
<tr><td class="h">1314</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;htmltools&#39; class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1315</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;ul class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1316</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;li class=&#39;image&#39;&gt;&lt;a href=&#39;javascript:void(0);&#39; onclick=&#39;InOb.handleInsertImage();&#39; title=&#39;&quot;</td></tr>
<tr><td class="h">1317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. BML::ml(&#39;fckland.ljimage&#39;) . &quot;&#39;&gt;&quot; . BML::ml(&#39;entryform.insert.image2&#39;) . &quot;&lt;/a&gt;&lt;/li&gt;\n&quot;;</td></tr>
<tr><td class="h">1318</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1318">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;li class=&#39;media&#39;&gt;&lt;a href=&#39;javascript:void(0);&#39; onclick=&#39;InOb.handleInsertEmbed();&#39; title=&#39;Embed Media&#39;&gt;&quot;</td></tr>
<tr><td class="h">1319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &quot;Embed Media&lt;/a&gt;&lt;/li&gt;\n&quot; if LJ::is_enabled(&#39;embed_module&#39;);</td></tr>
<tr><td class="h">1320</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/ul&gt;\n&quot;;</td></tr>
<tr><td class="h">1321</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1321">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1321">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format_selected = $opts-&gt;{&#39;prop_opt_preformatted&#39;} || $opts-&gt;{&#39;event_format&#39;} ? &quot;checked=&#39;checked&#39;&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">1322</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span id=&#39;linebreaks&#39;&gt;&lt;input type=&#39;checkbox&#39; class=&#39;check&#39; value=&#39;preformatted&#39; name=&#39;event_format&#39; id=&#39;event_format&#39; $format_selected  /&gt;</td></tr>
<tr><td class="h">1323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label for=&#39;event_format&#39;&gt;&quot; . BML::ml(&#39;entryform.format3&#39;) . &quot;&lt;/label&gt;&quot; . LJ::help_icon_html(&quot;noautoformat&quot;, &quot;&quot;, &quot; &quot;) . &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1324</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1325</td><td colspan="7"></td></tr><tr><td class="h">1326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Draft Status Area</td></tr>
<tr><td class="h">1327</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;draft-container&#39; class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1328</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_textarea({ &#39;name&#39; =&gt; &#39;event&#39;, &#39;value&#39; =&gt; $opts-&gt;{&#39;event&#39;},</td></tr>
<tr><td class="h">1329</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;rows&#39; =&gt; &#39;20&#39;, &#39;cols&#39; =&gt; &#39;50&#39;, &#39;style&#39; =&gt; &#39;&#39;,</td></tr>
<tr><td class="h">1330</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(), &#39;wrap&#39; =&gt; &#39;soft&#39;,</td></tr>
<tr><td class="h">1331</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_save&#39;},</td></tr>
<tr><td class="h">1332</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39; =&gt; &#39;draft&#39;}) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1333</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #draft-container --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1334</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;input type=&#39;text&#39; disabled=&#39;disabled&#39; name=&#39;draftstatus&#39; id=&#39;draftstatus&#39; /&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1335</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;stc/fck/fckeditor.js&#39;, &#39;js/rte.js&#39;, &#39;stc/display_none.css&#39;);</td></tr>
<tr><td class="h">1336</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1336">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!$opts-&gt;{&#39;did_spellcheck&#39;}) {</td></tr>
<tr><td class="h">1337</td><td colspan="7"></td></tr><tr><td class="h">1338</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $jnorich = LJ::ejs(LJ::deemp(BML::ml(&#39;entryform.htmlokay.norich2&#39;)));</td></tr>
<tr><td class="h">1339</td><td colspan="7"></td></tr><tr><td class="h">1340</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &lt;&lt;RTE;</td></tr>
<tr><td class="h">1341</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script language=&#39;JavaScript&#39; type=&#39;text/javascript&#39;&gt;</td></tr>
<tr><td class="h">1342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--</td></tr>
<tr><td class="h">1343</td><td colspan="7"></td></tr><tr><td class="h">1344</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check if this browser supports FCKeditor</td></tr>
<tr><td class="h">1345</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var rte = new FCKeditor();</td></tr>
<tr><td class="h">1346</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var t = rte._IsCompatibleBrowser();</td></tr>
<tr><td class="h">1347</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (t) {</td></tr>
<tr><td class="h">1348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">RTE</td></tr>
<tr><td class="h">1349</td><td colspan="7"></td></tr><tr><td class="h">1350</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;var FCKLang;\n&quot;;</td></tr>
<tr><td class="h">1351</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;if (!FCKLang) FCKLang = {};\n&quot;;</td></tr>
<tr><td class="h">1352</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.UserPrompt = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.userprompt&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1353</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.InvalidChars = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.invalidchars&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1354</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.LJUser = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.ljuser&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1355</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.VideoPrompt = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.videoprompt&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1356</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.LJVideo = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.ljvideo2&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1357</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.CutPrompt = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.cutprompt&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1358</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.ReadMore = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.readmore&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1359</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.CutContents = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.cutcontents&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1360</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;FCKLang.LJCut = \&quot;&quot;.LJ::ejs(BML::ml(&#39;fcklang.ljcut&#39;)).&quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1361</td><td colspan="7"></td></tr><tr><td class="h">1362</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1362">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;richtext_default&#39;}) {</td></tr>
<tr><td class="h">1363</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &#39;useRichText(&quot;draft&quot;, &quot;&#39; . LJ::ejs($LJ::WSTATPREFIX) . &#39;&quot;);&#39;;</td></tr>
<tr><td class="h">1364</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1365</td><td colspan="7"></td></tr><tr><td class="h">1366</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1367</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $jrich = LJ::ejs(LJ::deemp(</td></tr>
<tr><td class="h">1368</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BML::ml(&quot;entryform.htmlokay.rich2&quot;, { &#39;opts&#39; =&gt; &#39;href=&quot;javascript:void(0);&quot; onclick=&quot;return useRichText(\&#39;draft\&#39;, \&#39;&#39; . LJ::ejs($LJ::WSTATPREFIX) . &#39;\&#39;);&quot;&#39; })));</td></tr>
<tr><td class="h">1369</td><td colspan="7"></td></tr><tr><td class="h">1370</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $jplain = LJ::ejs(LJ::deemp(</td></tr>
<tr><td class="h">1371</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BML::ml(&quot;entryform.plainswitch&quot;, { &#39;aopts&#39; =&gt; &#39;href=&quot;javascript:void(0);&quot; onclick=&quot;return usePlainText(\&#39;draft\&#39;);&quot;&#39; })));</td></tr>
<tr><td class="h">1372</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1373</td><td colspan="7"></td></tr><tr><td class="h">1374</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &lt;&lt;RTE;</td></tr>
<tr><td class="h">1375</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1376</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById(&#39;entry-tabs&#39;).style.visibility = &#39;hidden&#39;;</td></tr>
<tr><td class="h">1377</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.getElementById(&#39;htmltools&#39;).style.display = &#39;block&#39;;</td></tr>
<tr><td class="h">1378</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document.write(&quot;$jnorich&quot;);</td></tr>
<tr><td class="h">1379</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usePlainText(&#39;draft&#39;);</td></tr>
<tr><td class="h">1380</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1381</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//--&gt;</td></tr>
<tr><td class="h">1382</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</td></tr>
<tr><td class="h">1383</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">RTE</td></tr>
<tr><td class="h">1384</td><td colspan="7"></td></tr><tr><td class="h">1385</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &#39;&lt;noscript&gt;&lt;?de &#39; . BML::ml(&#39;entryform.htmlokay.norich2&#39;) . &#39; de?&gt;&lt;br /&gt;&lt;/noscript&gt;&#39;;</td></tr>
<tr><td class="h">1386</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1387</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_hidden({ name =&gt; &#39;switched_rte_on&#39;, id =&gt; &#39;switched_rte_on&#39;, value =&gt; &#39;0&#39;});</td></tr>
<tr><td class="h">1388</td><td colspan="7"></td></tr><tr><td class="h">1389</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;options&#39; class=&#39;pkg&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1390</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1390">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (!$opts-&gt;{&#39;disabled_save&#39;}) {</td></tr>
<tr><td class="h">1391</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;### Options</td></tr>
<tr><td class="h">1392</td><td colspan="7"></td></tr><tr><td class="h">1393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Tag labeling</td></tr>
<tr><td class="h">1394</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1394">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled(&#39;tags&#39;) ) {</td></tr>
<tr><td class="h">1395</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1396</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_taglist&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.tags&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1397</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text(</td></tr>
<tr><td class="h">1398</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1399</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;      =&gt; &#39;prop_taglist&#39;,</td></tr>
<tr><td class="h">1400</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;        =&gt; &#39;prop_taglist&#39;,</td></tr>
<tr><td class="h">1401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39;     =&gt; &#39;text&#39;,</td></tr>
<tr><td class="h">1402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;size&#39;      =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1403</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;     =&gt; $opts-&gt;{&#39;prop_taglist&#39;},</td></tr>
<tr><td class="h">1404</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39;  =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1405</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;raw&#39;       =&gt; &quot;autocomplete=&#39;off&#39;&quot;,</td></tr>
<tr><td class="h">1406</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1407</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1408</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&#39;addtags&#39;);</td></tr>
<tr><td class="h">1409</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;&quot;;</td></tr>
<tr><td class="h">1410</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1411</td><td colspan="7"></td></tr><tr><td class="h">1412</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1413</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span id=&#39;prop_mood_wrapper&#39; class=&#39;inputgroup-left&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1414</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_current_moodid&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.mood&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1415</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Current Mood</td></tr>
<tr><td class="h">1416</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1417</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @moodlist = (&#39;&#39;, BML::ml(&#39;entryform.mood.noneother&#39;));</td></tr>
<tr><td class="h">1418</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sel;</td></tr>
<tr><td class="h">1419</td><td colspan="7"></td></tr><tr><td class="h">1420</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $moods = LJ::get_moods();</td></tr>
<tr><td class="h">1421</td><td colspan="7"></td></tr><tr><td class="h">1422</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach (sort { $moods-&gt;{$a}-&gt;{&#39;name&#39;} cmp $moods-&gt;{$b}-&gt;{&#39;name&#39;} } keys %$moods) {</td></tr>
<tr><td class="h">1423</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @moodlist, ($_, $moods-&gt;{$_}-&gt;{&#39;name&#39;});</td></tr>
<tr><td class="h">1424</td><td colspan="7"></td></tr><tr><td class="h">1425</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1425">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1425">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;prop_current_mood&#39;} eq $moods-&gt;{$_}-&gt;{&#39;name&#39;} ||</td></tr>
<tr><td class="h">1426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;prop_current_moodid&#39;} == $_) {</td></tr>
<tr><td class="h">1427</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sel = $_;</td></tr>
<tr><td class="h">1428</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1429</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1430</td><td colspan="7"></td></tr><tr><td class="h">1431</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1431">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($remote) {</td></tr>
<tr><td class="h">1432</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::load_mood_theme($remote-&gt;{&#39;moodthemeid&#39;});</td></tr>
<tr><td class="h">1433</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $mood (keys %$moods) {</td></tr>
<tr><td class="h">1434</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1434">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (LJ::get_mood_picture($remote-&gt;{&#39;moodthemeid&#39;}, $moods-&gt;{$mood}-&gt;{id}, \ my %pic)) {</td></tr>
<tr><td class="h">1435</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$moodlist .= &quot;    moods[&quot; . $moods-&gt;{$mood}-&gt;{id} . &quot;] = \&quot;&quot; . $moods-&gt;{$mood}-&gt;{name} . &quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$moodpics .= &quot;    moodpics[&quot; . $moods-&gt;{$mood}-&gt;{id} . &quot;] = \&quot;&quot; . $pic{pic} . &quot;\&quot;;\n&quot;;</td></tr>
<tr><td class="h">1437</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1438</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1439</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; mood_preview();&quot;;</td></tr>
<tr><td class="h">1440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$head .= &lt;&lt;MOODS;</td></tr>
<tr><td class="h">1441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript&quot;&gt;&lt;!--</td></tr>
<tr><td class="h">1442</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">if (document.getElementById) {</td></tr>
<tr><td class="h">1443</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var moodpics = new Array();</td></tr>
<tr><td class="h">1444</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$moodpics</td></tr>
<tr><td class="h">1445</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var moods    = new Array();</td></tr>
<tr><td class="h">1446</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$moodlist</td></tr>
<tr><td class="h">1447</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1448</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">//--&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">1449</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">MOODS</td></tr>
<tr><td class="h">1450</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1451</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $moodpreviewoc;</td></tr>
<tr><td class="h">1452</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1452">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$moodpreviewoc = &#39;mood_preview()&#39; if $remote;</td></tr>
<tr><td class="h">1453</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({ &#39;name&#39; =&gt; &#39;prop_current_moodid&#39;, &#39;id&#39; =&gt; &#39;prop_current_moodid&#39;,</td></tr>
<tr><td class="h">1454</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $sel, &#39;onchange&#39; =&gt; $moodpreviewoc, &#39;class&#39; =&gt; &#39;select&#39;,</td></tr>
<tr><td class="h">1455</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }, @moodlist);</td></tr>
<tr><td class="h">1456</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot; &quot; . LJ::html_text({ &#39;name&#39; =&gt; &#39;prop_current_mood&#39;, &#39;id&#39; =&gt; &#39;prop_current_mood&#39;, &#39;class&#39; =&gt; &#39;text&#39;,</td></tr>
<tr><td class="h">1457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39; =&gt; $opts-&gt;{&#39;prop_current_mood&#39;}, &#39;onchange&#39; =&gt; $moodpreviewoc,</td></tr>
<tr><td class="h">1458</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;size&#39; =&gt; &#39;15&#39;, &#39;maxlength&#39; =&gt; &#39;30&#39;,</td></tr>
<tr><td class="h">1459</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() });</td></tr>
<tr><td class="h">1460</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1461</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span id=&#39;mood_preview&#39;&gt;&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">1462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1463</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-right&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1464</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;comment_settings&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.comment.settings2&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1465</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Comment Settings</td></tr>
<tr><td class="h">1466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $comment_settings_selected = sub {</td></tr>
<tr><td class="h">1467</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1467">0</a></div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1467">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;noemail&quot; if $opts-&gt;{&#39;prop_opt_noemail&#39;};</td></tr>
<tr><td class="h">1468</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1468">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;nocomments&quot; if $opts-&gt;{&#39;prop_opt_nocomments&#39;};</td></tr>
<tr><td class="h">1469</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $opts-&gt;{&#39;comment_settings&#39;};</td></tr>
<tr><td class="h">1470</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1471</td><td colspan="7"></td></tr><tr><td class="h">1472</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $comment_settings_journaldefault = sub {</td></tr>
<tr><td class="h">1473</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1473">0</a></div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1473">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Disabled&quot; if $opts-&gt;{&#39;prop_opt_default_nocomments&#39;} eq &#39;N&#39;;</td></tr>
<tr><td class="h">1474</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1474">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;No Email&quot; if $opts-&gt;{&#39;prop_opt_default_noemail&#39;} eq &#39;N&#39;;</td></tr>
<tr><td class="h">1475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;Enabled&quot;;</td></tr>
<tr><td class="h">1476</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1477</td><td colspan="7"></td></tr><tr><td class="h">1478</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $comment_settings_default = BML::ml(&#39;entryform.comment.settings.default5&#39;, {&#39;aopts&#39; =&gt; $comment_settings_journaldefault-&gt;()});</td></tr>
<tr><td class="h">1479</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({ &#39;name&#39; =&gt; &quot;comment_settings&quot;, &#39;id&#39; =&gt; &#39;comment_settings&#39;, &#39;class&#39; =&gt; &#39;select&#39;, &#39;selected&#39; =&gt; $comment_settings_selected-&gt;(),</td></tr>
<tr><td class="h">1480</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() },</td></tr>
<tr><td class="h">1481</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;, $comment_settings_default, &quot;nocomments&quot;, BML::ml(&#39;entryform.comment.settings.nocomments&#39;,&quot;noemail&quot;), &quot;noemail&quot;, BML::ml(&#39;entryform.comment.settings.noemail&#39;));</td></tr>
<tr><td class="h">1482</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;comment&quot;, &quot;&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">1483</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;\n&quot;;</td></tr>
<tr><td class="h">1484</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1485</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1486</td><td colspan="7"></td></tr><tr><td class="h">1487</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Current Location</td></tr>
<tr><td class="h">1488</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1489</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1489">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled( &#39;web_current_location&#39; ) ) {</td></tr>
<tr><td class="h">1490</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-left&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1491</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_current_location&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml( &#39;entryform.location&#39; ) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1492</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text({ name =&gt; &#39;prop_current_location&#39;,</td></tr>
<tr><td class="h">1493</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; $opts-&gt;{prop_current_location},</td></tr>
<tr><td class="h">1494</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_current_location&#39;,</td></tr>
<tr><td class="h">1495</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class =&gt; &#39;text&#39;, size =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1496</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxlength =&gt; &#39;60&#39;,</td></tr>
<tr><td class="h">1497</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tabindex =&gt; $tabindex-&gt;() }) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1498</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">1499</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1500</td><td colspan="7"></td></tr><tr><td class="h">1501</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Comment Screening settings</td></tr>
<tr><td class="h">1502</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-right&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1503</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_opt_screening&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.comment.screening2&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1504</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1504">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1504">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1504">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1504">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $screening_levels_default = $opts-&gt;{&#39;prop_opt_default_screening&#39;} eq &#39;N&#39; ? BML::ml(&#39;label.screening.none2&#39;) :</td></tr>
<tr><td class="h">1505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;prop_opt_default_screening&#39;} eq &#39;R&#39; ? BML::ml(&#39;label.screening.anonymous2&#39;) :</td></tr>
<tr><td class="h">1506</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;prop_opt_default_screening&#39;} eq &#39;F&#39; ? BML::ml(&#39;label.screening.nonfriends2&#39;) :</td></tr>
<tr><td class="h">1507</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$opts-&gt;{&#39;prop_opt_default_screening&#39;} eq &#39;A&#39; ? BML::ml(&#39;label.screening.all2&#39;) : BML::ml(&#39;label.screening.none2&#39;);</td></tr>
<tr><td class="h">1508</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @levels = (&#39;&#39;, BML::ml(&#39;label.screening.default4&#39;, {&#39;aopts&#39;=&gt;$screening_levels_default}), &#39;N&#39;, BML::ml(&#39;label.screening.none2&#39;),</td></tr>
<tr><td class="h">1509</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;R&#39;, BML::ml(&#39;label.screening.anonymous2&#39;), &#39;F&#39;, BML::ml(&#39;label.screening.nonfriends2&#39;),</td></tr>
<tr><td class="h">1510</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;A&#39;, BML::ml(&#39;label.screening.all2&#39;));</td></tr>
<tr><td class="h">1511</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({ &#39;name&#39; =&gt; &#39;prop_opt_screening&#39;, &#39;id&#39; =&gt; &#39;prop_opt_screening&#39;, &#39;class&#39; =&gt; &#39;select&#39;, &#39;selected&#39; =&gt; $opts-&gt;{&#39;prop_opt_screening&#39;},</td></tr>
<tr><td class="h">1512</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }, @levels);</td></tr>
<tr><td class="h">1513</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;screening&quot;, &quot;&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">1514</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1515</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1516</td><td colspan="7"></td></tr><tr><td class="h">1517</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Current Music</td></tr>
<tr><td class="h">1518</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1519</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-left&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1520</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_current_music&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.music&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1521</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# BML::ml(&#39;entryform.music&#39;)</td></tr>
<tr><td class="h">1522</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text({ name =&gt; &#39;prop_current_music&#39;,</td></tr>
<tr><td class="h">1523</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; $opts-&gt;{prop_current_music},</td></tr>
<tr><td class="h">1524</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_current_music&#39;,</td></tr>
<tr><td class="h">1525</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class =&gt; &#39;text&#39;, size =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1526</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxlength =&gt; LJ::std_max_length(),</td></tr>
<tr><td class="h">1527</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tabindex =&gt; $tabindex-&gt;() }) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1528</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1529</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-right&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1530</td><td colspan="7"></td></tr><tr><td class="h">1531</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Content Flag</td></tr>
<tr><td class="h">1532</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1532">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled( &#39;adult_content&#39; ) ) {</td></tr>
<tr><td class="h">1533</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @adult_content_menu = (</td></tr>
<tr><td class="h">1534</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot; =&gt; BML::ml(&#39;entryform.adultcontent.default&#39;),</td></tr>
<tr><td class="h">1535</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;none =&gt; BML::ml(&#39;entryform.adultcontent.none&#39;),</td></tr>
<tr><td class="h">1536</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concepts =&gt; BML::ml(&#39;entryform.adultcontent.concepts&#39;),</td></tr>
<tr><td class="h">1537</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explicit =&gt; BML::ml(&#39;entryform.adultcontent.explicit&#39;),</td></tr>
<tr><td class="h">1538</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1539</td><td colspan="7"></td></tr><tr><td class="h">1540</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_adult_content&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.adultcontent&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1541</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1541">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({</td></tr>
<tr><td class="h">1542</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name =&gt; &#39;prop_adult_content&#39;,</td></tr>
<tr><td class="h">1543</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_adult_content&#39;,</td></tr>
<tr><td class="h">1544</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class =&gt; &#39;select&#39;,</td></tr>
<tr><td class="h">1545</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selected =&gt; $opts-&gt;{prop_adult_content} || &quot;&quot;,</td></tr>
<tr><td class="h">1546</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tabindex =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, @adult_content_menu);</td></tr>
<tr><td class="h">1548</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;adult_content&quot;, &quot;&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">1549</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1550</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1551</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1552</td><td colspan="7"></td></tr><tr><td class="h">1553</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1553">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled( &#39;adult_content&#39; ) ) {</td></tr>
<tr><td class="h">1554</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1555</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_adult_content_reason&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.adultcontentreason&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1556</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text(</td></tr>
<tr><td class="h">1557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;      =&gt; &#39;prop_adult_content_reason&#39;,</td></tr>
<tr><td class="h">1559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;        =&gt; &#39;prop_adult_content_reason&#39;,</td></tr>
<tr><td class="h">1560</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39;     =&gt; &#39;text&#39;,</td></tr>
<tr><td class="h">1561</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;size&#39;      =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1562</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maxlength&#39; =&gt; &#39;255&#39;,</td></tr>
<tr><td class="h">1563</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;     =&gt; $opts-&gt;{&#39;prop_adult_content_reason&#39;},</td></tr>
<tr><td class="h">1564</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39;  =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1565</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1566</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1567</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&#39;adult_content_reason&#39;);</td></tr>
<tr><td class="h">1568</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;&quot;;</td></tr>
<tr><td class="h">1569</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1570</td><td colspan="7"></td></tr><tr><td class="h">1571</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1571">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1571">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $remote &amp;&amp; ! $altlogin ) {</td></tr>
<tr><td class="h">1572</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# crosspost</td></tr>
<tr><td class="h">1573</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; LiveJournal.updateXpostFromJournal(&#39;$remote-&gt;{user}&#39;);&quot;;</td></tr>
<tr><td class="h">1574</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @accounts = DW::External::Account-&gt;get_external_accounts($remote);</td></tr>
<tr><td class="h">1575</td><td colspan="7"></td></tr><tr><td class="h">1576</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# populate the per-account html first, so that we only have to </td></tr>
<tr><td class="h">1577</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# go through them once.</td></tr>
<tr><td class="h">1578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $accthtml = &quot;&quot;;</td></tr>
<tr><td class="h">1579</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $xpostbydefault = 0;</td></tr>
<tr><td class="h">1580</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $xpost_tabindex = $tabindex-&gt;();</td></tr>
<tr><td class="h">1581</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1581">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $did_spellcheck = $opts-&gt;{ spellcheck_html } ? 1 : 0;</td></tr>
<tr><td class="h">1582</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1582">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (scalar @accounts) {</td></tr>
<tr><td class="h">1583</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $xpoststring = $opts-&gt;{prop_xpost};</td></tr>
<tr><td class="h">1584</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $xpost_selected = DW::External::Account-&gt;xpost_string_to_hash($xpoststring);</td></tr>
<tr><td class="h">1585</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $acct (@accounts) {</td></tr>
<tr><td class="h">1586</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print the checkbox for each account</td></tr>
<tr><td class="h">1587</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $acctid = $acct-&gt;acctid;</td></tr>
<tr><td class="h">1588</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $acctname = $acct-&gt;displayname;</td></tr>
<tr><td class="h">1589</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $selected;</td></tr>
<tr><td class="h">1590</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1590">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1590">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{mode} eq &#39;edit&#39;) {</td></tr>
<tr><td class="h">1591</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1591">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = $xpost_selected-&gt;{$acct-&gt;acctid} ? &quot;1&quot; : &quot;0&quot;;</td></tr>
<tr><td class="h">1592</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $did_spellcheck ) {</td></tr>
<tr><td class="h">1593</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = $opts-&gt;{ &quot;prop_xpost_$acctid&quot; };</td></tr>
<tr><td class="h">1594</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1595</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = $acct-&gt;xpostbydefault;</td></tr>
<tr><td class="h">1596</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1597</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$accthtml .= &quot;&lt;tr&gt;&lt;td&gt;&lt;label for=&#39;prop_xpost_$acctid&#39; class=&#39;left options&#39;&gt;$acctname&lt;/label&gt;&lt;/td&gt;\n&quot;;</td></tr>
<tr><td class="h">1598</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$accthtml .= &quot;&lt;td&gt;&quot; . LJ::html_check({</td></tr>
<tr><td class="h">1599</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;type&#39;     =&gt; &#39;checkbox&#39;,</td></tr>
<tr><td class="h">1600</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;     =&gt; &quot;prop_xpost_$acctid&quot;,</td></tr>
<tr><td class="h">1601</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;       =&gt; &quot;prop_xpost_$acctid&quot;,</td></tr>
<tr><td class="h">1602</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39;    =&gt; &#39;check xpost_acct_checkbox&#39;,</td></tr>
<tr><td class="h">1603</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;    =&gt; &#39;1&#39;,</td></tr>
<tr><td class="h">1604</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $selected,</td></tr>
<tr><td class="h">1605</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1606</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;onchange&#39; =&gt; &#39;LiveJournal.xpostAcctUpdated();&#39;,</td></tr>
<tr><td class="h">1607</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}) . &quot;&lt;/td&gt;\n&quot;;</td></tr>
<tr><td class="h">1608</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1608">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$xpostbydefault = 1 if $selected;</td></tr>
<tr><td class="h">1609</td><td colspan="7"></td></tr><tr><td class="h">1610</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# accounts with no password are disabled for now.</td></tr>
<tr><td class="h">1611</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$accthtml .= &quot;&lt;td&gt;&quot;;</td></tr>
<tr><td class="h">1612</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#unless ($acct-&gt;password) {</td></tr>
<tr><td class="h">1613</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# password field if no password</td></tr>
<tr><td class="h">1614</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    $accthtml .= &quot;&lt;label for=&#39;prop_xpost_password_$acctid&#39;&gt;&quot; . BML::ml(&#39;xpost.password&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1615</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    $accthtml .= LJ::html_text({</td></tr>
<tr><td class="h">1616</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;name&#39; =&gt; &quot;prop_xpost_password_$acctid&quot;,</td></tr>
<tr><td class="h">1617</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;id&#39; =&gt; &quot;prop_xpost_password_$acctid&quot;,</td></tr>
<tr><td class="h">1618</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;value&#39; =&gt; &quot;&quot;,</td></tr>
<tr><td class="h">1619</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;disabled&#39; =&gt; 0,</td></tr>
<tr><td class="h">1620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;size&#39; =&gt; 40,</td></tr>
<tr><td class="h">1621</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;maxlength&#39; =&gt; 80,</td></tr>
<tr><td class="h">1622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#        &#39;type&#39; =&gt; &#39;password&#39;</td></tr>
<tr><td class="h">1623</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#    });</td></tr>
<tr><td class="h">1624</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#}</td></tr>
<tr><td class="h">1625</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$accthtml .= &quot;&lt;/td&gt;\n&quot;;</td></tr>
<tr><td class="h">1626</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# do a challenge/response if available.</td></tr>
<tr><td class="h">1627</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#my $challenge = eval { $acct-&gt;challenge; };</td></tr>
<tr><td class="h">1628</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#if ($challenge) {</td></tr>
<tr><td class="h">1629</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$accthtml .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;prop_xpost_chal_$acctid&#39; id=&#39;prop_xpost_chal_$acctid&#39; class=&#39;xpost_chal&#39; value=&#39;$challenge&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">1630</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$accthtml .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;prop_xpost_chal_$acctid&#39; id=&#39;prop_xpost_chal_$acctid&#39; class=&#39;xpost_chal&#39; value=&#39;$acctid&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">1631</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#$accthtml .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;prop_xpost_resp_$acctid&#39; id=&#39;prop_xpost_resp_$acctid&#39;/&gt;&quot;;</td></tr>
<tr><td class="h">1632</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#}</td></tr>
<tr><td class="h">1633</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$accthtml .= &quot;&lt;/tr&gt;\n&quot;;</td></tr>
<tr><td class="h">1634</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1635</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1636</td><td colspan="7"></td></tr><tr><td class="h">1637</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;xpostdiv&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1638</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p&gt;&lt;label for=&#39;prop_xpost_check&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.xpost&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1639</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1639">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_check({</td></tr>
<tr><td class="h">1640</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;type&#39;     =&gt; &#39;checkbox&#39;,</td></tr>
<tr><td class="h">1641</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;     =&gt; &#39;prop_xpost_check&#39;,</td></tr>
<tr><td class="h">1642</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;       =&gt; &#39;prop_xpost_check&#39;,</td></tr>
<tr><td class="h">1643</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39;    =&gt; &#39;check&#39;,</td></tr>
<tr><td class="h">1644</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;    =&gt; &#39;1&#39;,</td></tr>
<tr><td class="h">1645</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $xpostbydefault,</td></tr>
<tr><td class="h">1646</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;disabled&#39; =&gt; (scalar @accounts) ? &#39;0&#39; : &#39;1&#39;,</td></tr>
<tr><td class="h">1647</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $xpost_tabindex,</td></tr>
<tr><td class="h">1648</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;onchange&#39; =&gt; &#39;LiveJournal.xpostButtonUpdated();&#39;,</td></tr>
<tr><td class="h">1649</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1650</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&#39;prop_xpost_check&#39;);</td></tr>
<tr><td class="h">1651</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;a href = &#39;/manage/settings/?cat=othersites&#39;&gt;&quot; . BML::ml(&#39;entryform.xpost.manage&#39;) . &quot;&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">1652</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&lt;table&gt;&quot;;</td></tr>
<tr><td class="h">1653</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= $accthtml;</td></tr>
<tr><td class="h">1654</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/table&gt;\n&quot;;</td></tr>
<tr><td class="h">1655</td><td colspan="7"></td></tr><tr><td class="h">1656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;\n&quot;;</td></tr>
<tr><td class="h">1657</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# disable choices if no xpost selected by default.</td></tr>
<tr><td class="h">1658</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= qq [ </td></tr>
<tr><td class="h">1659</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type=&quot;text/javascript&quot;&gt;</td></tr>
<tr><td class="h">1660</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LiveJournal.xpostAcctUpdated();</td></tr>
<tr><td class="h">1661</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</td></tr>
<tr><td class="h">1662</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p class=&#39;pkg&#39;&gt;</td></tr>
<tr><td class="h">1663</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class=&#39;inputgroup-left&#39;&gt;&lt;/span&gt;</td></tr>
<tr><td class="h">1664</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];</td></tr>
<tr><td class="h">1665</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1666</td><td colspan="7"></td></tr><tr><td class="h">1667</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;### Other Posting Options</td></tr>
<tr><td class="h">1668</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::run_hook(&#39;add_extra_entryform_fields&#39;, { opts =&gt; $opts, tabindex =&gt; $tabindex });</td></tr>
<tr><td class="h">1669</td><td colspan="7"></td></tr><tr><td class="h">1670</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;span class=&#39;inputgroup-right&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1671</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# extra submit button so make sure it posts the form when person presses enter key</td></tr>
<tr><td class="h">1672</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1672">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;edit&quot;) {</td></tr>
<tr><td class="h">1673</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;input type=&#39;submit&#39; name=&#39;action:save&#39; class=&#39;hidden_submit&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">1674</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1675</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1675">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;update&quot;) {</td></tr>
<tr><td class="h">1676</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;input type=&#39;submit&#39; name=&#39;action:update&#39; class=&#39;hidden_submit&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">1677</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1678</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $preview;</td></tr>
<tr><td class="h">1679</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$preview    = &quot;&lt;input type=&#39;button&#39; value=&#39;&quot; . BML::ml(&#39;entryform.preview&#39;) . &quot;&#39; onclick=&#39;entryPreview(this.form)&#39; tabindex=&#39;&quot; . $tabindex-&gt;() . &quot;&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">1680</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1680">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!$opts-&gt;{&#39;disabled_save&#39;}) {</td></tr>
<tr><td class="h">1681</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &lt;&lt;PREVIEW;</td></tr>
<tr><td class="h">1682</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; language=&quot;JavaScript&quot;&gt;</td></tr>
<tr><td class="h">1683</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;!--</td></tr>
<tr><td class="h">1684</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">if (document.getElementById) {</td></tr>
<tr><td class="h">1685</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;document.write(&quot;$preview &quot;);</td></tr>
<tr><td class="h">1686</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1687</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">//--&gt;</td></tr>
<tr><td class="h">1688</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;/script&gt;</td></tr>
<tr><td class="h">1689</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">PREVIEW</td></tr>
<tr><td class="h">1690</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1691</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1691">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1691">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($LJ::SPELLER &amp;&amp; !$opts-&gt;{&#39;disabled_save&#39;}) {</td></tr>
<tr><td class="h">1692</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:spellcheck&#39;, BML::ml(&#39;entryform.spellcheck&#39;), { &#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">1693</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1694</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/span&gt;\n&quot;;</td></tr>
<tr><td class="h">1695</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1696</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1697</td><td colspan="7"></td></tr><tr><td class="h">1698</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Community maintainer bar</td></tr>
<tr><td class="h">1699</td><td colspan="7"></td></tr><tr><td class="h">1700</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1700">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;maintainer_mode&#39;}) {</td></tr>
<tr><td class="h">1701</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1702</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;em&gt;&quot; . BML::ml(&#39;entryform.maintainer&#39;) . &quot;&lt;/em&gt;\n&quot;;</td></tr>
<tr><td class="h">1703</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1704</td><td colspan="7"></td></tr><tr><td class="h">1705</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1705">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled( &#39;adult_content&#39; ) ) {</td></tr>
<tr><td class="h">1706</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1707</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %poster_adult_content_menu = (</td></tr>
<tr><td class="h">1708</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot; =&gt; BML::ml(&#39;entryform.adultcontent.default&#39;),</td></tr>
<tr><td class="h">1709</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;none =&gt; BML::ml(&#39;entryform.adultcontent.none&#39;),</td></tr>
<tr><td class="h">1710</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concepts =&gt; BML::ml(&#39;entryform.adultcontent.concepts&#39;),</td></tr>
<tr><td class="h">1711</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explicit =&gt; BML::ml(&#39;entryform.adultcontent.explicit&#39;),</td></tr>
<tr><td class="h">1712</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1713</td><td colspan="7"></td></tr><tr><td class="h">1714</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @adult_content_menu = (</td></tr>
<tr><td class="h">1715</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot; =&gt; BML::ml(&#39;entryform.adultcontent.poster&#39;, {setting =&gt; $poster_adult_content_menu{$opts-&gt;{prop_adult_content}}}),</td></tr>
<tr><td class="h">1716</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;none =&gt; BML::ml(&#39;entryform.adultcontent.none&#39;),</td></tr>
<tr><td class="h">1717</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concepts =&gt; BML::ml(&#39;entryform.adultcontent.concepts&#39;),</td></tr>
<tr><td class="h">1718</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explicit =&gt; BML::ml(&#39;entryform.adultcontent.explicit&#39;),</td></tr>
<tr><td class="h">1719</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1720</td><td colspan="7"></td></tr><tr><td class="h">1721</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_adult_content_maintainer&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.adultcontent.maintainer&#39;) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1722</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1722">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({</td></tr>
<tr><td class="h">1723</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name =&gt; &#39;prop_adult_content_maintainer&#39;,</td></tr>
<tr><td class="h">1724</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_adult_content_maintainer&#39;,</td></tr>
<tr><td class="h">1725</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class =&gt; &#39;select&#39;,</td></tr>
<tr><td class="h">1726</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selected =&gt; $opts-&gt;{prop_adult_content_maintainer} || &quot;&quot;,</td></tr>
<tr><td class="h">1727</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tabindex =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1728</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}, @adult_content_menu);</td></tr>
<tr><td class="h">1729</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&quot;adult_content&quot;, &quot;&quot;, &quot; &quot;);</td></tr>
<tr><td class="h">1730</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;\n&quot;;</td></tr>
<tr><td class="h">1731</td><td colspan="7"></td></tr><tr><td class="h">1732</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;p class=&#39;pkg&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1733</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;prop_adult_content_maintainer_reason&#39; class=&#39;left options&#39;&gt;&quot; . BML::ml(&#39;entryform.adultcontentreason.maintainer&#39;) . &quot;&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">1734</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_text(</td></tr>
<tr><td class="h">1735</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1736</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;      =&gt; &#39;prop_adult_content_maintainer_reason&#39;,</td></tr>
<tr><td class="h">1737</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;        =&gt; &#39;prop_adult_content_maintainer_reason&#39;,</td></tr>
<tr><td class="h">1738</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39;     =&gt; &#39;text&#39;,</td></tr>
<tr><td class="h">1739</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;size&#39;      =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1740</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maxlength&#39; =&gt; &#39;255&#39;,</td></tr>
<tr><td class="h">1741</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39;     =&gt; $opts-&gt;{&#39;prop_adult_content_maintainer_reason&#39;},</td></tr>
<tr><td class="h">1742</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39;  =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1743</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1744</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1745</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon_html(&#39;adult_content_reason&#39;);</td></tr>
<tr><td class="h">1746</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/p&gt;&quot;;</td></tr>
<tr><td class="h">1747</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1748</td><td colspan="7"></td></tr><tr><td class="h">1749</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1750</td><td colspan="7"></td></tr><tr><td class="h">1751</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #options --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1752</td><td colspan="7"></td></tr><tr><td class="h">1753</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;### Submit Bar</td></tr>
<tr><td class="h">1754</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">1755</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;submitbar&#39; class=&#39;pkg&#39;&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1756</td><td colspan="7"></td></tr><tr><td class="h">1757</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;security_container&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1758</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;security&#39;&gt;&quot; . BML::ml(&#39;entryform.security2&#39;) . &quot; &lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1759</td><td colspan="7"></td></tr><tr><td class="h">1760</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Security</td></tr>
<tr><td class="h">1761</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1761">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1761">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;update&quot; || !$opts-&gt;{&#39;disabled_save&#39;}) {</td></tr>
<tr><td class="h">1762</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $usejournalu = LJ::load_user($opts-&gt;{usejournal});</td></tr>
<tr><td class="h">1763</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1763">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1763">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $is_comm = $usejournalu &amp;&amp; $usejournalu-&gt;is_comm ? 1 : 0;</td></tr>
<tr><td class="h">1764</td><td colspan="7"></td></tr><tr><td class="h">1765</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $string_public = LJ::ejs(BML::ml(&#39;label.security.public2&#39;));</td></tr>
<tr><td class="h">1766</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $string_friends = LJ::ejs(BML::ml(&#39;label.security.accesslist&#39;));</td></tr>
<tr><td class="h">1767</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $string_friends_comm = LJ::ejs(BML::ml(&#39;label.security.members&#39;));</td></tr>
<tr><td class="h">1768</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $string_private = LJ::ejs(BML::ml(&#39;label.security.private2&#39;));</td></tr>
<tr><td class="h">1769</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $string_custom = LJ::ejs(BML::ml(&#39;label.security.custom&#39;));</td></tr>
<tr><td class="h">1770</td><td colspan="7"></td></tr><tr><td class="h">1771</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= qq{</td></tr>
<tr><td class="h">1772</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&gt;var UpdateFormStrings = new Object();</td></tr>
<tr><td class="h">1773</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateFormStrings.public = &quot;$string_public&quot;;</td></tr>
<tr><td class="h">1774</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateFormStrings.friends = &quot;$string_friends&quot;;</td></tr>
<tr><td class="h">1775</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateFormStrings.friends_comm = &quot;$string_friends_comm&quot;;</td></tr>
<tr><td class="h">1776</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateFormStrings.private = &quot;$string_private&quot;;</td></tr>
<tr><td class="h">1777</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateFormStrings.custom = &quot;$string_custom&quot;;&lt;/script&gt;</td></tr>
<tr><td class="h">1778</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">1779</td><td colspan="7"></td></tr><tr><td class="h">1780</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1780">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; setColumns();&quot; if $remote;</td></tr>
<tr><td class="h">1781</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1781">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @secs = (&quot;public&quot;, $string_public, &quot;friends&quot;, $is_comm ? $string_friends_comm : $string_friends);</td></tr>
<tr><td class="h">1782</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1782">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @secs, (&quot;private&quot;, $string_private) unless $is_comm;</td></tr>
<tr><td class="h">1783</td><td colspan="7"></td></tr><tr><td class="h">1784</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( @secopts, @trust_groups );</td></tr>
<tr><td class="h">1785</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1785">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@trust_groups = $remote-&gt;trust_groups if $remote;</td></tr>
<tr><td class="h">1786</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1786">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1786">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( scalar @trust_groups &amp;&amp; !$is_comm ) {</td></tr>
<tr><td class="h">1787</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @secs, (&quot;custom&quot;, $string_custom);</td></tr>
<tr><td class="h">1788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @secopts, (&quot;onchange&quot; =&gt; &quot;customboxes()&quot;);</td></tr>
<tr><td class="h">1789</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1790</td><td colspan="7"></td></tr><tr><td class="h">1791</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_select({ &#39;id&#39; =&gt; &quot;security&quot;, &#39;name&#39; =&gt; &#39;security&#39;, &#39;include_ids&#39; =&gt; 1,</td></tr>
<tr><td class="h">1792</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;class&#39; =&gt; &#39;select&#39;, &#39;selected&#39; =&gt; $opts-&gt;{&#39;security&#39;},</td></tr>
<tr><td class="h">1793</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(), @secopts }, @secs) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1794</td><td colspan="7"></td></tr><tr><td class="h">1795</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if custom security groups available, show them in a hideable div</td></tr>
<tr><td class="h">1796</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1796">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( scalar @trust_groups ) {</td></tr>
<tr><td class="h">1797</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1797">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $display = $opts-&gt;{&#39;security&#39;} eq &quot;custom&quot; ? &quot;block&quot; : &quot;none&quot;;</td></tr>
<tr><td class="h">1798</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::help_icon(&quot;security&quot;, &quot;&lt;span id=&#39;security-help&#39;&gt;\n&quot;, &quot;\n&lt;/span&gt;\n&quot;);</td></tr>
<tr><td class="h">1799</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;div id=&#39;custom_boxes&#39; class=&#39;pkg&#39; style=&#39;display: $display;&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1800</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;ul id=&#39;custom_boxes_list&#39;&gt;&quot;;</td></tr>
<tr><td class="h">1801</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $group ( @trust_groups ) {</td></tr>
<tr><td class="h">1802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $fg = $group-&gt;{groupnum};</td></tr>
<tr><td class="h">1803</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;li&gt;&quot;;</td></tr>
<tr><td class="h">1804</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1804">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_check({ &#39;name&#39; =&gt; &quot;custom_bit_$fg&quot;,</td></tr>
<tr><td class="h">1805</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39; =&gt; &quot;custom_bit_$fg&quot;,</td></tr>
<tr><td class="h">1806</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;selected&#39; =&gt; $opts-&gt;{&quot;custom_bit_$fg&quot;} || $opts-&gt;{&#39;security_mask&#39;}+0 &amp; 1 &lt;&lt; $fg }) . &quot; &quot;;</td></tr>
<tr><td class="h">1807</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;label for=&#39;custom_bit_$fg&#39;&gt;&quot; . LJ::ehtml( $group-&gt;{groupname} ) . &quot;&lt;/label&gt;\n&quot;;</td></tr>
<tr><td class="h">1808</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/li&gt;&quot;;</td></tr>
<tr><td class="h">1809</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1810</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/ul&gt;&quot;;</td></tr>
<tr><td class="h">1811</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #custom_boxes --&gt;\n&quot;;</td></tr>
<tr><td class="h">1812</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1813</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1814</td><td colspan="7"></td></tr><tr><td class="h">1815</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1815">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;update&quot;) {</td></tr>
<tr><td class="h">1816</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $onclick = &quot;&quot;;</td></tr>
<tr><td class="h">1817</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1817">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$onclick .= &quot;return sendForm(&#39;updateForm&#39;);&quot; if ! $LJ::IS_SSL;</td></tr>
<tr><td class="h">1818</td><td colspan="7"></td></tr><tr><td class="h">1819</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $defaultjournal;</td></tr>
<tr><td class="h">1820</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $not_a_journal = 0;</td></tr>
<tr><td class="h">1821</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1821">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1821">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1821">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;usejournal&#39;}) {</td></tr>
<tr><td class="h">1822</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultjournal = $opts-&gt;{&#39;usejournal&#39;};</td></tr>
<tr><td class="h">1823</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($remote &amp;&amp; $opts-&gt;{auth_as_remote}) {</td></tr>
<tr><td class="h">1824</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultjournal = $remote-&gt;user;</td></tr>
<tr><td class="h">1825</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1826</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$defaultjournal = &quot;Journal&quot;;</td></tr>
<tr><td class="h">1827</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$not_a_journal = 1;</td></tr>
<tr><td class="h">1828</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1829</td><td colspan="7"></td></tr><tr><td class="h">1830</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; changeSubmit(&#39;&quot; . BML::ml(&#39;entryform.update3&#39;) . &quot;&#39;, &#39;$defaultjournal&#39;);&quot;;</td></tr>
<tr><td class="h">1831</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1831">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; getUserTags(&#39;$defaultjournal&#39;);&quot; unless $not_a_journal;</td></tr>
<tr><td class="h">1832</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1832">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$$onload .= &quot; changeSecurityOptions(&#39;$defaultjournal&#39;);&quot; unless $opts-&gt;{&#39;security&#39;};</td></tr>
<tr><td class="h">1833</td><td colspan="7"></td></tr><tr><td class="h">1834</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:update&#39;, BML::ml(&#39;entryform.update4&#39;),</td></tr>
<tr><td class="h">1835</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;onclick&#39; =&gt; $onclick, &#39;class&#39; =&gt; &#39;submit&#39;, &#39;id&#39; =&gt; &#39;formsubmit&#39;,</td></tr>
<tr><td class="h">1836</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;&amp;nbsp;\n&quot;; }</td></tr>
<tr><td class="h">1837</td><td colspan="7"></td></tr><tr><td class="h">1838</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1838">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($opts-&gt;{&#39;mode&#39;} eq &quot;edit&quot;) {</td></tr>
<tr><td class="h">1839</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $onclick = &quot;&quot;;</td></tr>
<tr><td class="h">1840</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1840">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$onclick .= &quot;return true;&quot; if ! $LJ::IS_SSL;</td></tr>
<tr><td class="h">1841</td><td colspan="7"></td></tr><tr><td class="h">1842</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1842">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$opts-&gt;{&#39;disabled_save&#39;}) {</td></tr>
<tr><td class="h">1843</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:save&#39;, BML::ml(&#39;entryform.save&#39;),</td></tr>
<tr><td class="h">1844</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;onclick&#39; =&gt; $onclick, &#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_save&#39;},</td></tr>
<tr><td class="h">1845</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;&amp;nbsp;\n&quot;;</td></tr>
<tr><td class="h">1846</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">1847</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:savemaintainer&#39;, BML::ml(&#39;entryform.save.maintainer&#39;),</td></tr>
<tr><td class="h">1848</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;onclick&#39; =&gt; $onclick, &#39;disabled&#39; =&gt; !$opts-&gt;{&#39;maintainer_mode&#39;},</td></tr>
<tr><td class="h">1849</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;&amp;nbsp;\n&quot;;</td></tr>
<tr><td class="h">1850</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1851</td><td colspan="7"></td></tr><tr><td class="h">1852</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1852">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L1852">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$opts-&gt;{&#39;disabled_save&#39;} &amp;&amp; $opts-&gt;{suspended} &amp;&amp; !$opts-&gt;{unsuspend_supportid}) {</td></tr>
<tr><td class="h">1853</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:saveunsuspend&#39;, BML::ml(&#39;entryform.saveandrequestunsuspend2&#39;),</td></tr>
<tr><td class="h">1854</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &#39;onclick&#39; =&gt; $onclick, &#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_save&#39;},</td></tr>
<tr><td class="h">1855</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;&amp;nbsp;\n&quot;;</td></tr>
<tr><td class="h">1856</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1857</td><td colspan="7"></td></tr><tr><td class="h">1858</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# do a double-confirm on delete if we have crossposts that</td></tr>
<tr><td class="h">1859</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# would also get removed</td></tr>
<tr><td class="h">1860</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $delete_onclick = &quot;return LiveJournal.confirmDelete(&#39;&quot; . LJ::ejs(BML::ml(&#39;entryform.delete.confirm&#39;)) . &quot;&#39;, &#39;&quot; . LJ::ejs(BML::ml(&#39;entryform.delete.xposts.confirm&#39;)) . &quot;&#39;)&quot;;</td></tr>
<tr><td class="h">1861</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:delete&#39;, BML::ml(&#39;entryform.delete&#39;), {</td></tr>
<tr><td class="h">1862</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;disabled&#39; =&gt; $opts-&gt;{&#39;disabled_delete&#39;},</td></tr>
<tr><td class="h">1863</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;(),</td></tr>
<tr><td class="h">1864</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;onclick&#39; =&gt; $delete_onclick }) . &quot;&amp;nbsp;\n&quot;;</td></tr>
<tr><td class="h">1865</td><td colspan="7"></td></tr><tr><td class="h">1866</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1866">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$opts-&gt;{&#39;disabled_spamdelete&#39;}) {</td></tr>
<tr><td class="h">1867</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= LJ::html_submit(&#39;action:deletespam&#39;, BML::ml(&#39;entryform.deletespam&#39;), {</td></tr>
<tr><td class="h">1868</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;onclick&#39; =&gt; &quot;return confirm(&#39;&quot; . LJ::ejs(BML::ml(&#39;entryform.deletespam.confirm&#39;)) . &quot;&#39;)&quot;,</td></tr>
<tr><td class="h">1869</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;tabindex&#39; =&gt; $tabindex-&gt;() }) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1870</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1871</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1872</td><td colspan="7"></td></tr><tr><td class="h">1873</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #security_container --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1874</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #submitbar --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1875</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/div&gt;&lt;!-- end #entry-form-wrapper --&gt;\n\n&quot;;</td></tr>
<tr><td class="h">1876</td><td colspan="7"></td></tr><tr><td class="h">1877</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;script  type=&#39;text/javascript&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">1878</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;// &lt;![CDATA[ \n &quot;;</td></tr>
<tr><td class="h">1879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;init_update_bml() \n&quot;;</td></tr>
<tr><td class="h">1880</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;// ]]&gt;\n&quot;;</td></tr>
<tr><td class="h">1881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$out .= &quot;&lt;/script&gt;\n&quot;;</td></tr>
<tr><td class="h">1882</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1883</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $out;</td></tr>
<tr><td class="h">1884</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1885</td><td colspan="7"></td></tr><tr><td class="h">1886</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># entry form subject</td></tr>
<tr><td class="h">1887</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_subject_widget {</td></tr>
<tr><td class="h">1888</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1888">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">1889</td><td colspan="7"></td></tr><tr><td class="h">1890</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1890">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($class) {</td></tr>
<tr><td class="h">1891</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class = qq { class=&quot;$class&quot; };</td></tr>
<tr><td class="h">1892</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1893</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return qq { &lt;input name=&quot;subject&quot; id=&quot;subject&quot; $class/&gt; };</td></tr>
<tr><td class="h">1894</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1895</td><td colspan="7"></td></tr><tr><td class="h">1896</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># entry form hidden date field</td></tr>
<tr><td class="h">1897</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_date_widget {</td></tr>
<tr><td class="h">1898</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1898">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);</td></tr>
<tr><td class="h">1899</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$year+=1900;</td></tr>
<tr><td class="h">1900</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$mon=sprintf(&quot;%02d&quot;, $mon+1);</td></tr>
<tr><td class="h">1901</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$mday=sprintf(&quot;%02d&quot;, $mday);</td></tr>
<tr><td class="h">1902</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$min=sprintf(&quot;%02d&quot;, $min);</td></tr>
<tr><td class="h">1903</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return LJ::html_hidden({&#39;name&#39; =&gt; &#39;date_ymd_yyyy&#39;, &#39;value&#39; =&gt; $year, &#39;id&#39; =&gt; &#39;update_year&#39;},</td></tr>
<tr><td class="h">1904</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;date_ymd_dd&#39;, &#39;value&#39;  =&gt; $mday, &#39;id&#39; =&gt; &#39;update_day&#39;},</td></tr>
<tr><td class="h">1905</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;date_ymd_mm&#39;, &#39;value&#39;  =&gt; $mon,  &#39;id&#39; =&gt; &#39;update_mon&#39;},</td></tr>
<tr><td class="h">1906</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;hour&#39;, &#39;value&#39; =&gt; $hour, &#39;id&#39; =&gt; &#39;update_hour&#39;},</td></tr>
<tr><td class="h">1907</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#39;name&#39; =&gt; &#39;min&#39;, &#39;value&#39;  =&gt; $min,  &#39;id&#39; =&gt; &#39;update_min&#39;});</td></tr>
<tr><td class="h">1908</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1909</td><td colspan="7"></td></tr><tr><td class="h">1910</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># entry form event text box</td></tr>
<tr><td class="h">1911</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_entry_widget {</td></tr>
<tr><td class="h">1912</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1912">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">1913</td><td colspan="7"></td></tr><tr><td class="h">1914</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1914">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($class) {</td></tr>
<tr><td class="h">1915</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$class = qq { class=&quot;$class&quot; };</td></tr>
<tr><td class="h">1916</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">1917</td><td colspan="7"></td></tr><tr><td class="h">1918</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return qq { &lt;textarea cols=50 rows=10 name=&quot;event&quot; id=&quot;event&quot; $class&gt;&lt;/textarea&gt; };</td></tr>
<tr><td class="h">1919</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1920</td><td colspan="7"></td></tr><tr><td class="h">1921</td><td colspan="7"></td></tr><tr><td class="h">1922</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># entry form &quot;journals can post to&quot; dropdown</td></tr>
<tr><td class="h">1923</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># NOTE!!! returns undef if no other journals user can post to</td></tr>
<tr><td class="h">1924</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_postto_widget {</td></tr>
<tr><td class="h">1925</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1925">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = shift;</td></tr>
<tr><td class="h">1926</td><td colspan="7"></td></tr><tr><td class="h">1927</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1927">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless LJ::isu($remote);</td></tr>
<tr><td class="h">1928</td><td colspan="7"></td></tr><tr><td class="h">1929</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">1930</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# log in to get journals can post to</td></tr>
<tr><td class="h">1931</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $res;</td></tr>
<tr><td class="h">1932</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$res = LJ::Protocol::do_request(&quot;login&quot;, {</td></tr>
<tr><td class="h">1933</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;ver&quot; =&gt; $LJ::PROTOCOL_VER,</td></tr>
<tr><td class="h">1934</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;username&quot; =&gt; $remote-&gt;{&#39;user&#39;},</td></tr>
<tr><td class="h">1935</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}, undef, {</td></tr>
<tr><td class="h">1936</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;noauth&quot; =&gt; 1,</td></tr>
<tr><td class="h">1937</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;u&quot; =&gt; $remote,</td></tr>
<tr><td class="h">1938</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1939</td><td colspan="7"></td></tr><tr><td class="h">1940</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1940">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless $res;</td></tr>
<tr><td class="h">1941</td><td colspan="7"></td></tr><tr><td class="h">1942</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @journals = map { $_, $_ } @{$res-&gt;{&#39;usejournals&#39;}};</td></tr>
<tr><td class="h">1943</td><td colspan="7"></td></tr><tr><td class="h">1944</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1944">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless @journals;</td></tr>
<tr><td class="h">1945</td><td colspan="7"></td></tr><tr><td class="h">1946</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @journals, $remote-&gt;{&#39;user&#39;};</td></tr>
<tr><td class="h">1947</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @journals, $remote-&gt;{&#39;user&#39;};</td></tr>
<tr><td class="h">1948</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@journals = sort @journals;</td></tr>
<tr><td class="h">1949</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_select( { name =&gt; &#39;usejournal&#39;, id =&gt; &#39;usejournal&#39;, selected =&gt; $remote-&gt;user }, @journals ) . &quot;\n&quot;;</td></tr>
<tr><td class="h">1950</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">1951</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1952</td><td colspan="7"></td></tr><tr><td class="h">1953</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_security_widget {</td></tr>
<tr><td class="h">1954</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1954">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &#39;&#39;;</td></tr>
<tr><td class="h">1955</td><td colspan="7"></td></tr><tr><td class="h">1956</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @secs = ( &quot;public&quot;, BML::ml( &#39;label.security.public2&#39; ),</td></tr>
<tr><td class="h">1957</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;friends&quot;, BML::ml( &#39;label.security.accesslist&#39; ),</td></tr>
<tr><td class="h">1958</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;private&quot;, BML::ml( &#39;label.security.private2&#39; ) );</td></tr>
<tr><td class="h">1959</td><td colspan="7"></td></tr><tr><td class="h">1960</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_select( { name =&gt; &#39;security&#39;, id =&gt; &#39;security&#39; },</td></tr>
<tr><td class="h">1961</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@secs );</td></tr>
<tr><td class="h">1962</td><td colspan="7"></td></tr><tr><td class="h">1963</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">1964</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1965</td><td colspan="7"></td></tr><tr><td class="h">1966</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_tags_widget {</td></tr>
<tr><td class="h">1967</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1967">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &#39;&#39;;</td></tr>
<tr><td class="h">1968</td><td colspan="7"></td></tr><tr><td class="h">1969</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1969">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &#39;&#39; unless LJ::is_enabled(&#39;tags&#39;);</td></tr>
<tr><td class="h">1970</td><td colspan="7"></td></tr><tr><td class="h">1971</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_text({</td></tr>
<tr><td class="h">1972</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;name&#39;      =&gt; &#39;prop_taglist&#39;,</td></tr>
<tr><td class="h">1973</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;        =&gt; &#39;prop_taglist&#39;,</td></tr>
<tr><td class="h">1974</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;size&#39;      =&gt; &#39;35&#39;,</td></tr>
<tr><td class="h">1975</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maxlength&#39; =&gt; &#39;255&#39;,</td></tr>
<tr><td class="h">1976</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">1977</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::help_icon(&#39;addtags&#39;);</td></tr>
<tr><td class="h">1978</td><td colspan="7"></td></tr><tr><td class="h">1979</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">1980</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">1981</td><td colspan="7"></td></tr><tr><td class="h">1982</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_usericon_widget {</td></tr>
<tr><td class="h">1983</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L1983">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = shift;</td></tr>
<tr><td class="h">1984</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1984">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return undef unless LJ::isu( $remote );</td></tr>
<tr><td class="h">1985</td><td colspan="7"></td></tr><tr><td class="h">1986</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">1987</td><td colspan="7"></td></tr><tr><td class="h">1988</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %res;</td></tr>
<tr><td class="h">1989</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::do_request({ mode =&gt; &quot;login&quot;,</td></tr>
<tr><td class="h">1990</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ver =&gt; $LJ::PROTOCOL_VER,</td></tr>
<tr><td class="h">1991</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user =&gt; $remote-&gt;user,</td></tr>
<tr><td class="h">1992</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getpickws =&gt; 1, },</td></tr>
<tr><td class="h">1993</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\%res, { noauth =&gt; 1, userid =&gt; $remote-&gt;userid }</td></tr>
<tr><td class="h">1994</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">1995</td><td colspan="7"></td></tr><tr><td class="h">1996</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L1996">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($res{pickw_count}) {</td></tr>
<tr><td class="h">1997</td><td colspan="7"></td></tr><tr><td class="h">1998</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @icons;</td></tr>
<tr><td class="h">1999</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for ( my $i = 1; $i &lt;= $res{pickw_count}; $i++ ) {</td></tr>
<tr><td class="h">2000</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @icons, $res{&quot;pickw_$i&quot;};</td></tr>
<tr><td class="h">2001</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2002</td><td colspan="7"></td></tr><tr><td class="h">2003</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@icons = sort { lc( $a ) cmp lc( $b ) } @icons;</td></tr>
<tr><td class="h">2004</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_select( { name =&gt; &#39;prop_picture_keyword&#39;,</td></tr>
<tr><td class="h">2005</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_picture_keyword&#39; },</td></tr>
<tr><td class="h">2006</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &quot;&quot;, BML::ml( &#39;entryform.opt.defpic&#39; ),</td></tr>
<tr><td class="h">2007</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { ( $_, $_ ) } @icons )</td></tr>
<tr><td class="h">2008</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">2009</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2010</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2011</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2012</td><td colspan="7"></td></tr><tr><td class="h">2013</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_xpost_widget {</td></tr>
<tr><td class="h">2014</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2014">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $remote ) = @_;</td></tr>
<tr><td class="h">2015</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2015">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $remote;</td></tr>
<tr><td class="h">2016</td><td colspan="7"></td></tr><tr><td class="h">2017</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">2018</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @accounts = DW::External::Account-&gt;get_external_accounts( $remote );</td></tr>
<tr><td class="h">2019</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@accounts = grep { $_-&gt;xpostbydefault } @accounts;</td></tr>
<tr><td class="h">2020</td><td colspan="7"></td></tr><tr><td class="h">2021</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2021">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( @accounts ) {</td></tr>
<tr><td class="h">2022</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden( {</td></tr>
<tr><td class="h">2023</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name =&gt; &#39;prop_xpost_check&#39;, </td></tr>
<tr><td class="h">2024</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &#39;prop_xpost_check&#39;,</td></tr>
<tr><td class="h">2025</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; 1,</td></tr>
<tr><td class="h">2026</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} );</td></tr>
<tr><td class="h">2027</td><td colspan="7"></td></tr><tr><td class="h">2028</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $acct ( @accounts ) {</td></tr>
<tr><td class="h">2029</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $acctid = $acct-&gt;acctid;</td></tr>
<tr><td class="h">2030</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden( {</td></tr>
<tr><td class="h">2031</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name =&gt; &quot;prop_xpost_$acctid&quot;,</td></tr>
<tr><td class="h">2032</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id =&gt; &quot;prop_xpost_$acctid&quot;,</td></tr>
<tr><td class="h">2033</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; 1,</td></tr>
<tr><td class="h">2034</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} );</td></tr>
<tr><td class="h">2035</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2036</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2037</td><td colspan="7"></td></tr><tr><td class="h">2038</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2039</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2040</td><td colspan="7"></td></tr><tr><td class="h">2041</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">2042</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::entry_form_decode</td></tr>
<tr><td class="h">2043</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">2044</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Decodes an entry_form into a protocol-compatible hash.</td></tr>
<tr><td class="h">2045</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># info: Generate form with [func[LJ::entry_form]].</td></tr>
<tr><td class="h">2046</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: req, post</td></tr>
<tr><td class="h">2047</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-req: protocol request hash to build.</td></tr>
<tr><td class="h">2048</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des-post: entry_form POST contents.</td></tr>
<tr><td class="h">2049</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns: req</td></tr>
<tr><td class="h">2050</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">2051</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub entry_form_decode</td></tr>
<tr><td class="h">2052</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2053</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2053">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($req, $POST) = @_;</td></tr>
<tr><td class="h">2054</td><td colspan="7"></td></tr><tr><td class="h">2055</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# find security</td></tr>
<tr><td class="h">2056</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $sec = &quot;public&quot;;</td></tr>
<tr><td class="h">2057</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $amask = 0;</td></tr>
<tr><td class="h">2058</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2058">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2058">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2058">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($POST-&gt;{&#39;security&#39;} eq &quot;private&quot;) {</td></tr>
<tr><td class="h">2059</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sec = &quot;private&quot;;</td></tr>
<tr><td class="h">2060</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($POST-&gt;{&#39;security&#39;} eq &quot;friends&quot;) {</td></tr>
<tr><td class="h">2061</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sec = &quot;usemask&quot;; $amask = 1;</td></tr>
<tr><td class="h">2062</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($POST-&gt;{&#39;security&#39;} eq &quot;custom&quot;) {</td></tr>
<tr><td class="h">2063</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sec = &quot;usemask&quot;;</td></tr>
<tr><td class="h">2064</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $bit (1..60) {</td></tr>
<tr><td class="h">2065</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2065">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $POST-&gt;{&quot;custom_bit_$bit&quot;};</td></tr>
<tr><td class="h">2066</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$amask |= (1 &lt;&lt; $bit);</td></tr>
<tr><td class="h">2067</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2068</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2069</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;security&#39;} = $sec;</td></tr>
<tr><td class="h">2070</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;allowmask&#39;} = $amask;</td></tr>
<tr><td class="h">2071</td><td colspan="7"></td></tr><tr><td class="h">2072</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# date/time</td></tr>
<tr><td class="h">2073</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $date = LJ::html_datetime_decode({ &#39;name&#39; =&gt; &quot;date_ymd&quot;, }, $POST);</td></tr>
<tr><td class="h">2074</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($year, $mon, $day) = split( /\D/, $date);</td></tr>
<tr><td class="h">2075</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($hour, $min) = ($POST-&gt;{&#39;hour&#39;}, $POST-&gt;{&#39;min&#39;});</td></tr>
<tr><td class="h">2076</td><td colspan="7"></td></tr><tr><td class="h">2077</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TEMP: ease golive by using older way of determining differences</td></tr>
<tr><td class="h">2078</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $date_old = LJ::html_datetime_decode({ &#39;name&#39; =&gt; &quot;date_ymd_old&quot;, }, $POST);</td></tr>
<tr><td class="h">2079</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($year_old, $mon_old, $day_old) = split( /\D/, $date_old);</td></tr>
<tr><td class="h">2080</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($hour_old, $min_old) = ($POST-&gt;{&#39;hour_old&#39;}, $POST-&gt;{&#39;min_old&#39;});</td></tr>
<tr><td class="h">2081</td><td colspan="7"></td></tr><tr><td class="h">2082</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2082">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2082">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $different = $POST-&gt;{&#39;min_old&#39;} &amp;&amp; (($year ne $year_old) || ($mon ne $mon_old)</td></tr>
<tr><td class="h">2083</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| ($day ne $day_old) || ($hour ne $hour_old) || ($min ne $min_old));</td></tr>
<tr><td class="h">2084</td><td colspan="7"></td></tr><tr><td class="h">2085</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# this value is set when the JS runs, which means that the user-provided</td></tr>
<tr><td class="h">2086</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# time is sync&#39;d with their computer clock. otherwise, the JS didn&#39;t run,</td></tr>
<tr><td class="h">2087</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# so let&#39;s guess at their timezone.</td></tr>
<tr><td class="h">2088</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2088">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2088">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($POST-&gt;{&#39;date_diff&#39;} || $POST-&gt;{&#39;date_diff_nojs&#39;} || $different) {</td></tr>
<tr><td class="h">2089</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $req-&gt;{&#39;tz&#39;};</td></tr>
<tr><td class="h">2090</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;year&#39;} = $year;</td></tr>
<tr><td class="h">2091</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;mon&#39;} = $mon;</td></tr>
<tr><td class="h">2092</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;day&#39;} = $day;</td></tr>
<tr><td class="h">2093</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;hour&#39;} = $hour;</td></tr>
<tr><td class="h">2094</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;min&#39;} = $min;</td></tr>
<tr><td class="h">2095</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2096</td><td colspan="7"></td></tr><tr><td class="h">2097</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# copy some things from %POST</td></tr>
<tr><td class="h">2098</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach (qw(subject</td></tr>
<tr><td class="h">2099</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_picture_keyword prop_current_moodid</td></tr>
<tr><td class="h">2100</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_current_mood prop_current_music</td></tr>
<tr><td class="h">2101</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_opt_screening prop_opt_noemail</td></tr>
<tr><td class="h">2102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_opt_preformatted prop_opt_nocomments</td></tr>
<tr><td class="h">2103</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_current_location prop_current_coords</td></tr>
<tr><td class="h">2104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prop_taglist prop_qotdid)) {</td></tr>
<tr><td class="h">2105</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{$_} = $POST-&gt;{$_};</td></tr>
<tr><td class="h">2106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2107</td><td colspan="7"></td></tr><tr><td class="h">2108</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2108">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($POST-&gt;{&quot;subject&quot;} eq BML::ml(&#39;entryform.subject.hint2&#39;)) {</td></tr>
<tr><td class="h">2109</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;subject&quot;} = &quot;&quot;;</td></tr>
<tr><td class="h">2110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2111</td><td colspan="7"></td></tr><tr><td class="h">2112</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2112">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2112">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2112">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;prop_opt_preformatted&quot;} ||= $POST-&gt;{&#39;switched_rte_on&#39;} ? 1 :</td></tr>
<tr><td class="h">2113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$POST-&gt;{&#39;event_format&#39;} eq &quot;preformatted&quot; ? 1 : 0;</td></tr>
<tr><td class="h">2114</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2114">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2114">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;prop_opt_nocomments&quot;}   ||= $POST-&gt;{&#39;comment_settings&#39;} eq &quot;nocomments&quot; ? 1 : 0;</td></tr>
<tr><td class="h">2115</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2115">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2115">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;prop_opt_noemail&quot;}      ||= $POST-&gt;{&#39;comment_settings&#39;} eq &quot;noemail&quot; ? 1 : 0;</td></tr>
<tr><td class="h">2116</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2116">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;prop_opt_backdated&#39;}      = $POST-&gt;{&#39;prop_opt_backdated&#39;} ? 1 : 0;</td></tr>
<tr><td class="h">2117</td><td colspan="7"></td></tr><tr><td class="h">2118</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2118">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( LJ::is_enabled( &#39;adult_content&#39; ) ) {</td></tr>
<tr><td class="h">2119</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{prop_adult_content} = $POST-&gt;{prop_adult_content};</td></tr>
<tr><td class="h">2120</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2120">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2120">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{prop_adult_content} = &quot;&quot;</td></tr>
<tr><td class="h">2121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $req-&gt;{prop_adult_content} eq &quot;none&quot; || $req-&gt;{prop_adult_content} eq &quot;concepts&quot; || $req-&gt;{prop_adult_content} eq &quot;explicit&quot;;</td></tr>
<tr><td class="h">2122</td><td colspan="7"></td></tr><tr><td class="h">2123</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2123">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{prop_adult_content_reason} = $POST-&gt;{prop_adult_content_reason} || &quot;&quot;;</td></tr>
<tr><td class="h">2124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2125</td><td colspan="7"></td></tr><tr><td class="h">2126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# nuke taglists that are just blank</td></tr>
<tr><td class="h">2127</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2127">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2127">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;prop_taglist&#39;} = &quot;&quot; unless $req-&gt;{&#39;prop_taglist&#39;} &amp;&amp; $req-&gt;{&#39;prop_taglist&#39;} =~ /\S/;</td></tr>
<tr><td class="h">2128</td><td colspan="7"></td></tr><tr><td class="h">2129</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Convert the rich text editor output back to parsable lj tags.</td></tr>
<tr><td class="h">2130</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $event = $POST-&gt;{&#39;event&#39;};</td></tr>
<tr><td class="h">2131</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2131">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($POST-&gt;{&#39;switched_rte_on&#39;}) {</td></tr>
<tr><td class="h">2132</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;prop_used_rte&quot;} = 1;</td></tr>
<tr><td class="h">2133</td><td colspan="7"></td></tr><tr><td class="h">2134</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# We want to see if we can hit the fast path for cleaning</td></tr>
<tr><td class="h">2135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if they did nothing but add line breaks.</td></tr>
<tr><td class="h">2136</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $attempt = $event;</td></tr>
<tr><td class="h">2137</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attempt =~ s!&lt;br /&gt;!\n!g;</td></tr>
<tr><td class="h">2138</td><td colspan="7"></td></tr><tr><td class="h">2139</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2139">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($attempt !~ /&lt;\w/) {</td></tr>
<tr><td class="h">2140</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$event = $attempt;</td></tr>
<tr><td class="h">2141</td><td colspan="7"></td></tr><tr><td class="h">2142</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Make sure they actually typed something, and not just hit</td></tr>
<tr><td class="h">2143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# enter a lot</td></tr>
<tr><td class="h">2144</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$attempt =~ s!(?:&lt;p&gt;(?:&amp;nbsp;|\s)+&lt;/p&gt;|&amp;nbsp;)\s*?!!gm;</td></tr>
<tr><td class="h">2145</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2145">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$event = &#39;&#39; unless $attempt =~ /\S/;</td></tr>
<tr><td class="h">2146</td><td colspan="7"></td></tr><tr><td class="h">2147</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;prop_opt_preformatted&#39;} = 0;</td></tr>
<tr><td class="h">2148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2149</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Old methods, left in for compatibility during code push</td></tr>
<tr><td class="h">2150</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$event =~ s!&lt;lj-cut class=&quot;ljcut&quot;&gt;!&lt;lj-cut&gt;!gi;</td></tr>
<tr><td class="h">2151</td><td colspan="7"></td></tr><tr><td class="h">2152</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$event =~ s!&lt;lj-raw class=&quot;ljraw&quot;&gt;!&lt;lj-raw&gt;!gi;</td></tr>
<tr><td class="h">2153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2154</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2155</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&quot;prop_used_rte&quot;} = 0;</td></tr>
<tr><td class="h">2156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2157</td><td colspan="7"></td></tr><tr><td class="h">2158</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;event&#39;} = $event;</td></tr>
<tr><td class="h">2159</td><td colspan="7"></td></tr><tr><td class="h">2160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;## see if an &quot;other&quot; mood they typed in has an equivalent moodid</td></tr>
<tr><td class="h">2161</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2161">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($POST-&gt;{&#39;prop_current_mood&#39;}) {</td></tr>
<tr><td class="h">2162</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2162">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (my $id = LJ::mood_id($POST-&gt;{&#39;prop_current_mood&#39;})) {</td></tr>
<tr><td class="h">2163</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$req-&gt;{&#39;prop_current_moodid&#39;} = $id;</td></tr>
<tr><td class="h">2164</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $req-&gt;{&#39;prop_current_mood&#39;};</td></tr>
<tr><td class="h">2165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2167</td><td colspan="7"></td></tr><tr><td class="h">2168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# process site-specific options</td></tr>
<tr><td class="h">2169</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::run_hooks(&#39;decode_entry_form&#39;, $POST, $req);</td></tr>
<tr><td class="h">2170</td><td colspan="7"></td></tr><tr><td class="h">2171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $req;</td></tr>
<tr><td class="h">2172</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2173</td><td colspan="7"></td></tr><tr><td class="h">2174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns exactly what was passed to it normally.  but in developer mode,</td></tr>
<tr><td class="h">2175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># it includes a link to a page that automatically grants the needed priv.</td></tr>
<tr><td class="h">2176</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub no_access_error {</td></tr>
<tr><td class="h">2177</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2177">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($text, $priv, $privarg) = @_;</td></tr>
<tr><td class="h">2178</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2178">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($LJ::IS_DEV_SERVER) {</td></tr>
<tr><td class="h">2179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">2180</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;$text &lt;b&gt;(DEVMODE: &lt;a href=&#39;/admin/priv/?devmode=1&amp;user=$remote-&gt;{user}&amp;priv=$priv&amp;arg=$privarg&#39;&gt;Grant $priv\[$privarg\]&lt;/a&gt;)&lt;/b&gt;&quot;;</td></tr>
<tr><td class="h">2181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2182</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $text;</td></tr>
<tr><td class="h">2183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2185</td><td colspan="7"></td></tr><tr><td class="h">2186</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Data::Dumper for JavaScript</td></tr>
<tr><td class="h">2187</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub js_dumper {</td></tr>
<tr><td class="h">2188</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2188">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $obj = shift;</td></tr>
<tr><td class="h">2189</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2189">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2189">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (ref $obj eq &quot;HASH&quot;) {</td></tr>
<tr><td class="h">2190</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;{&quot;;</td></tr>
<tr><td class="h">2191</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $k (keys %$obj) {</td></tr>
<tr><td class="h">2192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# numbers as keys need to be quoted.  and things like &quot;null&quot;</td></tr>
<tr><td class="h">2193</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2193">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $kd = ($k =~ /^\w+$/) ? &quot;\&quot;$k\&quot;&quot; : LJ::js_dumper($k);</td></tr>
<tr><td class="h">2194</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$kd: &quot; . js_dumper($obj-&gt;{$k}) . &quot;,\n&quot;;</td></tr>
<tr><td class="h">2195</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2196</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2196">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (keys %$obj) {</td></tr>
<tr><td class="h">2197</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chop $ret;</td></tr>
<tr><td class="h">2198</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chop $ret;</td></tr>
<tr><td class="h">2199</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2200</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;}&quot;;</td></tr>
<tr><td class="h">2201</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif (ref $obj eq &quot;ARRAY&quot;) {</td></tr>
<tr><td class="h">2203</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;[&quot; . join(&quot;, &quot;, map { js_dumper($_) } @$obj) . &quot;]&quot;;</td></tr>
<tr><td class="h">2204</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2206</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2206">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $obj if $obj =~ /^\d+$/;</td></tr>
<tr><td class="h">2207</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;\&quot;&quot; . LJ::ejs($obj) . &quot;\&quot;&quot;;</td></tr>
<tr><td class="h">2208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2209</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2210</td><td colspan="7"></td></tr><tr><td class="h">2211</td><td colspan="7"></td></tr><tr><td class="h">2212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %stat_cache = ();  # key -&gt; {lastcheck, modtime}</td></tr>
<tr><td class="h">2214</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;sub _file_modtime {</td></tr>
<tr><td class="h">2215</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2215">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($key, $now) = @_;</td></tr>
<tr><td class="h">2216</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2216">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (my $ci = $stat_cache{$key}) {</td></tr>
<tr><td class="h">2217</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2217">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($ci-&gt;{lastcheck} &gt; $now - 10) {</td></tr>
<tr><td class="h">2218</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $ci-&gt;{modtime};</td></tr>
<tr><td class="h">2219</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2220</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2221</td><td colspan="7"></td></tr><tr><td class="h">2222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $set = sub {</td></tr>
<tr><td class="h">2223</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2223">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mtime = shift;</td></tr>
<tr><td class="h">2224</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$stat_cache{$key} = { lastcheck =&gt; $now, modtime =&gt; $mtime };</td></tr>
<tr><td class="h">2225</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $mtime;</td></tr>
<tr><td class="h">2226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2227</td><td colspan="7"></td></tr><tr><td class="h">2228</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $file = &quot;$LJ::HOME/htdocs/$key&quot;;</td></tr>
<tr><td class="h">2229</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mtime = (stat($file))[9];</td></tr>
<tr><td class="h">2230</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $set-&gt;($mtime);</td></tr>
<tr><td class="h">2231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2232</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2233</td><td colspan="7"></td></tr><tr><td class="h">2234</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># optional first argument: hashref with options</td></tr>
<tr><td class="h">2235</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># other arguments: resources to include</td></tr>
<tr><td class="h">2236</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub need_res {</td></tr>
<tr><td class="h">2237</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2237">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %opts;</td></tr>
<tr><td class="h">2238</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2238">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( ref $_[0] eq &#39;HASH&#39; ) {</td></tr>
<tr><td class="h">2239</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%opts = %{ shift() };</td></tr>
<tr><td class="h">2240</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2241</td><td colspan="7"></td></tr><tr><td class="h">2242</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $group = $opts{group};</td></tr>
<tr><td class="h">2243</td><td colspan="7"></td></tr><tr><td class="h">2244</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $reskey (@_) {</td></tr>
<tr><td class="h">2245</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2245">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Bogus reskey $reskey&quot; unless $reskey =~ m!^(js|stc)/!;</td></tr>
<tr><td class="h">2246</td><td colspan="7"></td></tr><tr><td class="h">2247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# we put javascript in the &#39;default&#39; group and CSS in the &#39;all&#39; group</td></tr>
<tr><td class="h">2248</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# since we need CSS everywhere and we are switching JS groups</td></tr>
<tr><td class="h">2249</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2249">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2249">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $lgroup = $group || ( $reskey =~ /^js/ ? &#39;default&#39; : &#39;all&#39; );</td></tr>
<tr><td class="h">2250</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2250">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($LJ::NEEDED_RES{$lgroup}-&gt;{$reskey}++) {</td></tr>
<tr><td class="h">2251</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @LJ::NEEDED_RES, [ $lgroup, $reskey ];</td></tr>
<tr><td class="h">2252</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2254</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2255</td><td colspan="7"></td></tr><tr><td class="h">2256</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub res_includes {</td></tr>
<tr><td class="h">2257</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# TODO: automatic dependencies from external map and/or content of files,</td></tr>
<tr><td class="h">2258</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# currently it&#39;s limited to dependencies on the order you call LJ::need_res();</td></tr>
<tr><td class="h">2259</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2259">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;&quot;;</td></tr>
<tr><td class="h">2260</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2260">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $do_concat = $LJ::IS_SSL ? $LJ::CONCAT_RES_SSL : $LJ::CONCAT_RES;</td></tr>
<tr><td class="h">2261</td><td colspan="7"></td></tr><tr><td class="h">2262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# use correct root and prefixes for SSL pages</td></tr>
<tr><td class="h">2263</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($siteroot, $imgprefix, $statprefix, $jsprefix, $wstatprefix);</td></tr>
<tr><td class="h">2264</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2264">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($LJ::IS_SSL) {</td></tr>
<tr><td class="h">2265</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$siteroot = $LJ::SSLROOT;</td></tr>
<tr><td class="h">2266</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgprefix = $LJ::SSLIMGPREFIX;</td></tr>
<tr><td class="h">2267</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$statprefix = $LJ::SSLSTATPREFIX;</td></tr>
<tr><td class="h">2268</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$jsprefix = $LJ::SSLJSPREFIX;</td></tr>
<tr><td class="h">2269</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wstatprefix = $LJ::SSLWSTATPREFIX;</td></tr>
<tr><td class="h">2270</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2271</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$siteroot = $LJ::SITEROOT;</td></tr>
<tr><td class="h">2272</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$imgprefix = $LJ::IMGPREFIX;</td></tr>
<tr><td class="h">2273</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$statprefix = $LJ::STATPREFIX;</td></tr>
<tr><td class="h">2274</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$jsprefix = $LJ::JSPREFIX;</td></tr>
<tr><td class="h">2275</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$wstatprefix = $LJ::WSTATPREFIX;</td></tr>
<tr><td class="h">2276</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2277</td><td colspan="7"></td></tr><tr><td class="h">2278</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# find current journal</td></tr>
<tr><td class="h">2279</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $r = DW::Request-&gt;get;</td></tr>
<tr><td class="h">2280</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $journal_base = &#39;&#39;;</td></tr>
<tr><td class="h">2281</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $journal = &#39;&#39;;</td></tr>
<tr><td class="h">2282</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2282">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($r) {</td></tr>
<tr><td class="h">2283</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $journalid = $r-&gt;note(&#39;journalid&#39;);</td></tr>
<tr><td class="h">2284</td><td colspan="7"></td></tr><tr><td class="h">2285</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ju;</td></tr>
<tr><td class="h">2286</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2286">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ju = LJ::load_userid($journalid) if $journalid;</td></tr>
<tr><td class="h">2287</td><td colspan="7"></td></tr><tr><td class="h">2288</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2288">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($ju) {</td></tr>
<tr><td class="h">2289</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$journal_base = $ju-&gt;journal_base;</td></tr>
<tr><td class="h">2290</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$journal = $ju-&gt;{user};</td></tr>
<tr><td class="h">2291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2292</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2293</td><td colspan="7"></td></tr><tr><td class="h">2294</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">2295</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2295">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $hasremote = $remote ? 1 : 0;</td></tr>
<tr><td class="h">2296</td><td colspan="7"></td></tr><tr><td class="h">2297</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# ctxpopup prop</td></tr>
<tr><td class="h">2298</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ctxpopup = 1;</td></tr>
<tr><td class="h">2299</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2299">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2299">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ctxpopup = 0 if $remote &amp;&amp; ! $remote-&gt;prop(&quot;opt_ctxpopup&quot;);</td></tr>
<tr><td class="h">2300</td><td colspan="7"></td></tr><tr><td class="h">2301</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# poll for esn inbox updates?</td></tr>
<tr><td class="h">2302</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $inbox_update_poll = LJ::is_enabled(&#39;inbox_update_poll&#39;);</td></tr>
<tr><td class="h">2303</td><td colspan="7"></td></tr><tr><td class="h">2304</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# are media embeds enabled?</td></tr>
<tr><td class="h">2305</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $embeds_enabled = LJ::is_enabled(&#39;embed_module&#39;);</td></tr>
<tr><td class="h">2306</td><td colspan="7"></td></tr><tr><td class="h">2307</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# esn ajax enabled?</td></tr>
<tr><td class="h">2308</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $esn_async = LJ::is_enabled(&#39;esn_ajax&#39;);</td></tr>
<tr><td class="h">2309</td><td colspan="7"></td></tr><tr><td class="h">2310</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %site = (</td></tr>
<tr><td class="h">2311</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;imgprefix =&gt; &quot;$imgprefix&quot;,</td></tr>
<tr><td class="h">2312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;siteroot =&gt; &quot;$siteroot&quot;,</td></tr>
<tr><td class="h">2313</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statprefix =&gt; &quot;$statprefix&quot;,</td></tr>
<tr><td class="h">2314</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentJournalBase =&gt; &quot;$journal_base&quot;,</td></tr>
<tr><td class="h">2315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentJournal =&gt; &quot;$journal&quot;,</td></tr>
<tr><td class="h">2316</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;has_remote =&gt; $hasremote,</td></tr>
<tr><td class="h">2317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx_popup =&gt; $ctxpopup,</td></tr>
<tr><td class="h">2318</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inbox_update_poll =&gt; $inbox_update_poll,</td></tr>
<tr><td class="h">2319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;media_embed_enabled =&gt; $embeds_enabled,</td></tr>
<tr><td class="h">2320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esn_async =&gt; $esn_async,</td></tr>
<tr><td class="h">2321</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">2322</td><td colspan="7"></td></tr><tr><td class="h">2323</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $site_params = LJ::js_dumper(\%site);</td></tr>
<tr><td class="h">2324</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $site_param_keys = LJ::js_dumper([keys %site]);</td></tr>
<tr><td class="h">2325</td><td colspan="7"></td></tr><tr><td class="h">2326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# include standard JS info</td></tr>
<tr><td class="h">2327</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq {</td></tr>
<tr><td class="h">2328</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script type=&quot;text/javascript&quot;&gt;</td></tr>
<tr><td class="h">2329</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Site;</td></tr>
<tr><td class="h">2330</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!Site)</td></tr>
<tr><td class="h">2331</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Site = {};</td></tr>
<tr><td class="h">2332</td><td colspan="7"></td></tr><tr><td class="h">2333</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var site_p = $site_params;</td></tr>
<tr><td class="h">2334</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var site_k = $site_param_keys;</td></tr>
<tr><td class="h">2335</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i = 0; site_k.length &gt; i; i++) {</td></tr>
<tr><td class="h">2336</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Site[site_k[i]] = site_p[site_k[i]];</td></tr>
<tr><td class="h">2337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;</td></tr>
<tr><td class="h">2339</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2340</td><td colspan="7"></td></tr><tr><td class="h">2341</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $now = time();</td></tr>
<tr><td class="h">2342</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %list;   # type -&gt; [];</td></tr>
<tr><td class="h">2343</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %oldest; # type -&gt; $oldest</td></tr>
<tr><td class="h">2344</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $add = sub {</td></tr>
<tr><td class="h">2345</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2345">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2345">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($type, $what, $modtime) = @_;</td></tr>
<tr><td class="h">2346</td><td colspan="7"></td></tr><tr><td class="h">2347</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# in the concat-res case, we don&#39;t directly append the URL w/</td></tr>
<tr><td class="h">2348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the modtime, but rather do one global max modtime at the</td></tr>
<tr><td class="h">2349</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# end, which is done later in the tags function.</td></tr>
<tr><td class="h">2350</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2350">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$what .= &quot;?v=$modtime&quot; unless $do_concat;</td></tr>
<tr><td class="h">2351</td><td colspan="7"></td></tr><tr><td class="h">2352</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2352">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @{$list{$type} ||= []}, $what;</td></tr>
<tr><td class="h">2353</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2353">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oldest{$type} = $modtime if $modtime &gt; $oldest{$type};</td></tr>
<tr><td class="h">2354</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2355</td><td colspan="7"></td></tr><tr><td class="h">2356</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $resrow (@LJ::NEEDED_RES) {</td></tr>
<tr><td class="h">2357</td><td colspan="7"></td></tr><tr><td class="h">2358</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# determine if this resource is part of the resource group that is active;</td></tr>
<tr><td class="h">2359</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# or &#39;default&#39; if no group explicitly active</td></tr>
<tr><td class="h">2360</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $group, $key ) = @$resrow;</td></tr>
<tr><td class="h">2361</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if</td></tr>
<tr><td class="h">2362</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2362">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2362">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group ne &#39;all&#39; &amp;&amp;</td></tr>
<tr><td class="h">2363</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( ( defined $LJ::ACTIVE_RES_GROUP &amp;&amp; $group ne $LJ::ACTIVE_RES_GROUP ) ||</td></tr>
<tr><td class="h">2364</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( ! defined $LJ::ACTIVE_RES_GROUP &amp;&amp; $group ne &#39;default&#39; ) );</td></tr>
<tr><td class="h">2365</td><td colspan="7"></td></tr><tr><td class="h">2366</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $path;</td></tr>
<tr><td class="h">2367</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mtime = _file_modtime($key, $now);</td></tr>
<tr><td class="h">2368</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2368">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2368">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($key =~ m!^stc/fck/! || $LJ::FORCE_WSTAT{$key}) {</td></tr>
<tr><td class="h">2369</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path = &quot;w$key&quot;;  # wstc/ instead of stc/</td></tr>
<tr><td class="h">2370</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2371</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$path = $key;</td></tr>
<tr><td class="h">2372</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2373</td><td colspan="7"></td></tr><tr><td class="h">2374</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if we want to also include a local version of this file, include that too</td></tr>
<tr><td class="h">2375</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2375">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (@LJ::USE_LOCAL_RES) {</td></tr>
<tr><td class="h">2376</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2376">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (grep { lc $_ eq lc $key } @LJ::USE_LOCAL_RES) {</td></tr>
<tr><td class="h">2377</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $inc = $key;</td></tr>
<tr><td class="h">2378</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$inc =~ s/(\w+)\.(\w+)$/$1-local.$2/;</td></tr>
<tr><td class="h">2379</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res($inc);</td></tr>
<tr><td class="h">2380</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2381</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2382</td><td colspan="7"></td></tr><tr><td class="h">2383</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2383">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2383">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2383">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2383">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2383">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($path =~ m!^js/(.+)!) {</td></tr>
<tr><td class="h">2384</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$add-&gt;(&#39;js&#39;, $1, $mtime);</td></tr>
<tr><td class="h">2385</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($path =~ /\.css$/ &amp;&amp; $path =~ m!^(w?)stc/(.+)!) {</td></tr>
<tr><td class="h">2386</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$add-&gt;(&quot;${1}stccss&quot;, $2, $mtime);</td></tr>
<tr><td class="h">2387</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($path =~ /\.js$/ &amp;&amp; $path =~ m!^(w?)stc/(.+)!) {</td></tr>
<tr><td class="h">2388</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$add-&gt;(&quot;${1}stcjs&quot;, $2, $mtime);</td></tr>
<tr><td class="h">2389</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2390</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2391</td><td colspan="7"></td></tr><tr><td class="h">2392</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tags = sub {</td></tr>
<tr><td class="h">2393</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2393">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($type, $template) = @_;</td></tr>
<tr><td class="h">2394</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $list;</td></tr>
<tr><td class="h">2395</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2395">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return unless $list = $list{$type};</td></tr>
<tr><td class="h">2396</td><td colspan="7"></td></tr><tr><td class="h">2397</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2397">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($do_concat) {</td></tr>
<tr><td class="h">2398</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $csep = join(&#39;,&#39;, @$list);</td></tr>
<tr><td class="h">2399</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$csep .= &quot;?v=&quot; . $oldest{$type};</td></tr>
<tr><td class="h">2400</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$template =~ s/__+/??$csep/;</td></tr>
<tr><td class="h">2401</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $template;</td></tr>
<tr><td class="h">2402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2403</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $item (@$list) {</td></tr>
<tr><td class="h">2404</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $inc = $template;</td></tr>
<tr><td class="h">2405</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$inc =~ s/__+/$item/;</td></tr>
<tr><td class="h">2406</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $inc;</td></tr>
<tr><td class="h">2407</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2408</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2409</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2410</td><td colspan="7"></td></tr><tr><td class="h">2411</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$tags-&gt;(&quot;js&quot;,      &quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;$jsprefix/___\&quot;&gt;&lt;/script&gt;\n&quot;);</td></tr>
<tr><td class="h">2412</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$tags-&gt;(&quot;stccss&quot;,  &quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;$statprefix/___\&quot; /&gt;\n&quot;);</td></tr>
<tr><td class="h">2413</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$tags-&gt;(&quot;wstccss&quot;, &quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; href=\&quot;$wstatprefix/___\&quot; /&gt;\n&quot;);</td></tr>
<tr><td class="h">2414</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$tags-&gt;(&quot;stcjs&quot;,   &quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;$statprefix/___\&quot;&gt;&lt;/script&gt;\n&quot;);</td></tr>
<tr><td class="h">2415</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$tags-&gt;(&quot;wstcjs&quot;,  &quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;$wstatprefix/___\&quot;&gt;&lt;/script&gt;\n&quot;);</td></tr>
<tr><td class="h">2416</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2418</td><td colspan="7"></td></tr><tr><td class="h">2419</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># called to set the active resource group</td></tr>
<tr><td class="h">2420</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub set_active_resource_group {</td></tr>
<tr><td class="h">2421</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2421">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$LJ::ACTIVE_RES_GROUP = $_[0];</td></tr>
<tr><td class="h">2422</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2423</td><td colspan="7"></td></tr><tr><td class="h">2424</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns HTML of a dynamic tag could given passed in data</td></tr>
<tr><td class="h">2425</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Requires hash-ref of tag =&gt; { url =&gt; url, value =&gt; value }</td></tr>
<tr><td class="h">2426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub tag_cloud {</td></tr>
<tr><td class="h">2427</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2427">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($tags, $opts) = @_;</td></tr>
<tr><td class="h">2428</td><td colspan="7"></td></tr><tr><td class="h">2429</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# find sizes of tags, sorted</td></tr>
<tr><td class="h">2430</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @sizes = sort { $a &lt;=&gt; $b } map { $tags-&gt;{$_}-&gt;{&#39;value&#39;} } keys %$tags;</td></tr>
<tr><td class="h">2431</td><td colspan="7"></td></tr><tr><td class="h">2432</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# remove duplicates:</td></tr>
<tr><td class="h">2433</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %sizes = map { $_, 1 } @sizes;</td></tr>
<tr><td class="h">2434</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@sizes = sort { $a &lt;=&gt; $b } keys %sizes;</td></tr>
<tr><td class="h">2435</td><td colspan="7"></td></tr><tr><td class="h">2436</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @tag_names = sort keys %$tags;</td></tr>
<tr><td class="h">2437</td><td colspan="7"></td></tr><tr><td class="h">2438</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $percentile = sub {</td></tr>
<tr><td class="h">2439</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2439">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $n = shift;</td></tr>
<tr><td class="h">2440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $total = scalar @sizes;</td></tr>
<tr><td class="h">2441</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (my $i = 0; $i &lt; $total; $i++) {</td></tr>
<tr><td class="h">2442</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2442">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $n &gt; $sizes[$i];</td></tr>
<tr><td class="h">2443</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $i / $total;</td></tr>
<tr><td class="h">2444</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2445</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2446</td><td colspan="7"></td></tr><tr><td class="h">2447</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $base_font_size = 8;</td></tr>
<tr><td class="h">2448</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2448">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $font_size_range = $opts-&gt;{font_size_range} || 25;</td></tr>
<tr><td class="h">2449</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret .= &quot;&lt;div id=&#39;tagcloud&#39; class=&#39;tagcloud&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2450</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %tagdata = ();</td></tr>
<tr><td class="h">2451</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $tag (@tag_names) {</td></tr>
<tr><td class="h">2452</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tagurl = $tags-&gt;{$tag}-&gt;{&#39;url&#39;};</td></tr>
<tr><td class="h">2453</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ct     = $tags-&gt;{$tag}-&gt;{&#39;value&#39;};</td></tr>
<tr><td class="h">2454</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pt     = int($base_font_size + $percentile-&gt;($ct) * $font_size_range);</td></tr>
<tr><td class="h">2455</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;a &quot;;</td></tr>
<tr><td class="h">2456</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2456">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;id=&#39;taglink_$tag&#39; &quot; unless $opts-&gt;{ignore_ids};</td></tr>
<tr><td class="h">2457</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;href=&#39;&quot; . LJ::ehtml($tagurl) . &quot;&#39; style=&#39;font-size: ${pt}pt; text-decoration: none&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2458</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::ehtml($tag) . &quot;&lt;/a&gt;\n&quot;;</td></tr>
<tr><td class="h">2459</td><td colspan="7"></td></tr><tr><td class="h">2460</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# build hash of tagname =&gt; final point size for refresh</td></tr>
<tr><td class="h">2461</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tagdata{$tag} = $pt;</td></tr>
<tr><td class="h">2462</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2463</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">2464</td><td colspan="7"></td></tr><tr><td class="h">2465</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2467</td><td colspan="7"></td></tr><tr><td class="h">2468</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub control_strip</td></tr>
<tr><td class="h">2469</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2470</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2470">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %opts = @_;</td></tr>
<tr><td class="h">2471</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = delete $opts{user};</td></tr>
<tr><td class="h">2472</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $baseuri = delete $opts{baseuri};</td></tr>
<tr><td class="h">2473</td><td colspan="7"></td></tr><tr><td class="h">2474</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $journal = LJ::load_user($user);</td></tr>
<tr><td class="h">2475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $show_strip = 1;</td></tr>
<tr><td class="h">2476</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2476">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$show_strip = LJ::run_hook( &quot;show_control_strip&quot; ) if ( LJ::are_hooks( &quot;show_control_strip&quot; ) );</td></tr>
<tr><td class="h">2477</td><td colspan="7"></td></tr><tr><td class="h">2478</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2478">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&quot; unless $show_strip;</td></tr>
<tr><td class="h">2479</td><td colspan="7"></td></tr><tr><td class="h">2480</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $remote = LJ::get_remote();</td></tr>
<tr><td class="h">2481</td><td colspan="7"></td></tr><tr><td class="h">2482</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $r = DW::Request-&gt;get;</td></tr>
<tr><td class="h">2483</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2483">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $args = $baseuri ? delete $opts{args} : $r-&gt;query_string; # use passed in args if we have a passed in location</td></tr>
<tr><td class="h">2484</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2484">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $view = delete $opts{view} || $r-&gt;note( &#39;view&#39; );</td></tr>
<tr><td class="h">2485</td><td colspan="7"></td></tr><tr><td class="h">2486</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2486">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $querysep = $args ? &quot;?&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">2487</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2487">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $uri = $baseuri ? &quot;http://$baseuri&quot; : &quot;http://&quot; . $r-&gt;header_in(&#39;Host&#39;) . $r-&gt;uri;</td></tr>
<tr><td class="h">2488</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$uri .= &quot;$querysep$args&quot;;</td></tr>
<tr><td class="h">2489</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $euri = LJ::eurl($uri);</td></tr>
<tr><td class="h">2490</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2490">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $create_link = LJ::run_hook(&quot;override_create_link_on_navstrip&quot;, $journal) || &quot;&lt;a href=&#39;$LJ::SITEROOT/create&#39;&gt;&quot; . BML::ml(&#39;web.controlstrip.links.create&#39;, {&#39;sitename&#39; =&gt; $LJ::SITENAMESHORT}) . &quot;&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2491</td><td colspan="7"></td></tr><tr><td class="h">2492</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Build up some common links</td></tr>
<tr><td class="h">2493</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2493">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %links = (</td></tr>
<tr><td class="h">2494</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;login&#39;             =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/?returnto=$euri&#39;&gt;$BML::ML{&#39;web.controlstrip.links.login&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2495</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;post_journal&#39;      =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/update&#39;&gt;$BML::ML{&#39;web.controlstrip.links.post2&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2496</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;home&#39;              =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/&#39;&gt;&quot; . $BML::ML{&#39;web.controlstrip.links.home&#39;} . &quot;&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2497</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;recent_comments&#39;   =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/tools/recent_comments&#39;&gt;$BML::ML{&#39;web.controlstrip.links.recentcomments&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2498</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;manage_friends&#39;    =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/&#39;&gt;$BML::ML{&#39;web.controlstrip.links.managecircle&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2499</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;manage_entries&#39;    =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/editjournal&#39;&gt;$BML::ML{&#39;web.controlstrip.links.manageentries&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2500</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;invite_friends&#39;    =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/invite&#39;&gt;$BML::ML{&#39;web.controlstrip.links.invitefriends&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2501</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;create_account&#39;    =&gt; $create_link,</td></tr>
<tr><td class="h">2502</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;syndicated_list&#39;   =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/syn/list&#39;&gt;$BML::ML{&#39;web.controlstrip.links.popfeeds&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2503</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;learn_more&#39;        =&gt; LJ::run_hook(&#39;control_strip_learnmore_link&#39;) || &quot;&lt;a href=&#39;$LJ::SITEROOT/&#39;&gt;$BML::ML{&#39;web.controlstrip.links.learnmore&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2504</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;explore&#39;           =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/explore/&#39;&gt;&quot; . BML::ml(&#39;web.controlstrip.links.explore&#39;, { sitenameabbrev =&gt; $LJ::SITENAMEABBREV }) . &quot;&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;confirm&#39;           =&gt; &quot;&lt;a href=&#39;$LJ::SITEROOT/register&#39;&gt;$BML::ML{&#39;web.controlstrip.links.confirm&#39;}&lt;/a&gt;&quot;,</td></tr>
<tr><td class="h">2506</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">2507</td><td colspan="7"></td></tr><tr><td class="h">2508</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2508">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($remote) {</td></tr>
<tr><td class="h">2509</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $unread = $remote-&gt;notification_inbox-&gt;unread_count;</td></tr>
<tr><td class="h">2510</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{inbox} .= &quot;&lt;a href=&#39;$LJ::SITEROOT/inbox/&#39;&gt;$BML::ML{&#39;web.controlstrip.links.inbox&#39;}&quot;;</td></tr>
<tr><td class="h">2511</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2511">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{inbox} .= &quot; ($unread)&quot; if $unread;</td></tr>
<tr><td class="h">2512</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{inbox} .= &quot;&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2513</td><td colspan="7"></td></tr><tr><td class="h">2514</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;view_friends_page&#39;} = &quot;&lt;a href=&#39;&quot; . $remote-&gt;journal_base . &quot;/read&#39;&gt;$BML::ML{&#39;web.controlstrip.links.viewreadingpage&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2515</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;add_friend&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/add?user=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.addtocircle&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2516</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;edit_friend&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/add?user=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.modifycircle&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2517</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;track_user&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/subscriptions/user?journal=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.trackuser&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2518</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2518">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($journal-&gt;is_syndicated ) {</td></tr>
<tr><td class="h">2519</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;add_friend&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/add?user=$journal-&gt;{user}&amp;action=subscribe&#39;&gt;$BML::ML{&#39;web.controlstrip.links.addfeed&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2520</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;remove_friend&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/add?user=$journal-&gt;{user}&amp;action=remove&#39;&gt;$BML::ML{&#39;web.controlstrip.links.removefeed&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2521</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2522</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2522">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($journal-&gt;is_community) {</td></tr>
<tr><td class="h">2523</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2523">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;join_community&#39;}   = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/join?comm=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.joincomm&#39;}&lt;/a&gt;&quot;</td></tr>
<tr><td class="h">2524</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless $journal-&gt;is_closed_membership;</td></tr>
<tr><td class="h">2525</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;leave_community&#39;}  = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/leave?comm=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.leavecomm&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2526</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;watch_community&#39;}  = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/circle/add?user=$journal-&gt;{user}&amp;action=subscribe&#39;&gt;$BML::ML{&#39;web.controlstrip.links.watchcomm&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2527</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;unwatch_community&#39;}   = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/leave?comm=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.removecomm&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2528</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;post_to_community&#39;}   = &quot;&lt;a href=&#39;$LJ::SITEROOT/update?usejournal=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.postcomm&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2529</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;edit_community_profile&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/profile/?authas=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.editcommprofile&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2530</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;edit_community_invites&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/sentinvites?authas=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.managecomminvites&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2531</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;edit_community_members&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/members?authas=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.editcommmembers&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2532</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;track_community&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/manage/subscriptions/user?journal=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.trackcomm&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2533</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$links{&#39;queue&#39;} = &quot;&lt;a href=&#39;$LJ::SITEROOT/community/moderate?authas=$journal-&gt;{user}&#39;&gt;$BML::ML{&#39;web.controlstrip.links.queue&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2534</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2535</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2536</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $journal_display = LJ::ljuser($journal);</td></tr>
<tr><td class="h">2537</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %statustext = (</td></tr>
<tr><td class="h">2538</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;yourjournal&#39;       =&gt; $BML::ML{&#39;web.controlstrip.status.yourjournal&#39;},</td></tr>
<tr><td class="h">2539</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;yourfriendspage&#39;   =&gt; $BML::ML{&#39;web.controlstrip.status.yourreadingpage&#39;},</td></tr>
<tr><td class="h">2540</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;yourfriendsfriendspage&#39; =&gt; $BML::ML{&#39;web.controlstrip.status.yournetworkpage&#39;},</td></tr>
<tr><td class="h">2541</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;personal&#39;          =&gt; BML::ml(&#39;web.controlstrip.status.personal&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2542</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;personalfriendspage&#39; =&gt; BML::ml(&#39;web.controlstrip.status.personalreadingpage&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2543</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;personalfriendsfriendspage&#39; =&gt; BML::ml(&#39;web.controlstrip.status.personalnetworkpage&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2544</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;community&#39;         =&gt; BML::ml(&#39;web.controlstrip.status.community&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2545</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;syn&#39;               =&gt; BML::ml(&#39;web.controlstrip.status.syn&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2546</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;other&#39;             =&gt; BML::ml(&#39;web.controlstrip.status.other&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mutualtrust&#39; =&gt; BML::ml(&#39;web.controlstrip.status.mutualtrust&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2548</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mutualtrust_mutualwatch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.mutualtrust_mutualwatch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2549</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mutualtrust_watch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.mutualtrust_watch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2550</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mutualtrust_watchedby&#39; =&gt; BML::ml(&#39;web.controlstrip.status.mutualtrust_watchedby&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2551</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;mutualwatch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.mutualwatch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2552</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trust_mutualwatch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trust_mutualwatch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2553</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trust_watch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trust_watch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2554</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trust_watchedby&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trust_watchedby&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2555</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trustedby_mutualwatch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trustedby_mutualwatch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2556</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trustedby_watch&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trustedby_watch&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trustedby_watchedby&#39; =&gt; BML::ml(&#39;web.controlstrip.status.trustedby_watchedby&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maintainer&#39;        =&gt; BML::ml(&#39;web.controlstrip.status.maintainer&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2559</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;memberwatcher&#39;     =&gt; BML::ml(&#39;web.controlstrip.status.memberwatcher&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2560</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;watcher&#39;           =&gt; BML::ml(&#39;web.controlstrip.status.watcher&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2561</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;member&#39;            =&gt; BML::ml(&#39;web.controlstrip.status.member&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2562</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trusted&#39;           =&gt; BML::ml(&#39;web.controlstrip.status.trusted&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2563</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;watched&#39;           =&gt; BML::ml(&#39;web.controlstrip.status.watched&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2564</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;trusted_by&#39;        =&gt; BML::ml(&#39;web.controlstrip.status.trustedby&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2565</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;watched_by&#39;        =&gt; BML::ml(&#39;web.controlstrip.status.watchedby&#39;, {&#39;user&#39; =&gt; $journal_display}),</td></tr>
<tr><td class="h">2566</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">2567</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Style the status text</td></tr>
<tr><td class="h">2568</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $key (keys %statustext) {</td></tr>
<tr><td class="h">2569</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$statustext{$key} = &quot;&lt;span id=&#39;lj_controlstrip_statustext&#39;&gt;&quot; . $statustext{$key} . &quot;&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">2570</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2571</td><td colspan="7"></td></tr><tr><td class="h">2572</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">2573</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2573">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($remote) {</td></tr>
<tr><td class="h">2574</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remote_display  = LJ::ljuser($remote);</td></tr>
<tr><td class="h">2575</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $userpic = $remote-&gt;userpic;</td></tr>
<tr><td class="h">2576</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2576">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $userpic ) {</td></tr>
<tr><td class="h">2577</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $wh = $userpic-&gt;img_fixedsize( width =&gt; 43, height =&gt; 43 );</td></tr>
<tr><td class="h">2578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_userpic&#39; style=&#39;background-image: none;&#39;&gt;&lt;a href=&#39;$LJ::SITEROOT/editpics&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2579</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;img src=&#39;&quot; . $userpic-&gt;url . &quot;&#39; alt=\&quot;$BML::ML{&#39;web.controlstrip.userpic.alt&#39;}\&quot; title=\&quot;$BML::ML{&#39;web.controlstrip.userpic.title&#39;}\&quot; $wh /&gt;&lt;/a&gt;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2580</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2581</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $tinted_nouserpic_img = &quot;&quot;;</td></tr>
<tr><td class="h">2582</td><td colspan="7"></td></tr><tr><td class="h">2583</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2583">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($journal-&gt;prop(&#39;stylesys&#39;) == 2) {</td></tr>
<tr><td class="h">2584</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ctx = $LJ::S2::CURR_CTX;</td></tr>
<tr><td class="h">2585</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $custom_nav_strip = S2::get_property_value($ctx, &quot;custom_control_strip_colors&quot;);</td></tr>
<tr><td class="h">2586</td><td colspan="7"></td></tr><tr><td class="h">2587</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2587">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($custom_nav_strip ne &quot;off&quot;) {</td></tr>
<tr><td class="h">2588</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $linkcolor = S2::get_property_value($ctx, &quot;control_strip_linkcolor&quot;);</td></tr>
<tr><td class="h">2589</td><td colspan="7"></td></tr><tr><td class="h">2590</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2590">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($linkcolor ne &quot;&quot;) {</td></tr>
<tr><td class="h">2591</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tinted_nouserpic_img = S2::Builtin::LJ::palimg_modify($ctx, &quot;controlstrip/nouserpic.gif&quot;, [S2::Builtin::LJ::PalItem($ctx, 0, $linkcolor)]);</td></tr>
<tr><td class="h">2592</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2594</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2595</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_userpic&#39; style=&#39;background-image: none;&#39;&gt;&lt;a href=&#39;$LJ::SITEROOT/editpics&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2596</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2596">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($tinted_nouserpic_img eq &quot;&quot;) {</td></tr>
<tr><td class="h">2597</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;img src=&#39;$LJ::IMGPREFIX/controlstrip/nouserpic.gif&#39; &quot;;</td></tr>
<tr><td class="h">2598</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2599</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;img src=&#39;$tinted_nouserpic_img&#39; &quot;;</td></tr>
<tr><td class="h">2600</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2601</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;alt=\&quot;$BML::ML{&#39;web.controlstrip.nouserpic.alt&#39;}\&quot; title=\&quot;$BML::ML{&#39;web.controlstrip.nouserpic.title&#39;}\&quot; height=&#39;43&#39; width=&#39;43&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">2602</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/a&gt;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2603</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2604</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_user&#39; nowrap=&#39;nowrap&#39;&gt;&lt;form id=&#39;Greeting&#39; class=&#39;nopic&#39; action=&#39;$LJ::SITEROOT/logout?ret=1&#39; method=&#39;post&#39;&gt;&lt;div&gt;&quot;;</td></tr>
<tr><td class="h">2605</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;user&#39; value=&#39;$remote-&gt;{&#39;user&#39;}&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">2606</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2606">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;input type=&#39;hidden&#39; name=&#39;sessid&#39; value=&#39;$remote-&gt;{&#39;_session&#39;}-&gt;{&#39;sessid&#39;}&#39; /&gt;&quot;</td></tr>
<tr><td class="h">2607</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $remote-&gt;session;</td></tr>
<tr><td class="h">2608</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $logout = &quot;&lt;input type=&#39;submit&#39; value=\&quot;$BML::ML{&#39;web.controlstrip.btn.logout&#39;}\&quot; id=&#39;Logout&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">2609</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$remote_display $logout&quot;;</td></tr>
<tr><td class="h">2610</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2610">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp; $links{confirm}&quot; unless $remote-&gt;is_validated;</td></tr>
<tr><td class="h">2611</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/div&gt;&lt;/form&gt;\n&quot;;</td></tr>
<tr><td class="h">2612</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2612">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{home}&amp;nbsp;&amp;nbsp; $links{post_journal}&amp;nbsp;&amp;nbsp;&quot; unless $remote-&gt;is_identity;</td></tr>
<tr><td class="h">2613</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{view_friends_page}&amp;nbsp;&amp;nbsp;$links{inbox}&quot;;</td></tr>
<tr><td class="h">2614</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;\n&quot;;</td></tr>
<tr><td class="h">2615</td><td colspan="7"></td></tr><tr><td class="h">2616</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_actionlinks&#39; nowrap=&#39;nowrap&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2617</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2617">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2617">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2617">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2617">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2617">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (LJ::u_equals($remote, $journal)) {</td></tr>
<tr><td class="h">2618</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2618">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2618">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $view eq &quot;read&quot; ) {</td></tr>
<tr><td class="h">2619</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;yourfriendspage&#39;};</td></tr>
<tr><td class="h">2620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $view eq &quot;network&quot; ) {</td></tr>
<tr><td class="h">2621</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;yourfriendsfriendspage&#39;};</td></tr>
<tr><td class="h">2622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2623</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;yourjournal&#39;};</td></tr>
<tr><td class="h">2624</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2625</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2626</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2626">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $view eq &quot;read&quot; ) {</td></tr>
<tr><td class="h">2627</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @filters = (&quot;all&quot;, $BML::ML{&#39;web.controlstrip.select.friends.all&#39;}, &quot;showpeople&quot;, $BML::ML{&#39;web.controlstrip.select.friends.journals&#39;}, &quot;showcommunities&quot;, $BML::ML{&#39;web.controlstrip.select.friends.communities&#39;}, &quot;showsyndicated&quot;, $BML::ML{&#39;web.controlstrip.select.friends.feeds&#39;});</td></tr>
<tr><td class="h">2628</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %res;</td></tr>
<tr><td class="h">2629</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: Add this in when we have reading filter support!</td></tr>
<tr><td class="h">2630</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %group;</td></tr>
<tr><td class="h">2631</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $k (keys %res) {</td></tr>
<tr><td class="h">2632</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2632">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2632">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($k =~ /^frgrp_(\d+)_name/) {</td></tr>
<tr><td class="h">2633</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group{$1}-&gt;{&#39;name&#39;} = $res{$k};</td></tr>
<tr><td class="h">2634</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2635</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif ($k =~ /^frgrp_(\d+)_sortorder/) {</td></tr>
<tr><td class="h">2636</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$group{$1}-&gt;{&#39;sortorder&#39;} = $res{$k};</td></tr>
<tr><td class="h">2637</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2638</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2639</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $g (sort { $group{$a}-&gt;{&#39;sortorder&#39;} &lt;=&gt; $group{$b}-&gt;{&#39;sortorder&#39;} } keys %group) {</td></tr>
<tr><td class="h">2640</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @filters, &quot;filter:&quot; . lc($group{$g}-&gt;{&#39;name&#39;}), $group{$g}-&gt;{&#39;name&#39;};</td></tr>
<tr><td class="h">2641</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2642</td><td colspan="7"></td></tr><tr><td class="h">2643</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $selected = &quot;all&quot;;</td></tr>
<tr><td class="h">2644</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2644">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2644">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2644">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($r-&gt;uri eq &quot;/read&quot; &amp;&amp; $r-&gt;query_string ne &quot;&quot;) {</td></tr>
<tr><td class="h">2645</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2645">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = &quot;showpeople&quot;      if $r-&gt;query_string eq &quot;show=P&amp;filter=0&quot;;</td></tr>
<tr><td class="h">2646</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2646">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = &quot;showcommunities&quot; if $r-&gt;query_string eq &quot;show=C&amp;filter=0&quot;;</td></tr>
<tr><td class="h">2647</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2647">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = &quot;showsyndicated&quot;  if $r-&gt;query_string eq &quot;show=F&amp;filter=0&quot;;</td></tr>
<tr><td class="h">2648</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($r-&gt;uri =~ /^\/read\/?(.+)?/i) {</td></tr>
<tr><td class="h">2649</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2649">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $filter = $1 || &quot;default view&quot;;</td></tr>
<tr><td class="h">2650</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$selected = &quot;filter:&quot; . LJ::durl(lc($filter));</td></tr>
<tr><td class="h">2651</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2652</td><td colspan="7"></td></tr><tr><td class="h">2653</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{&#39;manage_friends&#39;}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2654</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$BML::ML{&#39;web.controlstrip.select.friends.label&#39;} &lt;form method=&#39;post&#39; style=&#39;display: inline;&#39; action=&#39;$LJ::SITEROOT/manage/circle/filter&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">2655</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden(&quot;user&quot;, $remote-&gt;{&#39;user&#39;}, &quot;mode&quot;, &quot;view&quot;, &quot;type&quot;, &quot;allfilters&quot;);</td></tr>
<tr><td class="h">2656</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_select({&#39;name&#39; =&gt; &quot;view&quot;, &#39;selected&#39; =&gt; $selected }, @filters) . &quot; &quot;;</td></tr>
<tr><td class="h">2657</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_submit($BML::ML{&#39;web.controlstrip.btn.view&#39;});</td></tr>
<tr><td class="h">2658</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/form&gt;&quot;;</td></tr>
<tr><td class="h">2659</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# drop down for various groups and show values</td></tr>
<tr><td class="h">2660</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2661</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{&#39;recent_comments&#39;}&amp;nbsp;&amp;nbsp; $links{&#39;manage_entries&#39;}&amp;nbsp;&amp;nbsp; $links{&#39;invite_friends&#39;}&quot;;</td></tr>
<tr><td class="h">2662</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2663</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($journal-&gt;is_personal || $journal-&gt;is_identity) {</td></tr>
<tr><td class="h">2664</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $trusted = $remote-&gt;trusts( $journal );</td></tr>
<tr><td class="h">2665</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $trusted_by = $journal-&gt;trusts( $remote );</td></tr>
<tr><td class="h">2666</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2666">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2666">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mutual_trust = $trusted &amp;&amp; $trusted_by ? 1 : 0;</td></tr>
<tr><td class="h">2667</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $watched = $remote-&gt;watches( $journal );</td></tr>
<tr><td class="h">2668</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $watched_by = $journal-&gt;watches( $remote );</td></tr>
<tr><td class="h">2669</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2669">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2669">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $mutual_watch = $watched &amp;&amp; $watched_by ? 1 : 0;</td></tr>
<tr><td class="h">2670</td><td colspan="7"></td></tr><tr><td class="h">2671</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2671">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2671">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $mutual_trust &amp;&amp; $mutual_watch ) {</td></tr>
<tr><td class="h">2672</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{mutualtrust_mutualwatch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2673</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2674</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $mutual_trust &amp;&amp; $watched ) {</td></tr>
<tr><td class="h">2675</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{mutualtrust_watch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2676</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2677</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $mutual_trust &amp;&amp; $watched_by ) {</td></tr>
<tr><td class="h">2678</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{mutualtrust_watchedby}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2679</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2680</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted &amp;&amp; $mutual_watch ) {</td></tr>
<tr><td class="h">2681</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trust_mutualwatch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2682</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2683</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted_by &amp;&amp; $mutual_watch ) {</td></tr>
<tr><td class="h">2684</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trustedby_mutualwatch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2685</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2686</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $mutual_trust ) {</td></tr>
<tr><td class="h">2687</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{mutualtrust}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2688</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2689</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $mutual_watch ) {</td></tr>
<tr><td class="h">2690</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{mutualwatch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2691</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2692</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted &amp;&amp; $watched ) {</td></tr>
<tr><td class="h">2693</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trust_watch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2694</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2695</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted &amp;&amp; $watched_by ) {</td></tr>
<tr><td class="h">2696</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trust_watchedby}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2697</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2698</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted_by &amp;&amp; $watched ) {</td></tr>
<tr><td class="h">2699</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trustedby_watch}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2700</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2701</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted_by &amp;&amp; $watched_by ) {</td></tr>
<tr><td class="h">2702</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trustedby_watchedby}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2703</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{add_friend}&quot;;</td></tr>
<tr><td class="h">2704</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted ) {</td></tr>
<tr><td class="h">2705</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trusted}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2706</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2707</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $trusted_by ) {</td></tr>
<tr><td class="h">2708</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{trusted_by}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2709</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{add_friend}&quot;;</td></tr>
<tr><td class="h">2710</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $watched ) {</td></tr>
<tr><td class="h">2711</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{watched}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2712</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_friend}&quot;;</td></tr>
<tr><td class="h">2713</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $watched_by ) {</td></tr>
<tr><td class="h">2714</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{watched_by}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2715</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{add_friend}&quot;;</td></tr>
<tr><td class="h">2716</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2717</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2717">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2717">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $view eq &quot;read&quot; ) {</td></tr>
<tr><td class="h">2718</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personalfriendspage&#39;};</td></tr>
<tr><td class="h">2719</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $view eq &quot;network&quot; ) {</td></tr>
<tr><td class="h">2720</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personalfriendsfriendspage&#39;};</td></tr>
<tr><td class="h">2721</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2722</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personal&#39;};</td></tr>
<tr><td class="h">2723</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2724</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;br /&gt;$links{&#39;add_friend&#39;}&quot;;</td></tr>
<tr><td class="h">2725</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2726</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp; $links{&#39;track_user&#39;}&quot;;</td></tr>
<tr><td class="h">2727</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($journal-&gt;is_community) {</td></tr>
<tr><td class="h">2728</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $watching = $remote-&gt;watches( $journal );</td></tr>
<tr><td class="h">2729</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $memberof = $remote-&gt;member_of( $journal );</td></tr>
<tr><td class="h">2730</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $haspostingaccess = LJ::check_rel($journal, $remote, &#39;P&#39;);</td></tr>
<tr><td class="h">2731</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $isclosedcommunity = $journal-&gt;is_closed_membership;</td></tr>
<tr><td class="h">2732</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2732">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2732">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2732">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2732">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2732">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (LJ::can_manage_other($remote, $journal)) {</td></tr>
<tr><td class="h">2733</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{maintainer}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2734</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2734">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($haspostingaccess) {</td></tr>
<tr><td class="h">2735</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2735">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{post_to_community}&amp;nbsp;&amp;nbsp; &quot; unless $remote-&gt;is_identity;</td></tr>
<tr><td class="h">2736</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2737</td><td colspan="7"></td></tr><tr><td class="h">2738</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2738">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $journal-&gt;prop( &#39;moderated&#39; ) ) {</td></tr>
<tr><td class="h">2739</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{queue} [&quot; . LJ::get_mod_queue_count( $journal ) . &quot;]&amp;nbsp;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">2740</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2741</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_community_profile}&amp;nbsp;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">2742</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2743</td><td colspan="7"></td></tr><tr><td class="h">2744</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{edit_community_invites}&amp;nbsp;&amp;nbsp;$links{edit_community_members}&quot;;</td></tr>
<tr><td class="h">2745</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($watching &amp;&amp; $memberof) {</td></tr>
<tr><td class="h">2746</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{memberwatcher}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2747</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2747">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($haspostingaccess) {</td></tr>
<tr><td class="h">2748</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{post_to_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2749</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2750</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $links{leave_community};</td></tr>
<tr><td class="h">2751</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp;&quot; . $links{track_community};</td></tr>
<tr><td class="h">2752</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($watching) {</td></tr>
<tr><td class="h">2753</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{watcher}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2754</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2754">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($haspostingaccess) {</td></tr>
<tr><td class="h">2755</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{post_to_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2756</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2757</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2757">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $isclosedcommunity ? &quot;This is a closed community&amp;nbsp;&amp;nbsp; &quot; :</td></tr>
<tr><td class="h">2758</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;$links{join_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2759</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $links{unwatch_community};</td></tr>
<tr><td class="h">2760</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp;&quot; . $links{track_community};</td></tr>
<tr><td class="h">2761</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($memberof) {</td></tr>
<tr><td class="h">2762</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{member}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2763</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2763">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($haspostingaccess) {</td></tr>
<tr><td class="h">2764</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{post_to_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2765</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2766</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{watch_community}&amp;nbsp;&amp;nbsp; $links{&#39;leave_community&#39;}&quot;;</td></tr>
<tr><td class="h">2767</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp;&quot; . $links{track_community};</td></tr>
<tr><td class="h">2768</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2769</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{community}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2770</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2770">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($haspostingaccess) {</td></tr>
<tr><td class="h">2771</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{post_to_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2772</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2773</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2773">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $isclosedcommunity ? &quot;This is a closed community&amp;nbsp;&amp;nbsp; &quot; :</td></tr>
<tr><td class="h">2774</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;$links{join_community}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2775</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $links{watch_community};</td></tr>
<tr><td class="h">2776</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&amp;nbsp;&quot; . $links{track_community};</td></tr>
<tr><td class="h">2777</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2778</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($journal-&gt;is_syndicated) {</td></tr>
<tr><td class="h">2779</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{syn}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2780</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2780">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2780">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2780">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2780">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $remote &amp;&amp; !$remote-&gt;watches( $journal ) ) {</td></tr>
<tr><td class="h">2781</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{add_friend}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2782</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $remote &amp;&amp; $remote-&gt;watches( $journal ) ) {</td></tr>
<tr><td class="h">2783</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{remove_friend}&amp;nbsp;&amp;nbsp; &quot;;</td></tr>
<tr><td class="h">2784</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2785</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $links{syndicated_list};</td></tr>
<tr><td class="h">2786</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2787</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$statustext{other}&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2788</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">2789</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2790</td><td colspan="7"></td></tr><tr><td class="h">2791</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::run_hook(&#39;control_strip_logo&#39;, $remote, $journal);</td></tr>
<tr><td class="h">2792</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2793</td><td colspan="7"></td></tr><tr><td class="h">2794</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2795</td><td colspan="7"></td></tr><tr><td class="h">2796</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $show_login_form = LJ::run_hook(&quot;show_control_strip_login_form&quot;, $journal);</td></tr>
<tr><td class="h">2797</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2797">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$show_login_form = 1 if !defined $show_login_form;</td></tr>
<tr><td class="h">2798</td><td colspan="7"></td></tr><tr><td class="h">2799</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2799">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($show_login_form) {</td></tr>
<tr><td class="h">2800</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $chal = LJ::challenge_generate(300);</td></tr>
<tr><td class="h">2801</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2801">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $contents = LJ::run_hook(&#39;control_strip_userpic_contents&#39;, $euri) || &quot;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">2802</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &lt;&lt;&quot;LOGIN_BAR&quot;;</td></tr>
<tr><td class="h">2803</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td id=&#39;lj_controlstrip_userpic&#39;&gt;$contents&lt;/td&gt;</td></tr>
<tr><td class="h">2804</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td id=&#39;lj_controlstrip_login&#39; style=&#39;background-image: none;&#39; nowrap=&#39;nowrap&#39;&gt;&lt;form id=&quot;login&quot; class=&quot;lj_login_form&quot; action=&quot;$LJ::SITEROOT/login?ret=1&quot; method=&quot;post&quot;&gt;&lt;div&gt;</td></tr>
<tr><td class="h">2805</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;mode&quot; value=&quot;login&quot; /&gt;</td></tr>
<tr><td class="h">2806</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&#39;hidden&#39; name=&#39;chal&#39; id=&#39;login_chal&#39; class=&#39;lj_login_chal&#39; value=&#39;$chal&#39; /&gt;</td></tr>
<tr><td class="h">2807</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=&#39;hidden&#39; name=&#39;response&#39; id=&#39;login_response&#39; class=&#39;lj_login_response&#39; value=&#39;&#39; /&gt;</td></tr>
<tr><td class="h">2808</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;margin-right: 1em;&quot;&gt;&lt;tr&gt;&lt;td&gt;</td></tr>
<tr><td class="h">2809</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label for=&quot;xc_user&quot;&gt;$BML::ML{&#39;/login.bml.login.username&#39;}&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;user&quot; size=&quot;7&quot; maxlength=&quot;27&quot; tabindex=&quot;1&quot; id=&quot;xc_user&quot; value=&quot;&quot; /&gt;</td></tr>
<tr><td class="h">2810</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;&lt;td&gt;</td></tr>
<tr><td class="h">2811</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;label style=&quot;margin-left: 3px;&quot; for=&quot;xc_password&quot;&gt;$BML::ML{&#39;/login.bml.login.password&#39;}&lt;/label&gt; &lt;input type=&quot;password&quot; name=&quot;password&quot; size=&quot;7&quot; tabindex=&quot;2&quot; id=&quot;xc_password&quot; class=&#39;lj_login_password&#39; /&gt;</td></tr>
<tr><td class="h">2812</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">LOGIN_BAR</td></tr>
<tr><td class="h">2813</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;input type=&#39;submit&#39; value=\&quot;$BML::ML{&#39;web.controlstrip.btn.login&#39;}\&quot; tabindex=&#39;4&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">2814</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">2815</td><td colspan="7"></td></tr><tr><td class="h">2816</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;tr&gt;&lt;td valign=&#39;top&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2817</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;a href=&#39;$LJ::SITEROOT/lostinfo&#39;&gt;$BML::ML{&#39;web.controlstrip.login.forgot&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2818</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot; &lt;a href=&#39;$LJ::SITEROOT/openid/&#39;&gt;$BML::ML{&#39;web.controlstrip.login.openid&#39;}&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2819</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&lt;td style=&#39;font: 10px Arial, Helvetica, sans-serif;&#39; valign=&#39;top&#39; colspan=&#39;2&#39; align=&#39;right&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2820</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;input type=&#39;checkbox&#39; id=&#39;xc_remember&#39; name=&#39;remember_me&#39; style=&#39;height: 10px; width: 10px;&#39; tabindex=&#39;3&#39; /&gt;&quot;;</td></tr>
<tr><td class="h">2821</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;label for=&#39;xc_remember&#39;&gt;$BML::ML{&#39;web.controlstrip.login.remember&#39;}&lt;/label&gt;&quot;;</td></tr>
<tr><td class="h">2822</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;;</td></tr>
<tr><td class="h">2823</td><td colspan="7"></td></tr><tr><td class="h">2824</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &#39;&lt;/div&gt;&lt;/form&gt;&lt;/td&gt;&#39;;</td></tr>
<tr><td class="h">2825</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2826</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2826">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $contents = LJ::run_hook(&#39;control_strip_loggedout_userpic_contents&#39;, $euri) || &quot;&amp;nbsp;&quot;;</td></tr>
<tr><td class="h">2827</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_loggedout_userpic&#39;&gt;$contents&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2828</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2829</td><td colspan="7"></td></tr><tr><td class="h">2830</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_actionlinks&#39; nowrap=&#39;nowrap&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2831</td><td colspan="7"></td></tr><tr><td class="h">2832</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2832">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2832">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2832">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2832">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($journal-&gt;is_personal || $journal-&gt;is_identity) {</td></tr>
<tr><td class="h">2833</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2833">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2833">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $view eq &quot;read&quot; ) {</td></tr>
<tr><td class="h">2834</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personalfriendspage&#39;};</td></tr>
<tr><td class="h">2835</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ( $view eq &quot;network&quot; ) {</td></tr>
<tr><td class="h">2836</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personalfriendsfriendspage&#39;};</td></tr>
<tr><td class="h">2837</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2838</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;personal&#39;};</td></tr>
<tr><td class="h">2839</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2840</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($journal-&gt;is_community) {</td></tr>
<tr><td class="h">2841</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;community&#39;};</td></tr>
<tr><td class="h">2842</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($journal-&gt;is_syndicated) {</td></tr>
<tr><td class="h">2843</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;syn&#39;};</td></tr>
<tr><td class="h">2844</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2845</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= $statustext{&#39;other&#39;};</td></tr>
<tr><td class="h">2846</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2847</td><td colspan="7"></td></tr><tr><td class="h">2848</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">2849</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2849">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{&#39;login&#39;}&amp;nbsp;&amp;nbsp; &quot; unless $show_login_form;</td></tr>
<tr><td class="h">2850</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;$links{&#39;create_account&#39;}&amp;nbsp;&amp;nbsp; $links{&#39;learn_more&#39;}&quot;;</td></tr>
<tr><td class="h">2851</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::run_hook(&#39;control_strip_logo&#39;, $remote, $journal);</td></tr>
<tr><td class="h">2852</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2853</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2854</td><td colspan="7"></td></tr><tr><td class="h">2855</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# search box and ?style=mine/?style=light options</td></tr>
<tr><td class="h">2856</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @view_options;</td></tr>
<tr><td class="h">2857</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#determine whether style is &quot;mine&quot;, and define new uri variable to manipulate</td></tr>
<tr><td class="h">2858</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#note: all expressions case-insensitive</td></tr>
<tr><td class="h">2859</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $currentstylemine = ($uri =~ m/style=mine/i);</td></tr>
<tr><td class="h">2860</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $newuri = $uri;</td></tr>
<tr><td class="h">2861</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#manipulate destination URI for the style links</td></tr>
<tr><td class="h">2862</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2862">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($currentstylemine) {</td></tr>
<tr><td class="h">2863</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#if last character before style=mine is a &amp;, it can be deleted together with style=mine, </td></tr>
<tr><td class="h">2864</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#since a ? will still be in front of the other arguments in the string</td></tr>
<tr><td class="h">2865</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2865">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($newuri =~ m/\&amp;style=mine/i) {</td></tr>
<tr><td class="h">2866</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newuri =~ s/\&amp;style=mine//i;</td></tr>
<tr><td class="h">2867</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2868</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#else the last character before style=mine was a &quot;?&quot; and should not be deleted.</td></tr>
<tr><td class="h">2869</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#also, delete &quot;&amp;&quot; after style=mine if there is one</td></tr>
<tr><td class="h">2870</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newuri =~ s/style=mine\&amp;?//i;</td></tr>
<tr><td class="h">2871</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2872</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#delete any trailing character - for example</td></tr>
<tr><td class="h">2873</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#trailing &quot;?&quot; if only &quot;?style=mine&quot; was present in the first place</td></tr>
<tr><td class="h">2874</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$newuri =~ s/\W$//;</td></tr>
<tr><td class="h">2875</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2876</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $querysep2;</td></tr>
<tr><td class="h">2877</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#check whether newuri still has arguments to determine whether &quot;?&quot; or &quot;&amp;&quot; needs to be used for next argument added</td></tr>
<tr><td class="h">2878</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2878">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($newuri =~ m/\?/) {</td></tr>
<tr><td class="h">2879</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$querysep2 = &quot;&amp;&quot;;</td></tr>
<tr><td class="h">2880</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2881</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$querysep2 = &quot;?&quot;;</td></tr>
<tr><td class="h">2882</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2883</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#appropriate links depending on whether style is &quot;mine&quot;</td></tr>
<tr><td class="h">2884</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2884">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($remote) {</td></tr>
<tr><td class="h">2885</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2885">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($currentstylemine) {</td></tr>
<tr><td class="h">2886</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @view_options, &quot;&lt;a href=&#39;$newuri&#39;&gt;&quot; . LJ::Lang::ml( &#39;web.controlstrip.reloadpage.origstyle&#39; ) . &quot;&lt;/a&gt;&quot;</td></tr>
<tr><td class="h">2887</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">2888</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @view_options, &quot;&lt;a href=&#39;$newuri${querysep2}style=mine&#39;&gt;&quot; . LJ::Lang::ml( &#39;web.controlstrip.reloadpage.mystyle&#39; ) . &quot;&lt;/a&gt;&quot;</td></tr>
<tr><td class="h">2889</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2890</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2891</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#style=light available on every page that supports showing the navstrip</td></tr>
<tr><td class="h">2892</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @view_options, &quot;&lt;a href=&#39;$newuri${querysep2}style=light&#39;&gt;&quot; . LJ::Lang::ml( &#39;web.controlstrip.reloadpage.lightstyle&#39; ) . &quot;&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">2893</td><td colspan="7"></td></tr><tr><td class="h">2894</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;td id=&#39;lj_controlstrip_search&#39;&gt;&quot;;</td></tr>
<tr><td class="h">2895</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::Widget::Search-&gt;render;</td></tr>
<tr><td class="h">2896</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2896">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::Lang::ml( &#39;web.controlstrip.reloadpage&#39; ) . &quot;&amp;nbsp;&amp;nbsp; &quot;</td></tr>
<tr><td class="h">2897</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if @view_options;</td></tr>
<tr><td class="h">2898</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= join( &quot;&amp;nbsp;&amp;nbsp; &quot;, @view_options );</td></tr>
<tr><td class="h">2899</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">2900</td><td colspan="7"></td></tr><tr><td class="h">2901</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;table id=&#39;lj_controlstrip&#39; cellpadding=&#39;0&#39; cellspacing=&#39;0&#39;&gt;&lt;tr valign=&#39;top&#39;&gt;$ret&lt;/tr&gt;&lt;/table&gt;&quot;;</td></tr>
<tr><td class="h">2902</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2903</td><td colspan="7"></td></tr><tr><td class="h">2904</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub control_strip_js_inject</td></tr>
<tr><td class="h">2905</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">2906</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2906">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %opts = @_;</td></tr>
<tr><td class="h">2907</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $user = delete $opts{user};</td></tr>
<tr><td class="h">2908</td><td colspan="7"></td></tr><tr><td class="h">2909</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret;</td></tr>
<tr><td class="h">2910</td><td colspan="7"></td></tr><tr><td class="h">2911</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;script src=&#39;$LJ::JSPREFIX/core.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;\n&quot;;</td></tr>
<tr><td class="h">2912</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;script src=&#39;$LJ::JSPREFIX/dom.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;\n&quot;;</td></tr>
<tr><td class="h">2913</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;script src=&#39;$LJ::JSPREFIX/httpreq.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;\n&quot;;</td></tr>
<tr><td class="h">2914</td><td colspan="7"></td></tr><tr><td class="h">2915</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(qw(</td></tr>
<tr><td class="h">2916</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/livejournal.js</td></tr>
<tr><td class="h">2917</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/md5.js</td></tr>
<tr><td class="h">2918</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;js/login.js</td></tr>
<tr><td class="h">2919</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;));</td></tr>
<tr><td class="h">2920</td><td colspan="7"></td></tr><tr><td class="h">2921</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $r = DW::Request-&gt;get;</td></tr>
<tr><td class="h">2922</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $baseuri = $r-&gt;header_in( &#39;Host&#39; ) . $r-&gt;uri;</td></tr>
<tr><td class="h">2923</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $args = LJ::eurl( $r-&gt;query_string );</td></tr>
<tr><td class="h">2924</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $view = $r-&gt;note( &#39;view&#39; );</td></tr>
<tr><td class="h">2925</td><td colspan="7"></td></tr><tr><td class="h">2926</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq{</td></tr>
<tr><td class="h">2927</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&#39;text/javascript&#39;&gt;</td></tr>
<tr><td class="h">2928</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;function controlstrip_init() {</td></tr>
<tr><td class="h">2929</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! \$(&#39;lj_controlstrip&#39;) ){</td></tr>
<tr><td class="h">2930</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTPReq.getJSON({</td></tr>
<tr><td class="h">2931</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url: &quot;/$user/__rpc_controlstrip?user=$user&amp;baseuri=$baseuri&amp;args=$args&amp;view=$view&quot;,</td></tr>
<tr><td class="h">2932</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onData: function (data) {</td></tr>
<tr><td class="h">2933</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var body = document.getElementsByTagName(&quot;body&quot;)[0];</td></tr>
<tr><td class="h">2934</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var div = document.createElement(&quot;div&quot;);</td></tr>
<tr><td class="h">2935</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;div.innerHTML = data;</td></tr>
<tr><td class="h">2936</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body.appendChild(div);</td></tr>
<tr><td class="h">2937</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},</td></tr>
<tr><td class="h">2938</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onError: function (msg) { }</td></tr>
<tr><td class="h">2939</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">2940</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2941</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2942</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;DOM.addEventListener(window, &quot;load&quot;, controlstrip_init);</td></tr>
<tr><td class="h">2943</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;/script&gt;</td></tr>
<tr><td class="h">2944</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">2945</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2946</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2947</td><td colspan="7"></td></tr><tr><td class="h">2948</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># For the Rich Text Editor</td></tr>
<tr><td class="h">2949</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Set JS variables for use by the RTE</td></tr>
<tr><td class="h">2950</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub rte_js_vars {</td></tr>
<tr><td class="h">2951</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2951">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($remote) = @_;</td></tr>
<tr><td class="h">2952</td><td colspan="7"></td></tr><tr><td class="h">2953</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &#39;&#39;;</td></tr>
<tr><td class="h">2954</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# The JS var canmakepoll is used by fckplugin.js to change the behaviour</td></tr>
<tr><td class="h">2955</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# of the poll button in the RTE.</td></tr>
<tr><td class="h">2956</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Also remove any RTE buttons that have been set to disabled.</td></tr>
<tr><td class="h">2957</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $canmakepoll = &quot;true&quot;;</td></tr>
<tr><td class="h">2958</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2958">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2958">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$canmakepoll = &quot;false&quot; if ($remote &amp;&amp; !LJ::get_cap($remote, &#39;makepoll&#39;));</td></tr>
<tr><td class="h">2959</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;script type=&#39;text/javascript&#39;&gt;\n&quot;;</td></tr>
<tr><td class="h">2960</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;    var RTEdisabled = new Array();\n&quot;;</td></tr>
<tr><td class="h">2961</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2961">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $rte_disabled = $LJ::DISABLED{rte_buttons} || {};</td></tr>
<tr><td class="h">2962</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $key (keys %$rte_disabled) {</td></tr>
<tr><td class="h">2963</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2963">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;    RTEdisabled[&#39;$key&#39;] = true;&quot; if $rte_disabled-&gt;{$key};</td></tr>
<tr><td class="h">2964</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2965</td><td colspan="7"></td></tr><tr><td class="h">2966</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# detect whether image upload and photobucket are set up</td></tr>
<tr><td class="h">2967</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2967">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $photobucket_is_setup = $LJ::PHOTOBUCKET_JWIDGET_ID ? &quot;true&quot; : &quot;false&quot;;</td></tr>
<tr><td class="h">2968</td><td colspan="7"></td></tr><tr><td class="h">2969</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq^</td></tr>
<tr><td class="h">2970</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var canmakepoll = $canmakepoll;</td></tr>
<tr><td class="h">2971</td><td colspan="7"></td></tr><tr><td class="h">2972</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function removeDisabled(ToolbarSet) {</td></tr>
<tr><td class="h">2973</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i=0; i&lt;ToolbarSet.length; i++) {</td></tr>
<tr><td class="h">2974</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var j=0; j&lt;ToolbarSet[i].length; j++) {</td></tr>
<tr><td class="h">2975</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (RTEdisabled[ToolbarSet[i][j]] == true) ToolbarSet[i].splice(j,1);</td></tr>
<tr><td class="h">2976</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2977</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2978</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">2979</td><td colspan="7"></td></tr><tr><td class="h">2980</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var SiteConfig = new Object();</td></tr>
<tr><td class="h">2981</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SiteConfig.ImagePhotobucket = $photobucket_is_setup;</td></tr>
<tr><td class="h">2982</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;^;</td></tr>
<tr><td class="h">2983</td><td colspan="7"></td></tr><tr><td class="h">2984</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">2985</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">2986</td><td colspan="7"></td></tr><tr><td class="h">2987</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># prints out UI for subscribing to some events</td></tr>
<tr><td class="h">2988</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub subscribe_interface {</td></tr>
<tr><td class="h">2989</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L2989">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($u, %opts) = @_;</td></tr>
<tr><td class="h">2990</td><td colspan="7"></td></tr><tr><td class="h">2991</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L2991">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;subscribe_interface wants a \$u&quot; unless LJ::isu($u);</td></tr>
<tr><td class="h">2992</td><td colspan="7"></td></tr><tr><td class="h">2993</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $catref       = delete $opts{&#39;categories&#39;};</td></tr>
<tr><td class="h">2994</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2994">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $journalu     = delete $opts{&#39;journal&#39;} || LJ::get_remote();</td></tr>
<tr><td class="h">2995</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2995">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $formauth     = delete $opts{&#39;formauth&#39;} || LJ::form_auth();</td></tr>
<tr><td class="h">2996</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2996">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $showtracking = delete $opts{&#39;showtracking&#39;} || 0;</td></tr>
<tr><td class="h">2997</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2997">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $getextra     = delete $opts{&#39;getextra&#39;} || &#39;&#39;;</td></tr>
<tr><td class="h">2998</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2998">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret_url      = delete $opts{ret_url} || &#39;&#39;;</td></tr>
<tr><td class="h">2999</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L2999">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $def_notes    = delete $opts{&#39;default_selected_notifications&#39;} || [];</td></tr>
<tr><td class="h">3000</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3000">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $settings_page= delete $opts{&#39;settings_page&#39;} || 0;</td></tr>
<tr><td class="h">3001</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3001">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $post_to_settings_page = delete $opts{&#39;post_to_settings_page&#39;} || 0;</td></tr>
<tr><td class="h">3002</td><td colspan="7"></td></tr><tr><td class="h">3003</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3003">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Invalid user object passed to subscribe_interface&quot; unless LJ::isu($journalu);</td></tr>
<tr><td class="h">3004</td><td colspan="7"></td></tr><tr><td class="h">3005</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3005">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak &quot;Invalid options passed to subscribe_interface&quot; if (scalar keys %opts);</td></tr>
<tr><td class="h">3006</td><td colspan="7"></td></tr><tr><td class="h">3007</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;stc/esn.css&#39;);</td></tr>
<tr><td class="h">3008</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;js/core.js&#39;);</td></tr>
<tr><td class="h">3009</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;js/dom.js&#39;);</td></tr>
<tr><td class="h">3010</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;js/checkallbutton.js&#39;);</td></tr>
<tr><td class="h">3011</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&#39;js/esn.js&#39;);</td></tr>
<tr><td class="h">3012</td><td colspan="7"></td></tr><tr><td class="h">3013</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3013">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @categories = $catref ? @$catref : ();</td></tr>
<tr><td class="h">3014</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ui_inbox  = BML::ml(&#39;subscribe_interface.inbox&#39;);</td></tr>
<tr><td class="h">3015</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ui_manage = BML::ml(&#39;subscribe_interface.manage_settings&#39;);</td></tr>
<tr><td class="h">3016</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ui_notify = BML::ml(&#39;subscribe_interface.notify_me2&#39;, { sitenameabbrev =&gt; $LJ::SITENAMEABBREV });</td></tr>
<tr><td class="h">3017</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ui_by     = BML::ml(&#39;subscribe_interface.by2&#39;);</td></tr>
<tr><td class="h">3018</td><td colspan="7"></td></tr><tr><td class="h">3019</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret = &quot;&lt;div id=&#39;manageSettings&#39;&gt;&quot;;</td></tr>
<tr><td class="h">3020</td><td colspan="7"></td></tr><tr><td class="h">3021</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3021">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($settings_page) {</td></tr>
<tr><td class="h">3022</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;span class=&#39;esnlinks&#39;&gt;&lt;a href=&#39;$LJ::SITEROOT/inbox/&#39;&gt;$ui_inbox&lt;/a&gt; | $ui_manage&lt;/span&gt;&quot;;</td></tr>
<tr><td class="h">3023</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3024</td><td colspan="7"></td></tr><tr><td class="h">3025</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3025">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3025">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($post_to_settings_page) {</td></tr>
<tr><td class="h">3026</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;form method=&#39;POST&#39; action=&#39;$LJ::SITEROOT/manage/settings/?cat=notifications&#39;&gt;$formauth&quot;;</td></tr>
<tr><td class="h">3027</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;} elsif (!$settings_page) {</td></tr>
<tr><td class="h">3028</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;form method=&#39;POST&#39; action=&#39;$LJ::SITEROOT/manage/subscriptions/$getextra&#39;&gt;$formauth&quot;;</td></tr>
<tr><td class="h">3029</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3030</td><td colspan="7"></td></tr><tr><td class="h">3031</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3031">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $events_table = $settings_page ? &#39;&lt;table class=&quot;Subscribe&quot; style=&quot;clear: none;&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&#39; : &#39;&lt;table class=&quot;Subscribe&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&#39;;</td></tr>
<tr><td class="h">3032</td><td colspan="7"></td></tr><tr><td class="h">3033</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3033">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @notify_classes = LJ::NotificationMethod-&gt;all_classes or return &quot;No notification methods&quot;;</td></tr>
<tr><td class="h">3034</td><td colspan="7"></td></tr><tr><td class="h">3035</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# skip the inbox type; it&#39;s always on</td></tr>
<tr><td class="h">3036</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@notify_classes = grep { $_ ne &#39;LJ::NotificationMethod::Inbox&#39; } @notify_classes;</td></tr>
<tr><td class="h">3037</td><td colspan="7"></td></tr><tr><td class="h">3038</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tracking = [];</td></tr>
<tr><td class="h">3039</td><td colspan="7"></td></tr><tr><td class="h">3040</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# title of the tracking category</td></tr>
<tr><td class="h">3041</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $tracking_cat = &quot;Subscription Tracking&quot;;</td></tr>
<tr><td class="h">3042</td><td colspan="7"></td></tr><tr><td class="h">3043</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if showtracking, add things the user is tracking to the categories</td></tr>
<tr><td class="h">3044</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3044">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ($showtracking) {</td></tr>
<tr><td class="h">3045</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @subscriptions = $u-&gt;find_subscriptions(method =&gt; &#39;Inbox&#39;);</td></tr>
<tr><td class="h">3046</td><td colspan="7"></td></tr><tr><td class="h">3047</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $subsc ( sort {$a-&gt;id &lt;=&gt; $b-&gt;id } @subscriptions ) {</td></tr>
<tr><td class="h">3048</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if this event class is already being displayed above, skip over it</td></tr>
<tr><td class="h">3049</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3049">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $etypeid = $subsc-&gt;etypeid or next;</td></tr>
<tr><td class="h">3050</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($evt_class) = (LJ::Event-&gt;class($etypeid) =~ /LJ::Event::(.+)/i);</td></tr>
<tr><td class="h">3051</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3051">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $evt_class;</td></tr>
<tr><td class="h">3052</td><td colspan="7"></td></tr><tr><td class="h">3053</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# search for this class in categories</td></tr>
<tr><td class="h">3054</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3054">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if grep { $_ eq $evt_class } map { @$_ } map { values %$_ } @categories;</td></tr>
<tr><td class="h">3055</td><td colspan="7"></td></tr><tr><td class="h">3056</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @$tracking, $subsc;</td></tr>
<tr><td class="h">3057</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3058</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3059</td><td colspan="7"></td></tr><tr><td class="h">3060</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;push @categories, {$tracking_cat =&gt; $tracking};</td></tr>
<tr><td class="h">3061</td><td colspan="7"></td></tr><tr><td class="h">3062</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @catids;</td></tr>
<tr><td class="h">3063</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $catid = 0;</td></tr>
<tr><td class="h">3064</td><td colspan="7"></td></tr><tr><td class="h">3065</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %shown_subids = ();</td></tr>
<tr><td class="h">3066</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# ( LJ::NotificationMethod::Inbox =&gt; {active =&gt; x, total =&gt; y }, LJ::NotificationMethod::Email =&gt; ...)</td></tr>
<tr><td class="h">3067</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %num_subs_by_type = ();</td></tr>
<tr><td class="h">3068</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $cat_hash (@categories) {</td></tr>
<tr><td class="h">3069</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($category, $cat_events) = %$cat_hash;</td></tr>
<tr><td class="h">3070</td><td colspan="7"></td></tr><tr><td class="h">3071</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @catids, $catid;</td></tr>
<tr><td class="h">3072</td><td colspan="7"></td></tr><tr><td class="h">3073</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# pending subscription objects</td></tr>
<tr><td class="h">3074</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pending = [];</td></tr>
<tr><td class="h">3075</td><td colspan="7"></td></tr><tr><td class="h">3076</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cat_empty = 1;</td></tr>
<tr><td class="h">3077</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cat_html = &#39;&#39;;</td></tr>
<tr><td class="h">3078</td><td colspan="7"></td></tr><tr><td class="h">3079</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is this category the tracking category?</td></tr>
<tr><td class="h">3080</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $is_tracking_category = $category eq $tracking_cat;</td></tr>
<tr><td class="h">3081</td><td colspan="7"></td></tr><tr><td class="h">3082</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# build table of subscribeble events</td></tr>
<tr><td class="h">3083</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $cat_event (@$cat_events) {</td></tr>
<tr><td class="h">3084</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3084">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3084">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((ref $cat_event) =~ /Subscription/) {</td></tr>
<tr><td class="h">3085</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @$pending, $cat_event;</td></tr>
<tr><td class="h">3086</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($cat_event =~ /^LJ::Setting/) {</td></tr>
<tr><td class="h">3087</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# special subscription that&#39;s an LJ::Setting instead of an LJ::Subscription</td></tr>
<tr><td class="h">3088</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3088">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($settings_page) {</td></tr>
<tr><td class="h">3089</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @$pending, $cat_event;</td></tr>
<tr><td class="h">3090</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3091</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">3092</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3093</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3094</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $pending_sub = LJ::Subscription::Pending-&gt;new($u,</td></tr>
<tr><td class="h">3095</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event =&gt; $cat_event,</td></tr>
<tr><td class="h">3096</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;journal =&gt; $journalu);</td></tr>
<tr><td class="h">3097</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @$pending, $pending_sub;</td></tr>
<tr><td class="h">3098</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3099</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3100</td><td colspan="7"></td></tr><tr><td class="h">3101</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cat_title_key = lc($category);</td></tr>
<tr><td class="h">3102</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_title_key =~ s/ /-/g;</td></tr>
<tr><td class="h">3103</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cat_title = BML::ml(&#39;subscribe_interface.category.&#39;.$cat_title_key);</td></tr>
<tr><td class="h">3104</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3104">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $first_class = $catid == 0 ? &quot; CategoryRowFirst&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">3105</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= qq {</td></tr>
<tr><td class="h">3106</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class=&quot;CategoryRow-$catid&quot;&gt;</td></tr>
<tr><td class="h">3107</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr class=&quot;CategoryRow$first_class&quot;&gt;</td></tr>
<tr><td class="h">3108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;</td></tr>
<tr><td class="h">3109</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class=&quot;CategoryHeading&quot;&gt;$cat_title&lt;/span&gt;&lt;br /&gt;</td></tr>
<tr><td class="h">3110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class=&quot;CategoryHeadingNote&quot;&gt;$ui_notify&lt;/span&gt;</td></tr>
<tr><td class="h">3111</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;</td></tr>
<tr><td class="h">3112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td class=&quot;Caption&quot;&gt;</td></tr>
<tr><td class="h">3113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ui_by</td></tr>
<tr><td class="h">3114</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;</td></tr>
<tr><td class="h">3115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">3116</td><td colspan="7"></td></tr><tr><td class="h">3117</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @pending_subscriptions;</td></tr>
<tr><td class="h">3118</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# build list of subscriptions to show the user</td></tr>
<tr><td class="h">3119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</td></tr>
<tr><td class="h">3120</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3120">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($is_tracking_category) {</td></tr>
<tr><td class="h">3121</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $pending_sub (@$pending) {</td></tr>
<tr><td class="h">3122</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3122">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!ref $pending_sub) {</td></tr>
<tr><td class="h">3123</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @pending_subscriptions, $pending_sub;</td></tr>
<tr><td class="h">3124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3125</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %sub_args = $pending_sub-&gt;sub_info;</td></tr>
<tr><td class="h">3126</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $sub_args{ntypeid};</td></tr>
<tr><td class="h">3127</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_args{method} = &#39;Inbox&#39;;</td></tr>
<tr><td class="h">3128</td><td colspan="7"></td></tr><tr><td class="h">3129</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @existing_subs = $u-&gt;has_subscription(%sub_args);</td></tr>
<tr><td class="h">3130</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3130">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @pending_subscriptions, (scalar @existing_subs ? @existing_subs : $pending_sub);</td></tr>
<tr><td class="h">3131</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3132</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3134</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @pending_subscriptions, @$tracking;</td></tr>
<tr><td class="h">3135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3137</td><td colspan="7"></td></tr><tr><td class="h">3138</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# add notifytype headings</td></tr>
<tr><td class="h">3139</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $notify_class (@notify_classes) {</td></tr>
<tr><td class="h">3140</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3140">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $title = eval { $notify_class-&gt;title($u) } or next;</td></tr>
<tr><td class="h">3141</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3141">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ntypeid = $notify_class-&gt;ntypeid or next;</td></tr>
<tr><td class="h">3142</td><td colspan="7"></td></tr><tr><td class="h">3143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# create the checkall box for this event type.</td></tr>
<tr><td class="h">3144</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $disabled = ! $notify_class-&gt;configured_for_user($u);</td></tr>
<tr><td class="h">3145</td><td colspan="7"></td></tr><tr><td class="h">3146</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3146">0</a></div><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3146">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3146">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($notify_class-&gt;disabled_url &amp;&amp; $disabled) {</td></tr>
<tr><td class="h">3147</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$title = &quot;&lt;a href=&#39;&quot; . $notify_class-&gt;disabled_url . &quot;&#39;&gt;$title&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">3148</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} elsif ($notify_class-&gt;url) {</td></tr>
<tr><td class="h">3149</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$title = &quot;&lt;a href=&#39;&quot; . $notify_class-&gt;url . &quot;&#39;&gt;$title&lt;/a&gt;&quot;;</td></tr>
<tr><td class="h">3150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3151</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3151">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$title .= &quot; &quot; . LJ::help_icon($notify_class-&gt;help_url) if $notify_class-&gt;help_url;</td></tr>
<tr><td class="h">3152</td><td colspan="7"></td></tr><tr><td class="h">3153</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $checkall_box = LJ::html_check({</td></tr>
<tr><td class="h">3154</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id       =&gt; &quot;CheckAll-$catid-$ntypeid&quot;,</td></tr>
<tr><td class="h">3155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label    =&gt; $title,</td></tr>
<tr><td class="h">3156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class    =&gt; &quot;CheckAll&quot;,</td></tr>
<tr><td class="h">3157</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noescape =&gt; 1,</td></tr>
<tr><td class="h">3158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disabled =&gt; $disabled,</td></tr>
<tr><td class="h">3159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">3160</td><td colspan="7"></td></tr><tr><td class="h">3161</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= qq {</td></tr>
<tr><td class="h">3162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td style=&#39;vertical-align: bottom;&#39;&gt;</td></tr>
<tr><td class="h">3163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$checkall_box</td></tr>
<tr><td class="h">3164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;</td></tr>
<tr><td class="h">3165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">3166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3167</td><td colspan="7"></td></tr><tr><td class="h">3168</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &#39;&lt;/tr&gt;&#39;;</td></tr>
<tr><td class="h">3169</td><td colspan="7"></td></tr><tr><td class="h">3170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# inbox method</td></tr>
<tr><td class="h">3171</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $special_subs = 0;</td></tr>
<tr><td class="h">3172</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sub_count = 0;</td></tr>
<tr><td class="h">3173</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $pending_sub (@pending_subscriptions) {</td></tr>
<tr><td class="h">3174</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3174">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!ref $pending_sub) {</td></tr>
<tr><td class="h">3175</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3175">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3175">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $u-&gt;is_identity &amp;&amp; $pending_sub-&gt;disabled($u);</td></tr>
<tr><td class="h">3176</td><td colspan="7"></td></tr><tr><td class="h">3177</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3177">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $disabled_class = $pending_sub-&gt;disabled($u) ? &quot;Disabled&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">3178</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3178">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $altrow_class = $sub_count % 2 == 1 ? &quot;altrow&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">3179</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3179">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $hidden = $pending_sub-&gt;selected($u) ? &quot;&quot; : &quot; style=&#39;visibility: hidden;&#39;&quot;;</td></tr>
<tr><td class="h">3180</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $sub_title = &quot; &quot; . $pending_sub-&gt;htmlcontrol_label($u);</td></tr>
<tr><td class="h">3181</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3181">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_title = LJ::run_hook(&quot;disabled_esn_sub&quot;, $u) . $sub_title if $pending_sub-&gt;disabled($u);</td></tr>
<tr><td class="h">3182</td><td colspan="7"></td></tr><tr><td class="h">3183</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;tr class=&#39;$disabled_class $altrow_class&#39;&gt;&quot;;</td></tr>
<tr><td class="h">3184</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td&gt;&quot; . $pending_sub-&gt;htmlcontrol($u) . &quot;$sub_title*&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3185</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3186</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $notify_class (@notify_classes) {</td></tr>
<tr><td class="h">3187</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3187">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($notify_class eq &quot;LJ::NotificationMethod::Email&quot;) {</td></tr>
<tr><td class="h">3188</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td class=&#39;NotificationOptions&#39;$hidden&gt;&quot; . $pending_sub-&gt;htmlcontrol($u, undef, undef, notif =&gt; 1, notif_catid =&gt; $catid, notif_ntypeid =&gt; 2) . &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3190</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td class=&#39;NotificationOptions&#39;$hidden&gt;&quot; . LJ::html_check({ disabled =&gt; 1 }) . &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3191</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3192</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3193</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">3194</td><td colspan="7"></td></tr><tr><td class="h">3195</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$special_subs++;</td></tr>
<tr><td class="h">3196</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_count++;</td></tr>
<tr><td class="h">3197</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next;</td></tr>
<tr><td class="h">3198</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3199</td><td colspan="7"></td></tr><tr><td class="h">3200</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3200">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3200">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $u-&gt;is_identity &amp;&amp; !$pending_sub-&gt;enabled;</td></tr>
<tr><td class="h">3201</td><td colspan="7"></td></tr><tr><td class="h">3202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print option to subscribe to this event, checked if already subscribed</td></tr>
<tr><td class="h">3203</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3203">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $input_name = $pending_sub-&gt;freeze or next;</td></tr>
<tr><td class="h">3204</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3204">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $title      = $pending_sub-&gt;as_html or next;</td></tr>
<tr><td class="h">3205</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $subscribed = ! $pending_sub-&gt;pending;</td></tr>
<tr><td class="h">3206</td><td colspan="7"></td></tr><tr><td class="h">3207</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3207">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($pending_sub-&gt;enabled) {</td></tr>
<tr><td class="h">3208</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$title = LJ::run_hook(&quot;disabled_esn_sub&quot;, $u) . $title;</td></tr>
<tr><td class="h">3209</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3210</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3210">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3210">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if ! $pending_sub-&gt;event_class-&gt;is_visible &amp;&amp; $showtracking;</td></tr>
<tr><td class="h">3211</td><td colspan="7"></td></tr><tr><td class="h">3212</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3212">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $evt_class = $pending_sub-&gt;event_class or next;</td></tr>
<tr><td class="h">3213</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3213">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($is_tracking_category) {</td></tr>
<tr><td class="h">3214</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3214">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless eval { $evt_class-&gt;subscription_applicable($pending_sub) };</td></tr>
<tr><td class="h">3215</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3215">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3215">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if LJ::u_equals($journalu, $u) &amp;&amp; $pending_sub-&gt;journalid &amp;&amp; $pending_sub-&gt;journalid != $u-&gt;{userid};</td></tr>
<tr><td class="h">3216</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else {</td></tr>
<tr><td class="h">3217</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $no_show = 0;</td></tr>
<tr><td class="h">3218</td><td colspan="7"></td></tr><tr><td class="h">3219</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $cat_info_ref (@$catref) {</td></tr>
<tr><td class="h">3220</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while (my ($_cat_name, $_cat_events) = each %$cat_info_ref) {</td></tr>
<tr><td class="h">3221</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $_cat_event (@$_cat_events) {</td></tr>
<tr><td class="h">3222</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3222">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $_cat_event =~ /^LJ::Setting/;</td></tr>
<tr><td class="h">3223</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3223">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless (ref $_cat_event) {</td></tr>
<tr><td class="h">3224</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_cat_event = LJ::Subscription::Pending-&gt;new($u, event =&gt; $_cat_event);</td></tr>
<tr><td class="h">3225</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3226</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3226">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $pending_sub-&gt;equals($_cat_event);</td></tr>
<tr><td class="h">3227</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$no_show = 1;</td></tr>
<tr><td class="h">3228</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last;</td></tr>
<tr><td class="h">3229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3230</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3232</td><td colspan="7"></td></tr><tr><td class="h">3233</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3233">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next if $no_show;</td></tr>
<tr><td class="h">3234</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3235</td><td colspan="7"></td></tr><tr><td class="h">3236</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $special_selected = 0;</td></tr>
<tr><td class="h">3237</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3237">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($settings_page) {</td></tr>
<tr><td class="h">3238</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# if non-ESN comment notifications are turned on, then check the box for</td></tr>
<tr><td class="h">3239</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# the JournalNewComment event as well, since JournalNewComment notifications</td></tr>
<tr><td class="h">3240</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# are a subset of the non-ESN notifications</td></tr>
<tr><td class="h">3241</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $etypeid = $pending_sub-&gt;etypeid;</td></tr>
<tr><td class="h">3242</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3242">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3242">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!$is_tracking_category &amp;&amp; LJ::Event-&gt;class($etypeid) =~ /JournalNewComment/ &amp;&amp; LJ::Setting::CommentEmailNotify-&gt;selected($u)) {</td></tr>
<tr><td class="h">3243</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$special_selected = 1;</td></tr>
<tr><td class="h">3244</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3245</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3246</td><td colspan="7"></td></tr><tr><td class="h">3247</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3247">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $selected = $special_selected || $pending_sub-&gt;default_selected;</td></tr>
<tr><td class="h">3248</td><td colspan="7"></td></tr><tr><td class="h">3249</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3249">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $inactiveclass = $pending_sub-&gt;active ? &#39;&#39; : &#39;Inactive&#39;;</td></tr>
<tr><td class="h">3250</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3250">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $disabledclass = $pending_sub-&gt;enabled ? &#39;&#39; : &#39;Disabled&#39;;</td></tr>
<tr><td class="h">3251</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3251">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $altrowclass = $sub_count % 2 == 1 ? &quot;altrow&quot; : &quot;&quot;;</td></tr>
<tr><td class="h">3252</td><td colspan="7"></td></tr><tr><td class="h">3253</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html  .= &quot;&lt;tr class=&#39;$inactiveclass $disabledclass $altrowclass&#39;&gt;&lt;td&gt;&quot;;</td></tr>
<tr><td class="h">3254</td><td colspan="7"></td></tr><tr><td class="h">3255</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3255">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3255">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($is_tracking_category &amp;&amp; ! $pending_sub-&gt;pending) {</td></tr>
<tr><td class="h">3256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $subid = $pending_sub-&gt;id;</td></tr>
<tr><td class="h">3257</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3257">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $deletesub_url = $settings_page ? &quot;$LJ::SITEROOT/manage/settings/?cat=notifications&amp;deletesub_$subid=1&quot; : &quot;?deletesub_$subid=1&quot;;</td></tr>
<tr><td class="h">3258</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= qq {</td></tr>
<tr><td class="h">3259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a href=&#39;$deletesub_url&#39;&gt;&lt;img src=&quot;$LJ::IMGPREFIX/portal/btn_del.gif&quot; alt=&quot;Delete&quot;/&gt;&lt;/a&gt;</td></tr>
<tr><td class="h">3260</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">3261</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3262</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $always_checked = eval { &quot;$evt_class&quot;-&gt;always_checked; };</td></tr>
<tr><td class="h">3263</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3263">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $disabled = $always_checked ? 1 : !$pending_sub-&gt;enabled;</td></tr>
<tr><td class="h">3264</td><td colspan="7"></td></tr><tr><td class="h">3265</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html  .= LJ::html_check({</td></tr>
<tr><td class="h">3266</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id       =&gt; $input_name,</td></tr>
<tr><td class="h">3267</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name     =&gt; $input_name,</td></tr>
<tr><td class="h">3268</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class    =&gt; &quot;SubscriptionInboxCheck&quot;,</td></tr>
<tr><td class="h">3269</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selected =&gt; $selected,</td></tr>
<tr><td class="h">3270</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noescape =&gt; 1,</td></tr>
<tr><td class="h">3271</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label    =&gt; $title,</td></tr>
<tr><td class="h">3272</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disabled =&gt; $disabled,</td></tr>
<tr><td class="h">3273</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}) .  &quot;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3274</td><td colspan="7"></td></tr><tr><td class="h">3275</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3275">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($pending_sub-&gt;pending) {</td></tr>
<tr><td class="h">3276</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= LJ::html_hidden({</td></tr>
<tr><td class="h">3277</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name  =&gt; &quot;${input_name}-old&quot;,</td></tr>
<tr><td class="h">3278</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; $subscribed,</td></tr>
<tr><td class="h">3279</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">3280</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3281</td><td colspan="7"></td></tr><tr><td class="h">3282</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3282">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$shown_subids{$pending_sub-&gt;id}++ unless $pending_sub-&gt;pending;</td></tr>
<tr><td class="h">3283</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# for the inbox</td></tr>
<tr><td class="h">3284</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;total&quot; includes default subs (those at the top) which are active</td></tr>
<tr><td class="h">3285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   and any subs for tracking an entry/comment, whether active or inactive</td></tr>
<tr><td class="h">3286</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;active&quot; only counts subs which are selected</td></tr>
<tr><td class="h">3287</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# don&#39;t count disabled, even if they&#39;re checked, because they don&#39;t count against your limit</td></tr>
<tr><td class="h">3288</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3288">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3288">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( ! $disabled &amp;&amp;  ( $is_tracking_category || $selected ) ) {</td></tr>
<tr><td class="h">3289</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num_subs_by_type{&quot;LJ::NotificationMethod::Inbox&quot;}-&gt;{total}++;</td></tr>
<tr><td class="h">3290</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3290">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num_subs_by_type{&quot;LJ::NotificationMethod::Inbox&quot;}-&gt;{active}++ if $selected;</td></tr>
<tr><td class="h">3291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3292</td><td colspan="7"></td></tr><tr><td class="h">3293</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_empty = 0;</td></tr>
<tr><td class="h">3294</td><td colspan="7"></td></tr><tr><td class="h">3295</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# print out notification options for this subscription (hidden if not subscribed)</td></tr>
<tr><td class="h">3296</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td&gt;&amp;nbsp;&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3297</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3297">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3297">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $hidden = ($special_selected || $pending_sub-&gt;default_selected || ($subscribed &amp;&amp; $pending_sub-&gt;active)) ? &#39;&#39; : &#39;style=&quot;visibility: hidden;&quot;&#39;;</td></tr>
<tr><td class="h">3298</td><td colspan="7"></td></tr><tr><td class="h">3299</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# is there an inbox notification for this?</td></tr>
<tr><td class="h">3300</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %sub_args = $pending_sub-&gt;sub_info;</td></tr>
<tr><td class="h">3301</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_args{ntypeid} = LJ::NotificationMethod::Inbox-&gt;ntypeid;</td></tr>
<tr><td class="h">3302</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $sub_args{flags};</td></tr>
<tr><td class="h">3303</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($inbox_sub) = $u-&gt;find_subscriptions(%sub_args);</td></tr>
<tr><td class="h">3304</td><td colspan="7"></td></tr><tr><td class="h">3305</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $note_class (@notify_classes) {</td></tr>
<tr><td class="h">3306</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3306">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ntypeid = eval { $note_class-&gt;ntypeid } or next;</td></tr>
<tr><td class="h">3307</td><td colspan="7"></td></tr><tr><td class="h">3308</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_args{ntypeid} = $ntypeid;</td></tr>
<tr><td class="h">3309</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my @subs = $u-&gt;has_subscription(%sub_args);</td></tr>
<tr><td class="h">3310</td><td colspan="7"></td></tr><tr><td class="h">3311</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $note_pending = LJ::Subscription::Pending-&gt;new($u, %sub_args);</td></tr>
<tr><td class="h">3312</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3312">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (@subs) {</td></tr>
<tr><td class="h">3313</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$note_pending = $subs[0];</td></tr>
<tr><td class="h">3314</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3315</td><td colspan="7"></td></tr><tr><td class="h">3316</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3316">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3316">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (($is_tracking_category || $pending_sub-&gt;is_tracking_category) &amp;&amp; $note_pending-&gt;pending) {</td></tr>
<tr><td class="h">3317</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# flag this as a &quot;tracking&quot; subscription</td></tr>
<tr><td class="h">3318</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$note_pending-&gt;set_tracking;</td></tr>
<tr><td class="h">3319</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3320</td><td colspan="7"></td></tr><tr><td class="h">3321</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $notify_input_name = $note_pending-&gt;freeze;</td></tr>
<tr><td class="h">3322</td><td colspan="7"></td></tr><tr><td class="h">3323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# select email method by default</td></tr>
<tr><td class="h">3324</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3324">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3324">0</a></div><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3324">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $note_selected = (scalar @subs) ? 1 : ((!$selected || $special_selected) &amp;&amp; $note_class eq &#39;LJ::NotificationMethod::Email&#39;);</td></tr>
<tr><td class="h">3325</td><td colspan="7"></td></tr><tr><td class="h">3326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# check the box if it&#39;s marked as being selected by default UNLESS</td></tr>
<tr><td class="h">3327</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# there exists an inbox subscription and no email subscription</td></tr>
<tr><td class="h">3328</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3328">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3328">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$note_selected = 1 if (! $inbox_sub || scalar @subs) &amp;&amp; $selected &amp;&amp; grep { $note_class eq $_ } @$def_notes;</td></tr>
<tr><td class="h">3329</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3329">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$note_selected &amp;&amp;= $note_pending-&gt;active &amp;&amp; $note_pending-&gt;enabled;</td></tr>
<tr><td class="h">3330</td><td colspan="7"></td></tr><tr><td class="h">3331</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $disabled = ! $pending_sub-&gt;enabled;</td></tr>
<tr><td class="h">3332</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3332">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$disabled = 1 unless $note_class-&gt;configured_for_user($u);</td></tr>
<tr><td class="h">3333</td><td colspan="7"></td></tr><tr><td class="h">3334</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= qq {</td></tr>
<tr><td class="h">3335</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td class=&#39;NotificationOptions&#39; $hidden&gt;</td></tr>
<tr><td class="h">3336</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} . LJ::html_check({</td></tr>
<tr><td class="h">3337</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id       =&gt; $notify_input_name,</td></tr>
<tr><td class="h">3338</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name     =&gt; $notify_input_name,</td></tr>
<tr><td class="h">3339</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class    =&gt; &quot;SubscribeCheckbox-$catid-$ntypeid&quot;,</td></tr>
<tr><td class="h">3340</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selected =&gt; $note_selected,</td></tr>
<tr><td class="h">3341</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noescape =&gt; 1,</td></tr>
<tr><td class="h">3342</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disabled =&gt; $disabled,</td></tr>
<tr><td class="h">3343</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}) . &#39;&lt;/td&gt;&#39;;</td></tr>
<tr><td class="h">3344</td><td colspan="7"></td></tr><tr><td class="h">3345</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3345">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless ($note_pending-&gt;pending) {</td></tr>
<tr><td class="h">3346</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3346">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= LJ::html_hidden({</td></tr>
<tr><td class="h">3347</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name  =&gt; &quot;${notify_input_name}-old&quot;,</td></tr>
<tr><td class="h">3348</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value =&gt; (scalar @subs) ? 1 : 0,</td></tr>
<tr><td class="h">3349</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">3350</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3351</td><td colspan="7"></td></tr><tr><td class="h">3352</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# for other notification methods</td></tr>
<tr><td class="h">3353</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;total&quot; includes default subs (those at the top) which are active,</td></tr>
<tr><td class="h">3354</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   and any subs for tracking an entry/comment, where the sub is active</td></tr>
<tr><td class="h">3355</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#   (because inbox is selected, revealing the notification checkbox)</td></tr>
<tr><td class="h">3356</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &quot;active&quot; only counts subs which are selected</td></tr>
<tr><td class="h">3357</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# don&#39;t count disabled, even if they&#39;re checked, because they don&#39;t count against your limit</td></tr>
<tr><td class="h">3358</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3358">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3358">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( ! $disabled &amp;&amp; ! $hidden &amp;&amp; ( $is_tracking_category || $note_selected ) ) {</td></tr>
<tr><td class="h">3359</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num_subs_by_type{$note_class}-&gt;{total}++;</td></tr>
<tr><td class="h">3360</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3360">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$num_subs_by_type{$note_class}-&gt;{active}++ if $note_selected;</td></tr>
<tr><td class="h">3361</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3362</td><td colspan="7"></td></tr><tr><td class="h">3363</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3364</td><td colspan="7"></td></tr><tr><td class="h">3365</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">3366</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sub_count++;</td></tr>
<tr><td class="h">3367</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3368</td><td colspan="7"></td></tr><tr><td class="h">3369</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $cols = 2 + (scalar @notify_classes);</td></tr>
<tr><td class="h">3370</td><td colspan="7"></td></tr><tr><td class="h">3371</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# show blurb if not tracking anything</td></tr>
<tr><td class="h">3372</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3372">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3372">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($cat_empty &amp;&amp; $is_tracking_category) {</td></tr>
<tr><td class="h">3373</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $blurb = &quot;&lt;?p &lt;strong&gt;&quot; . LJ::Lang::ml(&#39;subscribe_interface.nosubs.title&#39;) . &quot;&lt;/strong&gt;&lt;br /&gt;&quot;;</td></tr>
<tr><td class="h">3374</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$blurb .= LJ::Lang::ml(&#39;subscribe_interface.nosubs.text&#39;, { img =&gt; &quot;&lt;img src=&#39;$LJ::SITEROOT/img/silk/entry/track.png&#39; width=&#39;16&#39; height=&#39;16&#39; align=&#39;absmiddle&#39; alt=&#39;$ui_notify&#39; /&gt;&quot; }) . &quot; p?&gt;&quot;;</td></tr>
<tr><td class="h">3375</td><td colspan="7"></td></tr><tr><td class="h">3376</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;td colspan=&#39;$cols&#39;&gt;$blurb&lt;/td&gt;&quot;;</td></tr>
<tr><td class="h">3377</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3378</td><td colspan="7"></td></tr><tr><td class="h">3379</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;/tr&gt;&quot;;</td></tr>
<tr><td class="h">3380</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3380">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;tr&gt;&lt;td colspan=&#39;$cols&#39; style=&#39;font-size: smaller;&#39;&gt;* &quot; . LJ::Lang::ml( &#39;subscribe_interface.special_subs.note&#39;, { sitenameabbrev =&gt; $LJ::SITENAMEABBREV } ) . &quot;&lt;/td&gt;&lt;/tr&gt;&quot; if $special_subs;</td></tr>
<tr><td class="h">3381</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$cat_html .= &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">3382</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3382">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3382">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$events_table .= $cat_html unless ($is_tracking_category &amp;&amp; !$showtracking);</td></tr>
<tr><td class="h">3383</td><td colspan="7"></td></tr><tr><td class="h">3384</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$catid++;</td></tr>
<tr><td class="h">3385</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3386</td><td colspan="7"></td></tr><tr><td class="h">3387</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$events_table .= &#39;&lt;/table&gt;&#39;;</td></tr>
<tr><td class="h">3388</td><td colspan="7"></td></tr><tr><td class="h">3389</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# pass some info to javascript</td></tr>
<tr><td class="h">3390</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $catids = LJ::html_hidden({</td></tr>
<tr><td class="h">3391</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;  =&gt; &#39;catids&#39;,</td></tr>
<tr><td class="h">3392</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39; =&gt; join(&#39;,&#39;, @catids),</td></tr>
<tr><td class="h">3393</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">3394</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ntypeids = LJ::html_hidden({</td></tr>
<tr><td class="h">3395</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;id&#39;  =&gt; &#39;ntypeids&#39;,</td></tr>
<tr><td class="h">3396</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;value&#39; =&gt; join(&#39;,&#39;, map { $_-&gt;ntypeid } LJ::NotificationMethod-&gt;all_classes),</td></tr>
<tr><td class="h">3397</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;});</td></tr>
<tr><td class="h">3398</td><td colspan="7"></td></tr><tr><td class="h">3399</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $subscription_stats = &quot;&quot;;</td></tr>
<tr><td class="h">3400</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3400">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $settings_page ) {</td></tr>
<tr><td class="h">3401</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# show how many subscriptions we have active / inactive</td></tr>
<tr><td class="h">3402</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# there&#39;s a bit of a trick here: each row counts as a maximum of one subscription.</td></tr>
<tr><td class="h">3403</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# However, forced subscriptions don&#39;t count (e.g., &quot;Someone sends me a message&quot; for inbox)</td></tr>
<tr><td class="h">3404</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Also, if we activate an inbox subscription but not its email, the total number of subs</td></tr>
<tr><td class="h">3405</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# per notification method goes out of sync.</td></tr>
<tr><td class="h">3406</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Regardless, once we hit the limit for *any* method, we get a warning. So we take</td></tr>
<tr><td class="h">3407</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# whichever method has the most total / active and use that figure in our message.</td></tr>
<tr><td class="h">3408</td><td colspan="7"></td></tr><tr><td class="h">3409</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $max_active_method = 0;</td></tr>
<tr><td class="h">3410</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $max_total_method = 0;</td></tr>
<tr><td class="h">3411</td><td colspan="7"></td></tr><tr><td class="h">3412</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach my $method_class ( keys %num_subs_by_type ) {</td></tr>
<tr><td class="h">3413</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3413">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$max_active_method = $num_subs_by_type{$method_class}-&gt;{active}</td></tr>
<tr><td class="h">3414</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $num_subs_by_type{$method_class}-&gt;{active} &gt; $max_active_method;</td></tr>
<tr><td class="h">3415</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3415">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$max_total_method = $num_subs_by_type{$method_class}-&gt;{total}</td></tr>
<tr><td class="h">3416</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $num_subs_by_type{$method_class}-&gt;{total} &gt; $max_total_method;</td></tr>
<tr><td class="h">3417</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3418</td><td colspan="7"></td></tr><tr><td class="h">3419</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $paid_max = LJ::get_cap( &#39;paid&#39;, &#39;subscriptions&#39; );</td></tr>
<tr><td class="h">3420</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $u_max  = $u-&gt;max_subscriptions;</td></tr>
<tr><td class="h">3421</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# max for total number of subscriptions (generally it is $paid_max)</td></tr>
<tr><td class="h">3422</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3422">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $system_max  = $u_max &gt; $paid_max ? $u_max : $paid_max;</td></tr>
<tr><td class="h">3423</td><td colspan="7"></td></tr><tr><td class="h">3424</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subscription_stats .= &quot;&lt;div class=&#39;subscription_stats&#39;&gt;&quot; . LJ::Lang::ml( &#39;subscribe_interface.subs.total&#39;,  {</td></tr>
<tr><td class="h">3425</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;active =&gt;  $max_active_method,</td></tr>
<tr><td class="h">3426</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_active =&gt; $u_max,</td></tr>
<tr><td class="h">3427</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total =&gt; $max_total_method,</td></tr>
<tr><td class="h">3428</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max_total =&gt; $system_max,</td></tr>
<tr><td class="h">3429</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} ) . &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">3430</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3431</td><td colspan="7"></td></tr><tr><td class="h">3432</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= qq {</td></tr>
<tr><td class="h">3433</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ntypeids</td></tr>
<tr><td class="h">3434</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$catids</td></tr>
<tr><td class="h">3435</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$events_table</td></tr>
<tr><td class="h">3436</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$subscription_stats</td></tr>
<tr><td class="h">3437</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">3438</td><td colspan="7"></td></tr><tr><td class="h">3439</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden({name =&gt; &#39;mode&#39;, value =&gt; &#39;save_subscriptions&#39;});</td></tr>
<tr><td class="h">3440</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden({name =&gt; &#39;ret_url&#39;, value =&gt; $ret_url});</td></tr>
<tr><td class="h">3441</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= LJ::html_hidden({name =&gt; &#39;post_to_settings_page&#39;, value =&gt; $post_to_settings_page});</td></tr>
<tr><td class="h">3442</td><td colspan="7"></td></tr><tr><td class="h">3443</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# print buttons</td></tr>
<tr><td class="h">3444</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $referer = BML::get_client_header(&#39;Referer&#39;);</td></tr>
<tr><td class="h">3445</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $uri = $LJ::SITEROOT . DW::Request-&gt;get-&gt;uri;</td></tr>
<tr><td class="h">3446</td><td colspan="7"></td></tr><tr><td class="h">3447</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# normalize the URLs -- ../index.bml doesn&#39;t make it a different page.</td></tr>
<tr><td class="h">3448</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$uri =~ s/index\.bml//;</td></tr>
<tr><td class="h">3449</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$referer =~ s/index\.bml//;</td></tr>
<tr><td class="h">3450</td><td colspan="7"></td></tr><tr><td class="h">3451</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3451">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless ($settings_page) {</td></tr>
<tr><td class="h">3452</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3452">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3452">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &#39;&lt;?standout &#39; .</td></tr>
<tr><td class="h">3453</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LJ::html_submit(BML::ml(&#39;subscribe_interface.save&#39;)) . &#39; &#39; .</td></tr>
<tr><td class="h">3454</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;($referer &amp;&amp; $referer ne $uri ? &quot;&lt;input type=&#39;button&#39; value=&#39;&quot;.BML::ml(&#39;subscribe_interface.cancel&#39;).&quot;&#39; onclick=&#39;window.location=\&quot;$referer\&quot;&#39; /&gt;&quot; : &#39;&#39;)</td></tr>
<tr><td class="h">3455</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &#39;&#39;;</td></tr>
<tr><td class="h">3456</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;standout?&gt;&quot;;</td></tr>
<tr><td class="h">3457</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3458</td><td colspan="7"></td></tr><tr><td class="h">3459</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/div&gt;&quot;;</td></tr>
<tr><td class="h">3460</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3460">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3460">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ret .= &quot;&lt;/form&gt;&quot; if !$settings_page || $post_to_settings_page;</td></tr>
<tr><td class="h">3461</td><td colspan="7"></td></tr><tr><td class="h">3462</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $ret;</td></tr>
<tr><td class="h">3463</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3464</td><td colspan="7"></td></tr><tr><td class="h">3465</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns a placeholder link</td></tr>
<tr><td class="h">3466</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub placeholder_link {</td></tr>
<tr><td class="h">3467</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3467">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my (%opts) = @_;</td></tr>
<tr><td class="h">3468</td><td colspan="7"></td></tr><tr><td class="h">3469</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3469">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $placeholder_html = LJ::ejs_all(delete $opts{placeholder_html} || &#39;&#39;);</td></tr>
<tr><td class="h">3470</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3470">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $width  = delete $opts{width}  || 100;</td></tr>
<tr><td class="h">3471</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3471">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $height = delete $opts{height} || 100;</td></tr>
<tr><td class="h">3472</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3472">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $link   = delete $opts{link}   || &#39;&#39;;</td></tr>
<tr><td class="h">3473</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3473">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $img    = delete $opts{img}    || &quot;$LJ::IMGPREFIX/videoplaceholder.png&quot;;</td></tr>
<tr><td class="h">3474</td><td colspan="7"></td></tr><tr><td class="h">3475</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return qq {</td></tr>
<tr><td class="h">3476</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class=&quot;LJ_Placeholder_Container&quot; style=&quot;width: ${width}px; height: ${height}px;&quot;&gt;</td></tr>
<tr><td class="h">3477</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class=&quot;LJ_Placeholder_HTML&quot; style=&quot;display: none;&quot;&gt;$placeholder_html&lt;/div&gt;</td></tr>
<tr><td class="h">3478</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class=&quot;LJ_Container&quot;&gt;&lt;/div&gt;</td></tr>
<tr><td class="h">3479</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a href=&quot;$link&quot; onclick=&quot;return false;&quot;&gt;</td></tr>
<tr><td class="h">3480</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;img src=&quot;$img&quot; class=&quot;LJ_Placeholder&quot; title=&quot;Click to show embedded content&quot; /&gt;</td></tr>
<tr><td class="h">3481</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/a&gt;</td></tr>
<tr><td class="h">3482</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;</td></tr>
<tr><td class="h">3483</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">3484</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3485</td><td colspan="7"></td></tr><tr><td class="h">3486</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># this returns the right max length for a VARCHAR(255) database</td></tr>
<tr><td class="h">3487</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># column.  but in HTML, the maxlength is characters, not bytes, so we</td></tr>
<tr><td class="h">3488</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># have to assume 3-byte chars and return 80 instead of 255.  (80*3 ==</td></tr>
<tr><td class="h">3489</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># 240, approximately 255).  However, we special-case Russian where</td></tr>
<tr><td class="h">3490</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># they often need just a little bit more, and make that 100.  because</td></tr>
<tr><td class="h">3491</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># their bytes are only 2, so 100 * 2 == 200.  as long as russians</td></tr>
<tr><td class="h">3492</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># don&#39;t enter, say, 100 characters of japanese... but then it&#39;d get</td></tr>
<tr><td class="h">3493</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># truncated or throw an error.  we&#39;ll risk that and give them 20 more</td></tr>
<tr><td class="h">3494</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># characters.</td></tr>
<tr><td class="h">3495</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub std_max_length {</td></tr>
<tr><td class="h">3496</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3496">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $lang = eval { BML::get_language() };</td></tr>
<tr><td class="h">3497</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3497">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3497">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 80  if !$lang || $lang =~ /^en/;</td></tr>
<tr><td class="h">3498</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3498">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 100 if $lang =~ /\b(hy|az|be|et|ka|ky|kk|lt|lv|mo|ru|tg|tk|uk|uz)\b/i;</td></tr>
<tr><td class="h">3499</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return 80;</td></tr>
<tr><td class="h">3500</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3501</td><td colspan="7"></td></tr><tr><td class="h">3502</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Common challenge/response JavaScript, needed by both login pages and comment pages alike.</td></tr>
<tr><td class="h">3503</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Forms that use this should onclick=&#39;return sendForm()&#39; in the submit button.</td></tr>
<tr><td class="h">3504</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Returns true to let the submit continue.</td></tr>
<tr><td class="h">3505</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">$LJ::COMMON_CODE{&#39;chalresp_js&#39;} = qq{</td></tr>
<tr><td class="h">3506</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script type=&quot;text/javascript&quot; src=&quot;$LJ::JSPREFIX/md5.js&quot;&gt;&lt;/script&gt;</td></tr>
<tr><td class="h">3507</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;</td></tr>
<tr><td class="h">3508</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--</td></tr>
<tr><td class="h">3509</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">function sendForm (formid, checkuser)</td></tr>
<tr><td class="h">3510</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">{</td></tr>
<tr><td class="h">3511</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (formid == null) formid = &#39;login&#39;;</td></tr>
<tr><td class="h">3512</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;// &#39;checkuser&#39; is the element id name of the username textfield.</td></tr>
<tr><td class="h">3513</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;// only use it if you care to verify a username exists before hashing.</td></tr>
<tr><td class="h">3514</td><td colspan="7"></td></tr><tr><td class="h">3515</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (! document.getElementById) return true;</td></tr>
<tr><td class="h">3516</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var loginform = document.getElementById(formid);</td></tr>
<tr><td class="h">3517</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (! loginform) return true;</td></tr>
<tr><td class="h">3518</td><td colspan="7"></td></tr><tr><td class="h">3519</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;// Avoid accessing the password field if there is no username.</td></tr>
<tr><td class="h">3520</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;// This works around Opera &lt; 7 complaints when commenting.</td></tr>
<tr><td class="h">3521</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (checkuser) {</td></tr>
<tr><td class="h">3522</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var username = null;</td></tr>
<tr><td class="h">3523</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (var i = 0; username == null &amp;&amp; i &lt; loginform.elements.length; i++) {</td></tr>
<tr><td class="h">3524</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (loginform.elements[i].id == checkuser) username = loginform.elements[i];</td></tr>
<tr><td class="h">3525</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3526</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (username != null &amp;&amp; username.value == &quot;&quot;) return true;</td></tr>
<tr><td class="h">3527</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3528</td><td colspan="7"></td></tr><tr><td class="h">3529</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (! loginform.password || ! loginform.login_chal || ! loginform.login_response) return true;</td></tr>
<tr><td class="h">3530</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var pass = loginform.password.value;</td></tr>
<tr><td class="h">3531</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var chal = loginform.login_chal.value;</td></tr>
<tr><td class="h">3532</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;var res = MD5(chal + MD5(pass));</td></tr>
<tr><td class="h">3533</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;loginform.login_response.value = res;</td></tr>
<tr><td class="h">3534</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;loginform.password.value = &quot;&quot;;  // dont send clear-text password!</td></tr>
<tr><td class="h">3535</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return true;</td></tr>
<tr><td class="h">3536</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3537</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">// --&gt;</td></tr>
<tr><td class="h">3538</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;/script&gt;</td></tr>
<tr><td class="h">3539</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">};</td></tr>
<tr><td class="h">3540</td><td colspan="7"></td></tr><tr><td class="h">3541</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Common JavaScript function for auto-checking radio buttons on form</td></tr>
<tr><td class="h">3542</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># input field data changes</td></tr>
<tr><td class="h">3543</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">$LJ::COMMON_CODE{&#39;autoradio_check&#39;} = q{</td></tr>
<tr><td class="h">3544</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;</td></tr>
<tr><td class="h">3545</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--</td></tr>
<tr><td class="h">3546</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;/* If radioid exists, check the radio button. */</td></tr>
<tr><td class="h">3547</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;function checkRadioButton(radioid) {</td></tr>
<tr><td class="h">3548</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!document.getElementById) return;</td></tr>
<tr><td class="h">3549</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var radio = document.getElementById(radioid);</td></tr>
<tr><td class="h">3550</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!radio) return;</td></tr>
<tr><td class="h">3551</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radio.checked = true;</td></tr>
<tr><td class="h">3552</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3553</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">// --&gt;</td></tr>
<tr><td class="h">3554</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&lt;/script&gt;</td></tr>
<tr><td class="h">3555</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">};</td></tr>
<tr><td class="h">3556</td><td colspan="7"></td></tr><tr><td class="h">3557</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns HTML which should appear before &lt;/body&gt;</td></tr>
<tr><td class="h">3558</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub final_body_html {</td></tr>
<tr><td class="h">3559</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3559">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $before_body_close = &quot;&quot;;</td></tr>
<tr><td class="h">3560</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::run_hooks(&#39;insert_html_before_body_close&#39;, \$before_body_close);</td></tr>
<tr><td class="h">3561</td><td colspan="7"></td></tr><tr><td class="h">3562</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $pagestats_obj = LJ::pagestats_obj();</td></tr>
<tr><td class="h">3563</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3563">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$before_body_close .= $pagestats_obj-&gt;render</td></tr>
<tr><td class="h">3564</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if $pagestats_obj;</td></tr>
<tr><td class="h">3565</td><td colspan="7"></td></tr><tr><td class="h">3566</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $before_body_close;</td></tr>
<tr><td class="h">3567</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3568</td><td colspan="7"></td></tr><tr><td class="h">3569</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return a unique per pageview string based on the remote&#39;s unique cookie</td></tr>
<tr><td class="h">3570</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub pageview_unique_string {</td></tr>
<tr><td class="h">3571</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3571">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cached_uniq = $LJ::REQ_GLOBAL{pageview_unique_string};</td></tr>
<tr><td class="h">3572</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3572">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $cached_uniq if $cached_uniq;</td></tr>
<tr><td class="h">3573</td><td colspan="7"></td></tr><tr><td class="h">3574</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $uniq = LJ::UniqCookie-&gt;current_uniq . time() . LJ::rand_chars(8);</td></tr>
<tr><td class="h">3575</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$uniq = Digest::SHA1::sha1_hex($uniq);</td></tr>
<tr><td class="h">3576</td><td colspan="7"></td></tr><tr><td class="h">3577</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$LJ::REQ_GLOBAL{pageview_unique_string} = $uniq;</td></tr>
<tr><td class="h">3578</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $uniq;</td></tr>
<tr><td class="h">3579</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3580</td><td colspan="7"></td></tr><tr><td class="h">3581</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;LJFUNC&gt;</td></tr>
<tr><td class="h">3582</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># name: LJ::site_schemes</td></tr>
<tr><td class="h">3583</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class: web</td></tr>
<tr><td class="h">3584</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># des: Returns a list of available BML schemes.</td></tr>
<tr><td class="h">3585</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># args: none</td></tr>
<tr><td class="h">3586</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># return: array</td></tr>
<tr><td class="h">3587</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># &lt;/LJFUNC&gt;</td></tr>
<tr><td class="h">3588</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub site_schemes {</td></tr>
<tr><td class="h">3589</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3589">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @schemes = @LJ::SCHEMES;</td></tr>
<tr><td class="h">3590</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::run_hooks(&#39;modify_scheme_list&#39;, \@schemes);</td></tr>
<tr><td class="h">3591</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@schemes = grep { !$_-&gt;{disabled} } @schemes;</td></tr>
<tr><td class="h">3592</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @schemes;</td></tr>
<tr><td class="h">3593</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3594</td><td colspan="7"></td></tr><tr><td class="h">3595</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># sets up appropriate js for journals that need a special statusvis message at the top</td></tr>
<tr><td class="h">3596</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns some js that must be added onto the journal page&#39;s head</td></tr>
<tr><td class="h">3597</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub statusvis_message_js {</td></tr>
<tr><td class="h">3598</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3598">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $u = shift;</td></tr>
<tr><td class="h">3599</td><td colspan="7"></td></tr><tr><td class="h">3600</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3600">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&quot; unless $u;</td></tr>
<tr><td class="h">3601</td><td colspan="7"></td></tr><tr><td class="h">3602</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3602">0</a></div></td><td><div class="c0"><a href="cgi-bin-weblib-pl--condition.html#L3602">0</a></div></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&quot; unless $u-&gt;is_locked || $u-&gt;is_memorial || $u-&gt;is_readonly;</td></tr>
<tr><td class="h">3603</td><td colspan="7"></td></tr><tr><td class="h">3604</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3604">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $statusvis_full = &quot;locked&quot; if $u-&gt;is_locked;</td></tr>
<tr><td class="h">3605</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3605">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$statusvis_full = &quot;memorial&quot; if $u-&gt;is_memorial;</td></tr>
<tr><td class="h">3606</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3606">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$statusvis_full = &quot;readonly&quot; if $u-&gt;is_readonly;</td></tr>
<tr><td class="h">3607</td><td colspan="7"></td></tr><tr><td class="h">3608</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::need_res(&quot;js/statusvis_message.js&quot;);</td></tr>
<tr><td class="h">3609</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;script&gt;Site.StatusvisMessage=\&quot;&quot; . LJ::Lang::ml(&quot;statusvis_message.$statusvis_full&quot;) . &quot;\&quot;;&lt;/script&gt;&quot;;</td></tr>
<tr><td class="h">3610</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3611</td><td colspan="7"></td></tr><tr><td class="h">3612</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns canonical link for use in header of journal pages</td></tr>
<tr><td class="h">3613</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub canonical_link {</td></tr>
<tr><td class="h">3614</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-weblib-pl--subroutine.html#L3614">0</a></div></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $url, $tid ) = @_;</td></tr>
<tr><td class="h">3615</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-weblib-pl--branch.html#L3615">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $tid += 0 ) {  # sanitize input</td></tr>
<tr><td class="h">3616</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= &quot;?thread=$tid&quot; . LJ::Talk::comment_anchor( $tid );</td></tr>
<tr><td class="h">3617</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">3618</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return qq{&lt;link rel=&quot;canonical&quot; href=&quot;$url&quot; /&gt;\n};</td></tr>
<tr><td class="h">3619</td><td colspan="7"></td></tr><tr><td class="h">3620</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">3621</td><td colspan="7"></td></tr><tr><td class="h">3622</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
