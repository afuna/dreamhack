<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>Branch Coverage: cgi-bin/LJ/Session.pm</title>
</head>
<body>
<h1>Branch Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">cgi-bin/LJ/Session.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">1.3%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>%</th><th colspan="2">coverage</th><th>branch</th></tr>
<tr><td class="h"><a id="L35">35</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $u and not $u-&gt;is_expunged</td></tr>
<tr><td class="h"><a id="L40">40</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $sess</td></tr>
<tr><td class="h"><a id="L43">43</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess = $u-&gt;selectrow_hashref(&#39;SELECT userid, sessid, exptype, auth, timecreate, timeexpire, ipfixed FROM sessions WHERE userid=? AND sessid=?&#39;, undef, $$u{&#39;userid&#39;}, $sessid)</td></tr>
<tr><td class="h"><a id="L73">73</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L75">75</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %opts</td></tr>
<tr><td class="h"><a id="L78">78</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $udbh</td></tr>
<tr><td class="h"><a id="L96">96</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $id</td></tr>
<tr><td class="h"><a id="L98">98</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $nolog</td></tr>
<tr><td class="h"><a id="L106">106</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $u-&gt;err</td></tr>
<tr><td class="h"><a id="L114">114</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $old</td></tr>
<tr><td class="h"><a id="L147">147</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L170">170</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (not $rv)</td></tr>
<tr><td class="h"><a id="L190">190</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;timeexpire&#39;}</td></tr>
<tr><td class="h"><a id="L212">212</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;flags&#39;})</td></tr>
<tr><td class="h"><a id="L223">223</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $domcook</td></tr>
<tr><td class="h"><a id="L246">246</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;exptype&#39;} eq &#39;long&#39;)</td></tr>
<tr><td class="h"><a id="L250">250</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$LJ::ONLY_USER_VHOSTS ? :</td></tr>
<tr><td class="h"><a id="L267">267</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (my $scheme = $sess-&gt;owner-&gt;prop(&#39;schemepref&#39;)) { }</td></tr>
<tr><td class="h"><a id="L280">280</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (my $lang = $sess-&gt;owner-&gt;prop(&#39;browselang&#39;)) { }</td></tr>
<tr><td class="h"><a id="L314">314</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;timeexpire&#39;} &lt; $now</td></tr>
<tr><td class="h"><a id="L316">316</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;ipfixed&#39;} and not $OPT_IGNORE_IP)</td></tr>
<tr><td class="h"><a id="L318">318</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;ipfixed&#39;} ne $remote_ip</td></tr>
<tr><td class="h"><a id="L357">357</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;exptype&#39;} ne &#39;long&#39;</td></tr>
<tr><td class="h"><a id="L368">368</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($sess_length and $$sess{&#39;timeexpire&#39;} - $now &lt; $sess_length / 2 and $u-&gt;writer and $sess-&gt;_dbupdate(&#39;timeexpire&#39;, $new_expire))</td></tr>
<tr><td class="h"><a id="L383">383</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $dest</td></tr>
<tr><td class="h"><a id="L386">386</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($u)</td></tr>
<tr><td class="h"><a id="L391">391</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $domcook = &#39;LJ::Session&#39;-&gt;domain_cookie($dest)</td></tr>
<tr><td class="h"><a id="L394">394</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($dest =~ m[^(https?://)([^/]*?)\.\Q$LJ::USER_DOMAIN\E/?([^/]*)])</td></tr>
<tr><td class="h"><a id="L396">396</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($LJ::SUBDOMAIN_FUNCTION{lc $2} eq &#39;journal&#39;)</td></tr>
<tr><td class="h"><a id="L397">397</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $3 and $3 ne &#39;/&#39;</td></tr>
<tr><td class="h"><a id="L417">417</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $subdomain</td></tr>
<tr><td class="h"><a id="L420">420</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($user ne &#39;&#39;) { }</td></tr>
<tr><td class="h"><a id="L437">437</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $url =~ m[^https?://(.+?)(/.*)$]</td></tr>
<tr><td class="h"><a id="L443">443</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $host eq lc $LJ::DOMAIN_WEB or $host eq lc $LJ::DOMAIN</td></tr>
<tr><td class="h"><a id="L446">446</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $host =~ /^([\w-\.]{1,50})\.\Q$LJ::USER_DOMAIN\E$/</td></tr>
<tr><td class="h"><a id="L449">449</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($LJ::SUBDOMAIN_FUNCTION{$subdomain} eq &#39;journal&#39;)</td></tr>
<tr><td class="h"><a id="L450">450</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $path =~ m[^/(\w{1,15})\b]</td></tr>
<tr><td class="h"><a id="L452">452</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">wantarray ? :</td></tr>
<tr><td class="h"><a id="L456">456</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">wantarray ? :</td></tr>
<tr><td class="h"><a id="L463">463</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $user eq &#39;&#39;</td></tr>
<tr><td class="h"><a id="L474">474</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless eval {
	do {
	BML::get_request()
}
}</td></tr>
<tr><td class="h"><a id="L479">479</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($domain_cookie) { }</td></tr>
<tr><td class="h"><a id="L481">481</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&quot;${domain_cookie}[]&quot;}</td></tr>
<tr><td class="h"><a id="L484">484</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&#39;ljmastersession[]&#39;}</td></tr>
<tr><td class="h"><a id="L487">487</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless (@cookies)</td></tr>
<tr><td class="h"><a id="L488">488</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&#39;ljsession[]&#39;}</td></tr>
<tr><td class="h"><a id="L501">501</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">ref $_[0] ? :</td></tr>
<tr><td class="h"><a id="L505">505</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $li_cook</td></tr>
<tr><td class="h"><a id="L510">510</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($rr)</td></tr>
<tr><td class="h"><a id="L517">517</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless @cookies</td></tr>
<tr><td class="h"><a id="L523">523</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess</td></tr>
<tr><td class="h"><a id="L538">538</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">ref $_[0] ? :</td></tr>
<tr><td class="h"><a id="L540">540</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless @cookies</td></tr>
<tr><td class="h"><a id="L544">544</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">delete $$opts{&#39;ignore_ip&#39;} ? :</td></tr>
<tr><td class="h"><a id="L545">545</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">delete $$opts{&#39;old_cookie&#39;} ? :</td></tr>
<tr><td class="h"><a id="L548">548</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %$opts</td></tr>
<tr><td class="h"><a id="L573">573</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($var =~ /^(\w)(.+)$/ and $$dest{$1}) { }</td></tr>
<tr><td class="h"><a id="L581">581</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $flags =~ /\.FS\b/</td></tr>
<tr><td class="h"><a id="L583">583</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $bogus</td></tr>
<tr><td class="h"><a id="L585">585</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_cookie_generation($gen)</td></tr>
<tr><td class="h"><a id="L593">593</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($version == 1)</td></tr>
<tr><td class="h"><a id="L599">599</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($u)</td></tr>
<tr><td class="h"><a id="L605">605</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($u-&gt;is_locked)</td></tr>
<tr><td class="h"><a id="L612">612</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($sess)</td></tr>
<tr><td class="h"><a id="L617">617</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$sess{&#39;auth&#39;} eq $auth)</td></tr>
<tr><td class="h"><a id="L622">622</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($sess-&gt;valid)</td></tr>
<tr><td class="h"><a id="L628">628</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($old_cookie or $sess-&gt;loggedin_cookie_string eq $li_cook)</td></tr>
<tr><td class="h"><a id="L642">642</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">unless $u</td></tr>
<tr><td class="h"><a id="L644">644</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">unless my $udbh = LJ::get_cluster_master($u)</td></tr>
<tr><td class="h"><a id="L650">650</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">if @$sessions</td></tr>
<tr><td class="h"><a id="L659">659</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $in</td></tr>
<tr><td class="h"><a id="L662">662</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $u-&gt;do(&quot;DELETE FROM $_ WHERE userid=? AND &quot; . &quot;sessid IN ($in)&quot;, undef, $userid)</td></tr>
<tr><td class="h"><a id="L677">677</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$LJ::ONLY_USER_VHOSTS ? :</td></tr>
<tr><td class="h"><a id="L695">695</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L711">711</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless BML::get_GET()</td></tr>
<tr><td class="h"><a id="L717">717</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_destination($dest)</td></tr>
<tr><td class="h"><a id="L718">718</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_domain_cookie($domcook, $cookie, $BML::COOKIE{&#39;ljloggedin&#39;})</td></tr>
<tr><td class="h"><a id="L724">724</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($dest =~ m[^https?://(.+?)(/.*)$])</td></tr>
<tr><td class="h"><a id="L728">728</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($host =~ /^([\w-\.]{1,50})\.\Q$LJ::USER_DOMAIN\E$/ and $subdomain = lc $1 and $LJ::SUBDOMAIN_FUNCTION{$subdomain} eq &#39;journal&#39; and $url_path =~ m[^/(\w{1,15})\b])</td></tr>
<tr><td class="h"><a id="L732">732</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $1</td></tr>
<tr><td class="h"><a id="L745">745</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($dest =~ m[^https?://.+?/.+?/] or $path eq &#39;/&#39;)</td></tr>
<tr><td class="h"><a id="L747">747</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $dest =~ s[\?][/?]</td></tr>
<tr><td class="h"><a id="L761">761</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$args ? :</td></tr>
<tr><td class="h"><a id="L781">781</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (@_ == 2) { }</td></tr>
<tr><td class="h"><a id="L796">796</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $r</td></tr>
<tr><td class="h"><a id="L803">803</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %opts</td></tr>
<tr><td class="h"><a id="L806">806</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($http_only and not $LJ::DEBUG{&#39;no_mac_ie_httponly&#39;})</td></tr>
<tr><td class="h"><a id="L808">808</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $ua =~ /MSIE.+Mac_/</td></tr>
<tr><td class="h"><a id="L812">812</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires and $expires &lt;= 1135217120</td></tr>
<tr><td class="h"><a id="L814">814</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($delete)</td></tr>
<tr><td class="h"><a id="L817">817</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $delete</td></tr>
<tr><td class="h"><a id="L821">821</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires</td></tr>
<tr><td class="h"><a id="L822">822</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $domain</td></tr>
<tr><td class="h"><a id="L823">823</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $path</td></tr>
<tr><td class="h"><a id="L824">824</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $http_only</td></tr>
<tr><td class="h"><a id="L830">830</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($domain and scalar @labels == 2 and not $LJ::DEBUG{&#39;no_extra_dot_cookie&#39;})</td></tr>
<tr><td class="h"><a id="L832">832</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires</td></tr>
<tr><td class="h"><a id="L834">834</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $path</td></tr>
<tr><td class="h"><a id="L835">835</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $http_only</td></tr>
<tr><td class="h"><a id="L862">862</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($var =~ /^(\w)(.+)$/ and $$dest{$1}) { }</td></tr>
<tr><td class="h"><a id="L874">874</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $bogus</td></tr>
<tr><td class="h"><a id="L875">875</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_cookie_generation($gen)</td></tr>
<tr><td class="h"><a id="L876">876</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $version != 1</td></tr>
<tr><td class="h"><a id="L880">880</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$opts{&#39;ignore_age&#39;})</td></tr>
<tr><td class="h"><a id="L882">882</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $time &gt; $now - 604800</td></tr>
<tr><td class="h"><a id="L885">885</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $u = LJ::load_userid($uid)</td></tr>
<tr><td class="h"><a id="L888">888</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $sess = $u-&gt;session($sessid)</td></tr>
<tr><td class="h"><a id="L892">892</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess-&gt;valid</td></tr>
<tr><td class="h"><a id="L895">895</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$opts{&#39;ignore_li_cook&#39;})</td></tr>
<tr><td class="h"><a id="L897">897</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess_licook eq $li_cook</td></tr>
<tr><td class="h"><a id="L902">902</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $correct_sig eq $sig</td></tr>
<tr><td class="h"><a id="L916">916</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $gen eq $okay</td></tr>
<tr><td class="h"><a id="L917">917</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $dgen eq $okay</td></tr>
</table>
</body>
</html>
