<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>Branch Coverage: cgi-bin/LJ/Session.pm</title>
</head>
<body>
<h1>Branch Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">cgi-bin/LJ/Session.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">1.3%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>%</th><th colspan="2">coverage</th><th>branch</th></tr>
<tr><td class="h"><a id="L37">37</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $u and not $u-&gt;is_expunged</td></tr>
<tr><td class="h"><a id="L42">42</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $sess</td></tr>
<tr><td class="h"><a id="L45">45</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess = $u-&gt;selectrow_hashref(&#39;SELECT userid, sessid, exptype, auth, timecreate, timeexpire, ipfixed FROM sessions WHERE userid=? AND sessid=?&#39;, undef, $$u{&#39;userid&#39;}, $sessid)</td></tr>
<tr><td class="h"><a id="L75">75</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L77">77</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %opts</td></tr>
<tr><td class="h"><a id="L80">80</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $udbh</td></tr>
<tr><td class="h"><a id="L98">98</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $id</td></tr>
<tr><td class="h"><a id="L100">100</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $nolog</td></tr>
<tr><td class="h"><a id="L108">108</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $u-&gt;err</td></tr>
<tr><td class="h"><a id="L116">116</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $old</td></tr>
<tr><td class="h"><a id="L149">149</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L172">172</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (not $rv)</td></tr>
<tr><td class="h"><a id="L192">192</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;timeexpire&#39;}</td></tr>
<tr><td class="h"><a id="L214">214</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;flags&#39;})</td></tr>
<tr><td class="h"><a id="L225">225</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $domcook</td></tr>
<tr><td class="h"><a id="L248">248</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;exptype&#39;} eq &#39;long&#39;)</td></tr>
<tr><td class="h"><a id="L252">252</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$LJ::ONLY_USER_VHOSTS ? :</td></tr>
<tr><td class="h"><a id="L269">269</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (my $scheme = $sess-&gt;owner-&gt;prop(&#39;schemepref&#39;)) { }</td></tr>
<tr><td class="h"><a id="L282">282</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (my $lang = $sess-&gt;owner-&gt;prop(&#39;browselang&#39;)) { }</td></tr>
<tr><td class="h"><a id="L316">316</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;timeexpire&#39;} &lt; $now</td></tr>
<tr><td class="h"><a id="L318">318</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($$sess{&#39;ipfixed&#39;} and not $OPT_IGNORE_IP)</td></tr>
<tr><td class="h"><a id="L320">320</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;ipfixed&#39;} ne $remote_ip</td></tr>
<tr><td class="h"><a id="L359">359</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $$sess{&#39;exptype&#39;} ne &#39;long&#39;</td></tr>
<tr><td class="h"><a id="L370">370</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($sess_length and $$sess{&#39;timeexpire&#39;} - $now &lt; $sess_length / 2 and $u-&gt;writer and $sess-&gt;_dbupdate(&#39;timeexpire&#39;, $new_expire))</td></tr>
<tr><td class="h"><a id="L385">385</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $dest</td></tr>
<tr><td class="h"><a id="L388">388</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($u)</td></tr>
<tr><td class="h"><a id="L393">393</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $domcook = &#39;LJ::Session&#39;-&gt;domain_cookie($dest)</td></tr>
<tr><td class="h"><a id="L396">396</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($dest =~ m[^(https?://)([^/]*?)\.\Q$LJ::USER_DOMAIN\E/?([^/]*)])</td></tr>
<tr><td class="h"><a id="L398">398</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($LJ::SUBDOMAIN_FUNCTION{lc $2} eq &#39;journal&#39;)</td></tr>
<tr><td class="h"><a id="L399">399</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $3 and $3 ne &#39;/&#39;</td></tr>
<tr><td class="h"><a id="L419">419</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $subdomain</td></tr>
<tr><td class="h"><a id="L422">422</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($user ne &#39;&#39;) { }</td></tr>
<tr><td class="h"><a id="L439">439</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $url =~ m[^https?://(.+?)(/.*)$]</td></tr>
<tr><td class="h"><a id="L445">445</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $host eq lc $LJ::DOMAIN_WEB or $host eq lc $LJ::DOMAIN</td></tr>
<tr><td class="h"><a id="L448">448</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $host =~ /^([\w-\.]{1,50})\.\Q$LJ::USER_DOMAIN\E$/</td></tr>
<tr><td class="h"><a id="L451">451</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($LJ::SUBDOMAIN_FUNCTION{$subdomain} eq &#39;journal&#39;)</td></tr>
<tr><td class="h"><a id="L452">452</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $path =~ m[^/(\w{1,15})\b]</td></tr>
<tr><td class="h"><a id="L454">454</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">wantarray ? :</td></tr>
<tr><td class="h"><a id="L458">458</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">wantarray ? :</td></tr>
<tr><td class="h"><a id="L465">465</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $user eq &#39;&#39;</td></tr>
<tr><td class="h"><a id="L476">476</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless eval {
	do {
	BML::get_request()
}
}</td></tr>
<tr><td class="h"><a id="L481">481</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($domain_cookie) { }</td></tr>
<tr><td class="h"><a id="L483">483</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&quot;${domain_cookie}[]&quot;}</td></tr>
<tr><td class="h"><a id="L486">486</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&#39;ljmastersession[]&#39;}</td></tr>
<tr><td class="h"><a id="L489">489</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless (@cookies)</td></tr>
<tr><td class="h"><a id="L490">490</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $BML::COOKIE{&#39;ljsession[]&#39;}</td></tr>
<tr><td class="h"><a id="L503">503</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">ref $_[0] ? :</td></tr>
<tr><td class="h"><a id="L507">507</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $li_cook</td></tr>
<tr><td class="h"><a id="L512">512</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($rr)</td></tr>
<tr><td class="h"><a id="L519">519</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless @cookies</td></tr>
<tr><td class="h"><a id="L525">525</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess</td></tr>
<tr><td class="h"><a id="L540">540</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">ref $_[0] ? :</td></tr>
<tr><td class="h"><a id="L542">542</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless @cookies</td></tr>
<tr><td class="h"><a id="L546">546</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">delete $$opts{&#39;ignore_ip&#39;} ? :</td></tr>
<tr><td class="h"><a id="L547">547</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">delete $$opts{&#39;old_cookie&#39;} ? :</td></tr>
<tr><td class="h"><a id="L550">550</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %$opts</td></tr>
<tr><td class="h"><a id="L575">575</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($var =~ /^(\w)(.+)$/ and $$dest{$1}) { }</td></tr>
<tr><td class="h"><a id="L583">583</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $flags =~ /\.FS\b/</td></tr>
<tr><td class="h"><a id="L585">585</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $bogus</td></tr>
<tr><td class="h"><a id="L587">587</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_cookie_generation($gen)</td></tr>
<tr><td class="h"><a id="L595">595</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($version == 1)</td></tr>
<tr><td class="h"><a id="L601">601</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($u)</td></tr>
<tr><td class="h"><a id="L607">607</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($u-&gt;is_locked)</td></tr>
<tr><td class="h"><a id="L614">614</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($sess)</td></tr>
<tr><td class="h"><a id="L619">619</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$sess{&#39;auth&#39;} eq $auth)</td></tr>
<tr><td class="h"><a id="L624">624</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($sess-&gt;valid)</td></tr>
<tr><td class="h"><a id="L630">630</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($old_cookie or $sess-&gt;loggedin_cookie_string eq $li_cook)</td></tr>
<tr><td class="h"><a id="L644">644</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">unless $u</td></tr>
<tr><td class="h"><a id="L646">646</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">unless my $udbh = LJ::get_cluster_master($u)</td></tr>
<tr><td class="h"><a id="L652">652</a></td><td class="c0">50</td><td class="c0">T</td><td class="c3">F</td><td class="s">if @$sessions</td></tr>
<tr><td class="h"><a id="L661">661</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $in</td></tr>
<tr><td class="h"><a id="L664">664</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $u-&gt;do(&quot;DELETE FROM $_ WHERE userid=? AND &quot; . &quot;sessid IN ($in)&quot;, undef, $userid)</td></tr>
<tr><td class="h"><a id="L679">679</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$LJ::ONLY_USER_VHOSTS ? :</td></tr>
<tr><td class="h"><a id="L697">697</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $exptype =~ /^short|long|once$/</td></tr>
<tr><td class="h"><a id="L713">713</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless BML::get_GET()</td></tr>
<tr><td class="h"><a id="L719">719</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_destination($dest)</td></tr>
<tr><td class="h"><a id="L720">720</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_domain_cookie($domcook, $cookie, $BML::COOKIE{&#39;ljloggedin&#39;})</td></tr>
<tr><td class="h"><a id="L726">726</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($dest =~ m[^https?://(.+?)(/.*)$])</td></tr>
<tr><td class="h"><a id="L730">730</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($host =~ /^([\w-\.]{1,50})\.\Q$LJ::USER_DOMAIN\E$/ and $subdomain = lc $1 and $LJ::SUBDOMAIN_FUNCTION{$subdomain} eq &#39;journal&#39; and $url_path =~ m[^/(\w{1,15})\b])</td></tr>
<tr><td class="h"><a id="L734">734</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $1</td></tr>
<tr><td class="h"><a id="L747">747</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($dest =~ m[^https?://.+?/.+?/] or $path eq &#39;/&#39;)</td></tr>
<tr><td class="h"><a id="L749">749</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $dest =~ s[\?][/?]</td></tr>
<tr><td class="h"><a id="L763">763</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">$args ? :</td></tr>
<tr><td class="h"><a id="L783">783</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if (@_ == 2) { }</td></tr>
<tr><td class="h"><a id="L798">798</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $r</td></tr>
<tr><td class="h"><a id="L805">805</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if %opts</td></tr>
<tr><td class="h"><a id="L808">808</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($http_only and not $LJ::DEBUG{&#39;no_mac_ie_httponly&#39;})</td></tr>
<tr><td class="h"><a id="L810">810</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $ua =~ /MSIE.+Mac_/</td></tr>
<tr><td class="h"><a id="L814">814</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires and $expires &lt;= 1135217120</td></tr>
<tr><td class="h"><a id="L816">816</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($delete)</td></tr>
<tr><td class="h"><a id="L819">819</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $delete</td></tr>
<tr><td class="h"><a id="L823">823</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires</td></tr>
<tr><td class="h"><a id="L824">824</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $domain</td></tr>
<tr><td class="h"><a id="L825">825</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $path</td></tr>
<tr><td class="h"><a id="L826">826</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $http_only</td></tr>
<tr><td class="h"><a id="L832">832</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($domain and scalar @labels == 2 and not $LJ::DEBUG{&#39;no_extra_dot_cookie&#39;})</td></tr>
<tr><td class="h"><a id="L834">834</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $expires</td></tr>
<tr><td class="h"><a id="L836">836</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $path</td></tr>
<tr><td class="h"><a id="L837">837</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $http_only</td></tr>
<tr><td class="h"><a id="L864">864</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if ($var =~ /^(\w)(.+)$/ and $$dest{$1}) { }</td></tr>
<tr><td class="h"><a id="L876">876</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $bogus</td></tr>
<tr><td class="h"><a id="L877">877</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless valid_cookie_generation($gen)</td></tr>
<tr><td class="h"><a id="L878">878</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $version != 1</td></tr>
<tr><td class="h"><a id="L882">882</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$opts{&#39;ignore_age&#39;})</td></tr>
<tr><td class="h"><a id="L884">884</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $time &gt; $now - 604800</td></tr>
<tr><td class="h"><a id="L887">887</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $u = LJ::load_userid($uid)</td></tr>
<tr><td class="h"><a id="L890">890</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless my $sess = $u-&gt;session($sessid)</td></tr>
<tr><td class="h"><a id="L894">894</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess-&gt;valid</td></tr>
<tr><td class="h"><a id="L897">897</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless ($$opts{&#39;ignore_li_cook&#39;})</td></tr>
<tr><td class="h"><a id="L899">899</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $sess_licook eq $li_cook</td></tr>
<tr><td class="h"><a id="L904">904</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">unless $correct_sig eq $sig</td></tr>
<tr><td class="h"><a id="L918">918</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $gen eq $okay</td></tr>
<tr><td class="h"><a id="L919">919</a></td><td class="c0">0</td><td class="c0">T</td><td class="c0">F</td><td class="s">if $dgen eq $okay</td></tr>
</table>
</body>
</html>
