<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 0.61
Devel::Cover is copyright 2001-2006, Paul Johnson (pjcj@cpan.org)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: cgi-bin/LJ/Error.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">cgi-bin/LJ/Error.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c0">43.1%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># class for passing around LiveJournal errors/warnings, both user-caused</td></tr>
<tr><td class="h">2</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># and system-caused</td></tr>
<tr><td class="h">3</td><td colspan="7"></td></tr><tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ::Error;</td></tr>
<tr><td class="h">5</td><td><div class="c3">80</div><div class="c3">80</div><div class="c3">80</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L5">80</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use strict;</td></tr>
<tr><td class="h">6</td><td><div class="c3">80</div><div class="c3">80</div><div class="c3">80</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L6">80</a></div></td><td></td><td><div>0</div><div>0</div><div>0</div></td><td class="s">use Carp qw(croak);</td></tr>
<tr><td class="h">7</td><td colspan="7"></td></tr><tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># helper function, aliased from LJ::errobj, but here so croak bypasses</td></tr>
<tr><td class="h">9</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># it, since it has to be in the same package or in an @ISA package</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># from the caller</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># Two ways to call:</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># As a shortcut for constructing a new error object:</td></tr>
<tr><td class="h">15</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#   - LJ::errobj(&quot;Userpic::TooManyWords&quot;, %opts)</td></tr>
<tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#   - LJ::errobj(&quot;BogusParams&quot;);</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># this is short for LJ::Error::Userpic::TooManyWords-&gt;new(%opts)</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># but also sets up @ISA on LJ::Error::Userpic::TooManyWords-</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">20</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># As a way to get an LJ::Error instance after an eval</td></tr>
<tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># that died:</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#   eval { LJ::scary(); }</td></tr>
<tr><td class="h">23</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#   if (my $err = LJ::errobj()) {  # or you can pass in errobj($@)</td></tr>
<tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      ....</td></tr>
<tr><td class="h">25</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#   }</td></tr>
<tr><td class="h">26</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">27</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns undef if $@ is undef,</td></tr>
<tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># returns LJ::Error object otherwise.  specific instance is:</td></tr>
<tr><td class="h">29</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">30</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      LJ::Error::DieString   -- for deaths with die &quot;Error message!&quot;;</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#          $ljerr-&gt;die_string -- to get the string</td></tr>
<tr><td class="h">32</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      LJ::Error::DieObject   -- for deaths w/ Exception.pm/etc</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#          $ljerr-&gt;die_object -- to get the object</td></tr>
<tr><td class="h">34</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      LJ::Error::*           -- if $@ isa LJ::Error, returns $@ unmodified</td></tr>
<tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#      LJ::Error::Database::Failure -- if given a $dbh/$u after a failure,</td></tr>
<tr><td class="h">36</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#                                      will get the errstr/errmsg</td></tr>
<tr><td class="h">37</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub errobj {</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# constructing a new LJ::Error instance.  either with a classname</td></tr>
<tr><td class="h">40</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# and args, or just a classname (no whitespace, must have one capital letter)</td></tr>
<tr><td class="h">41</td><td><div class="c3">17</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L41">100</a></div></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L41">50</a></div></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L41">17</a></div></td><td><div class="c0">0</div></td><td><div>4000</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_ &gt; 0 &amp;&amp; (@_ &gt; 1 || ($_[0] !~ /\s/ &amp;&amp; $_[0] =~ /[A-Z]/ &amp;&amp; $_[0] !~ /[^:\w]/))) {</td></tr>
<tr><td class="h">42</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ($classtail, @ctor_args) = @_;</td></tr>
<tr><td class="h">43</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $class = &quot;LJ::Error::$classtail&quot;;</td></tr>
<tr><td class="h">44</td><td><div class="c3">13</div><div class="c3">21</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L44">21</a></div></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $makeit = sub { $class-&gt;new(@ctor_args); };</td></tr>
<tr><td class="h">45</td><td><div class="c3">13</div><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $val = eval { $makeit-&gt;(); };</td></tr>
<tr><td class="h">46</td><td><div class="c3">13</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L46">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($@ =~ /^Can\&#39;t locate object method &quot;new&quot; via package &quot;(LJ::Error::\S+?)&quot;/) {</td></tr>
<tr><td class="h">47</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $class = $1;</td></tr>
<tr><td class="h">48</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $code = &quot;\@${class}::ISA = (&#39;LJ::Error&#39;); 1;&quot;;</td></tr>
<tr><td class="h">49</td><td><div class="c3">7</div></td><td><div class="c0" title="-/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L49">50</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval $code or die &quot;Failed to set ISA: [$@] for code: [$code]\n&quot;;</td></tr>
<tr><td class="h">50</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">51</td><td><div class="c3">13</div></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L51">67</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return $val || $makeit-&gt;();</td></tr>
<tr><td class="h">52</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">53</td><td colspan="7"></td></tr><tr><td class="h">54</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# if no parameters, act like errobj($@)</td></tr>
<tr><td class="h">55</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L55">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;unless (@_) {</td></tr>
<tr><td class="h">56</td><td><div class="c3">1</div></td><td><div class="c0" title="-/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L56">50</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_[0] = $@</td></tr>
<tr><td class="h">57</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or return undef;</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">59</td><td colspan="7"></td></tr><tr><td class="h">60</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ref = ref $_[0];</td></tr>
<tr><td class="h">61</td><td colspan="7"></td></tr><tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# wrapping a database (or database-like) handle</td></tr>
<tr><td class="h">63</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L63">100</a></div></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L63">67</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (LJ::isdb($_[0]) || $ref eq &quot;LJ::User&quot;) {</td></tr>
<tr><td class="h">64</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return errobj(&quot;Database::Failure&quot;, db =&gt; $_[0]);</td></tr>
<tr><td class="h">65</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">66</td><td colspan="7"></td></tr><tr><td class="h">67</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# wrapping return of an error object</td></tr>
<tr><td class="h">68</td><td><div class="c3">3</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L68">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return errobj(&quot;DieString&quot;, message =&gt; $_[0]) unless $ref;</td></tr>
<tr><td class="h">69</td><td colspan="7"></td></tr><tr><td class="h">70</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# wrapping an LJ::Error object, returning it unchanged</td></tr>
<tr><td class="h">71</td><td><div class="c3">2</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L71">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $_[0] if $ref =~ /^LJ::Error/;  # should use -&gt;isa, but then have to catch it on HASH, etc</td></tr>
<tr><td class="h">72</td><td colspan="7"></td></tr><tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# else it&#39;s a reference, but not one of ours, so we wrap it</td></tr>
<tr><td class="h">74</td><td><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return errobj(&quot;DieObject&quot;, object =&gt; $_[0]);</td></tr>
<tr><td class="h">75</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">76</td><td colspan="7"></td></tr><tr><td class="h">77</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># don&#39;t override this!</td></tr>
<tr><td class="h">78</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub new {</td></tr>
<tr><td class="h">79</td><td><div class="c3">14</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L79">14</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $class = shift;</td></tr>
<tr><td class="h">80</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %opts  = @_;</td></tr>
<tr><td class="h">81</td><td colspan="7"></td></tr><tr><td class="h">82</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($line, $file);</td></tr>
<tr><td class="h">83</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = {</td></tr>
<tr><td class="h">84</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_line =&gt; $line,</td></tr>
<tr><td class="h">85</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_file =&gt; $file,</td></tr>
<tr><td class="h">86</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">87</td><td colspan="7"></td></tr><tr><td class="h">88</td><td><div class="c3">14</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $f ($class-&gt;fields) {</td></tr>
<tr><td class="h">89</td><td><div class="c3">10</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L89">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak(&quot;Missing field in $class ctor: &#39;$f&#39;&quot;)</td></tr>
<tr><td class="h">90</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unless exists $opts{$f};</td></tr>
<tr><td class="h">91</td><td><div class="c3">9</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{$f} = delete $opts{$f};</td></tr>
<tr><td class="h">92</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">93</td><td><div class="c3">13</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $f ($class-&gt;opt_fields) {</td></tr>
<tr><td class="h">94</td><td><div class="c3">10</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;{$f} = delete $opts{$f};</td></tr>
<tr><td class="h">95</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">96</td><td colspan="7"></td></tr><tr><td class="h">97</td><td><div class="c3">13</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L97">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (%opts) {</td></tr>
<tr><td class="h">98</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak(&quot;Unknown fields in $class ctor: &quot; . join(&quot;, &quot;, keys %opts));</td></tr>
<tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">100</td><td colspan="7"></td></tr><tr><td class="h">101</td><td><div class="c3">11</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return bless $self, $class;</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">103</td><td colspan="7"></td></tr><tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># don&#39;t override.</td></tr>
<tr><td class="h">105</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub field {</td></tr>
<tr><td class="h">106</td><td><div class="c3">8</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L106">8</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ($self, $field) = @_;</td></tr>
<tr><td class="h">107</td><td><div class="c3">8</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L107">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;croak(&quot;Invalid field for object &quot; . ref $self) unless</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists $self-&gt;{$field};</td></tr>
<tr><td class="h">109</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{$field};</td></tr>
<tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">111</td><td colspan="7"></td></tr><tr><td class="h">112</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># don&#39;t override.  also aliased from LJ::throw(@throw).  or an instance method.</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub throw {</td></tr>
<tr><td class="h">114</td><td><div class="c3">17</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L114">100</a></div></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L114">17</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless @_;</td></tr>
<tr><td class="h">115</td><td colspan="7"></td></tr><tr><td class="h">116</td><td><div class="c3">2</div></td><td><div class="c0" title="T/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L116">50</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (@_ == 1) {</td></tr>
<tr><td class="h">117</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">118</td><td><div class="c3">2</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;croak $self;</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">120</td><td colspan="7"></td></tr><tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# throw multiple errors as one</td></tr>
<tr><td class="h">122</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @errors = @_;</td></tr>
<tr><td class="h">123</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;LJ::errobj(&quot;Multiple&quot;, errors =&gt; \@errors)-&gt;throw;</td></tr>
<tr><td class="h">124</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">125</td><td colspan="7"></td></tr><tr><td class="h">126</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># throws self, if $LJ::THROW_ERRORS is dynamically set w/ local,</td></tr>
<tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># else returns undef (by default), or the value passed to it</td></tr>
<tr><td class="h">128</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub cond_throw {</td></tr>
<tr><td class="h">129</td><td><div class="c3">4</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L129">4</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">130</td><td><div class="c3">4</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ret_value = shift;</td></tr>
<tr><td class="h">131</td><td><div class="c3">4</div></td><td><div class="c3" title="T/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L131">100</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;throw if $LJ::THROW_ERRORS;</td></tr>
<tr><td class="h">132</td><td><div class="c3">2</div></td><td><div class="c0" title="-/F"><a href="cgi-bin-LJ-Error-pm--branch.html#L132">50</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return defined $ret_value ? $ret_value : undef;</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">134</td><td colspan="7"></td></tr><tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># log error to database; don&#39;t override</td></tr>
<tr><td class="h">136</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub log {</td></tr>
<tr><td class="h">137</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L137">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $err = shift;</td></tr>
<tr><td class="h">138</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L138">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return unless $LJ::LOG_ERRORS;</td></tr>
<tr><td class="h">139</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L139">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $err-&gt;{_logged}++;</td></tr>
<tr><td class="h">140</td><td colspan="7"></td></tr><tr><td class="h">141</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L141">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $dbl = LJ::get_dbh(&quot;logs&quot;) or return;</td></tr>
<tr><td class="h">142</td><td colspan="7"></td></tr><tr><td class="h">143</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $now = time;</td></tr>
<tr><td class="h">144</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @now = localtime($now);</td></tr>
<tr><td class="h">145</td><td colspan="7"></td></tr><tr><td class="h">146</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $table_name = sprintf(&quot;errors%04d%02d%02d%02d&quot;, $now[5]+1900,</td></tr>
<tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$now[4]+1, $now[3], $now[2]);</td></tr>
<tr><td class="h">148</td><td colspan="7"></td></tr><tr><td class="h">149</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $create_sql = qq {</td></tr>
<tr><td class="h">150</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</td></tr>
<tr><td class="h">151</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whn INT (10) UNSIGNED NOT NULL,</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;description VARCHAR(255),</td></tr>
<tr><td class="h">153</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errclass VARCHAR(255),</td></tr>
<tr><td class="h">154</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usercaused TINYINT,</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server VARCHAR(30),</td></tr>
<tr><td class="h">156</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr VARCHAR(15) NOT NULL,</td></tr>
<tr><td class="h">157</td><td colspan="7"></td></tr><tr><td class="h">158</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote VARCHAR(15),</td></tr>
<tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remoteid INT UNSIGNED, # remote user&#39;s userid</td></tr>
<tr><td class="h">160</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remotecaps INT UNSIGNED,</td></tr>
<tr><td class="h">161</td><td colspan="7"></td></tr><tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;journalid INT UNSIGNED, # userid of what&#39;s being looked at</td></tr>
<tr><td class="h">163</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;journaltype CHAR(1),   # journalid&#39;s journaltype</td></tr>
<tr><td class="h">164</td><td colspan="7"></td></tr><tr><td class="h">165</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codepath VARCHAR(80),  # protocol.getevents / s[12].friends / bml.update / bml.friends.index</td></tr>
<tr><td class="h">166</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;langpref VARCHAR(5),</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method VARCHAR(10) NOT NULL,</td></tr>
<tr><td class="h">168</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri VARCHAR(255) NOT NULL,</td></tr>
<tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;args VARCHAR(255),</td></tr>
<tr><td class="h">170</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ref VARCHAR(255),</td></tr>
<tr><td class="h">171</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;browser VARCHAR(100),</td></tr>
<tr><td class="h">172</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clientver VARCHAR(100)</td></tr>
<tr><td class="h">173</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">175</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$create_sql =~ s/\#.+//g;</td></tr>
<tr><td class="h">176</td><td colspan="7"></td></tr><tr><td class="h">177</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L177">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$dbl-&gt;do(&quot;CREATE TABLE IF NOT EXISTS $table_name $create_sql&quot;) or return;</td></tr>
<tr><td class="h">178</td><td colspan="7"></td></tr><tr><td class="h">179</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $whn = time();</td></tr>
<tr><td class="h">180</td><td colspan="7"></td></tr><tr><td class="h">181</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L181">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %insert = (</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;whn&#39;         =&gt; $whn,</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;description&#39; =&gt; $err-&gt;as_string || $err-&gt;as_html,</td></tr>
<tr><td class="h">184</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;errclass&#39;    =&gt; ref $err,</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;server&#39;      =&gt; $LJ::SERVER_NAME,</td></tr>
<tr><td class="h">186</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;usercaused&#39;  =&gt; $err-&gt;user_caused, # 0, 1 or NULL</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">188</td><td colspan="7"></td></tr><tr><td class="h">189</td><td><div class="c0">0</div><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L189">0</a></div></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if (my $r = eval {BML::get_request()}) {</td></tr>
<tr><td class="h">190</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $rl = $r-&gt;last;</td></tr>
<tr><td class="h">191</td><td colspan="7"></td></tr><tr><td class="h">192</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remote = eval { LJ::load_user($rl-&gt;notes(&#39;ljuser&#39;)) };</td></tr>
<tr><td class="h">193</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L193">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remotecaps = $remote ? $remote-&gt;{caps} : undef;</td></tr>
<tr><td class="h">194</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L194">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $remoteid   = $remote ? $remote-&gt;{userid} : 0;</td></tr>
<tr><td class="h">195</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $ju = eval { LJ::load_userid($rl-&gt;notes(&#39;journalid&#39;)) };</td></tr>
<tr><td class="h">196</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $uri = $r-&gt;uri;</td></tr>
<tr><td class="h">197</td><td colspan="7"></td></tr><tr><td class="h">198</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L198">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %insert_r = (</td></tr>
<tr><td class="h">199</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;addr&#39;        =&gt; $r-&gt;connection-&gt;remote_ip,</td></tr>
<tr><td class="h">200</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;remote&#39;      =&gt; $rl-&gt;notes(&#39;ljuser&#39;),</td></tr>
<tr><td class="h">201</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;remotecaps&#39;  =&gt; $remotecaps,</td></tr>
<tr><td class="h">202</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;remoteid&#39;    =&gt; $remoteid,</td></tr>
<tr><td class="h">203</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;journalid&#39;   =&gt; $rl-&gt;notes(&#39;journalid&#39;),</td></tr>
<tr><td class="h">204</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;journaltype&#39; =&gt; $ju ? $ju-&gt;{journaltype} : &quot;&quot;,</td></tr>
<tr><td class="h">205</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;codepath&#39;    =&gt; $rl-&gt;notes(&#39;codepath&#39;),</td></tr>
<tr><td class="h">206</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;langpref&#39;    =&gt; $rl-&gt;notes(&#39;langpref&#39;),</td></tr>
<tr><td class="h">207</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;clientver&#39;   =&gt; $rl-&gt;notes(&#39;clientver&#39;),</td></tr>
<tr><td class="h">208</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;method&#39;      =&gt; $r-&gt;method,</td></tr>
<tr><td class="h">209</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;uri&#39;         =&gt; $uri,</td></tr>
<tr><td class="h">210</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;args&#39;        =&gt; scalar $r-&gt;args,</td></tr>
<tr><td class="h">211</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;browser&#39;     =&gt; $r-&gt;header_in(&quot;User-Agent&quot;),</td></tr>
<tr><td class="h">212</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;ref&#39;         =&gt; $r-&gt;header_in(&quot;Referer&quot;),</td></tr>
<tr><td class="h">213</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">214</td><td colspan="7"></td></tr><tr><td class="h">215</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ( my ($k,$v) = each %insert_r ) {</td></tr>
<tr><td class="h">216</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$insert{$k} = $v;</td></tr>
<tr><td class="h">217</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">218</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">219</td><td colspan="7"></td></tr><tr><td class="h">220</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L220">0</a></div></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $delayed = $LJ::IMMEDIATE_LOGGING ? &quot;&quot; : &quot;DELAYED&quot;;</td></tr>
<tr><td class="h">221</td><td colspan="7"></td></tr><tr><td class="h">222</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $ins = sub {</td></tr>
<tr><td class="h">223</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $insert_sql = &quot;INSERT $delayed INTO $table_name (&quot; . join(&quot;, &quot;, keys %insert) . &quot;) VALUES (&quot; .</td></tr>
<tr><td class="h">224</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L224">0</a></div></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join(&quot;,&quot;, map { &quot;?&quot; } values %insert) . &quot;)&quot;;</td></tr>
<tr><td class="h">225</td><td colspan="7"></td></tr><tr><td class="h">226</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$dbl-&gt;do($insert_sql, undef, values %insert);</td></tr>
<tr><td class="h">227</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;};</td></tr>
<tr><td class="h">228</td><td colspan="7"></td></tr><tr><td class="h">229</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# insert time!</td></tr>
<tr><td class="h">230</td><td colspan="7"></td></tr><tr><td class="h">231</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# support for widening the schema at runtime.  if we detect a bogus column,</td></tr>
<tr><td class="h">232</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we just don&#39;t log that column until the next (wider) table is made at next</td></tr>
<tr><td class="h">233</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# hour boundary.</td></tr>
<tr><td class="h">234</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ins-&gt;();</td></tr>
<tr><td class="h">235</td><td><div class="c0">0</div></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L235">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ($dbl-&gt;err &amp;&amp; $dbl-&gt;errstr =~ /Unknown column \&#39;(\w+)/) {</td></tr>
<tr><td class="h">236</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $col = $1;</td></tr>
<tr><td class="h">237</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete $insert{$col};</td></tr>
<tr><td class="h">238</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ins-&gt;();</td></tr>
<tr><td class="h">239</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">240</td><td colspan="7"></td></tr><tr><td class="h">241</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L241">0</a></div></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--condition.html#L241">0</a></div></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$dbl-&gt;disconnect if $LJ::DISCONNECT_DB_LOG &amp;&amp; LJ::use_diff_db(&quot;master&quot;, &quot;logs&quot;);</td></tr>
<tr><td class="h">242</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">243</td><td colspan="7"></td></tr><tr><td class="h">244</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># override this: whether it was user-defined.  should return 0 or 1.</td></tr>
<tr><td class="h">245</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L245">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub user_caused { undef }</td></tr>
<tr><td class="h">246</td><td colspan="7"></td></tr><tr><td class="h">247</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># override this: return list of required fields</td></tr>
<tr><td class="h">248</td><td><div class="c3">6</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L248">6</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub fields { (); }</td></tr>
<tr><td class="h">249</td><td colspan="7"></td></tr><tr><td class="h">250</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># override this: return list of optional fields</td></tr>
<tr><td class="h">251</td><td><div class="c3">7</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L251">7</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub opt_fields { (); }</td></tr>
<tr><td class="h">252</td><td colspan="7"></td></tr><tr><td class="h">253</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># you may override this</td></tr>
<tr><td class="h">254</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_html {</td></tr>
<tr><td class="h">255</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L255">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">256</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;as_string;</td></tr>
<tr><td class="h">257</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">258</td><td colspan="7"></td></tr><tr><td class="h">259</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_bullets {</td></tr>
<tr><td class="h">260</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L260">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">261</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return &quot;&lt;li&gt;&quot; . $self-&gt;as_html . &quot;&lt;/li&gt;\n&quot;;</td></tr>
<tr><td class="h">262</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">263</td><td colspan="7"></td></tr><tr><td class="h">264</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># override this</td></tr>
<tr><td class="h">265</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_string {</td></tr>
<tr><td class="h">266</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L266">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">267</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# FIXME: show line/file/function, show some fields?  maybe?  that are simple values?</td></tr>
<tr><td class="h">268</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">269</td><td colspan="7"></td></tr><tr><td class="h">270</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># automatic type returned when something dies with just a string</td></tr>
<tr><td class="h">271</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ::Error::DieString;</td></tr>
<tr><td class="h">272</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L272">2</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub fields { qw(message) }</td></tr>
<tr><td class="h">273</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L273">2</a></div></td><td></td><td><div>4000</div></td><td class="s">sub die_string { return $_[0]-&gt;field(&#39;message&#39;); }</td></tr>
<tr><td class="h">274</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L274">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub as_string { return $_[0]-&gt;field(&#39;message&#39;); }</td></tr>
<tr><td class="h">275</td><td colspan="7"></td></tr><tr><td class="h">276</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_html {</td></tr>
<tr><td class="h">277</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L277">0</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">278</td><td colspan="7"></td></tr><tr><td class="h">279</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# these errors (exclusively?) come from trusted pages</td></tr>
<tr><td class="h">280</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# which generate their content... don&#39;t ehtml because</td></tr>
<tr><td class="h">281</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# we often die with translation strings, etc which</td></tr>
<tr><td class="h">282</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# contain markup</td></tr>
<tr><td class="h">283</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#</td></tr>
<tr><td class="h">284</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# -- this solution sucks, but I&#39;m not sure how to do it</td></tr>
<tr><td class="h">285</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#    better, and a less-than-perfect API is better than</td></tr>
<tr><td class="h">286</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;#    having broken output all over.  :-/</td></tr>
<tr><td class="h">287</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;die_string;</td></tr>
<tr><td class="h">288</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">289</td><td colspan="7"></td></tr><tr><td class="h">290</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># automatic type returned when something dies with a reference, but not</td></tr>
<tr><td class="h">291</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># an LJ::Error</td></tr>
<tr><td class="h">292</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ::Error::DieObject;</td></tr>
<tr><td class="h">293</td><td><div class="c3">1</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L293">1</a></div></td><td><div class="c0">0</div></td><td><div>0</div></td><td class="s">sub fields { qw(object) }</td></tr>
<tr><td class="h">294</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L294">2</a></div></td><td></td><td><div>4000</div></td><td class="s">sub die_object { return $_[0]-&gt;field(&#39;object&#39;); }</td></tr>
<tr><td class="h">295</td><td colspan="7"></td></tr><tr><td class="h">296</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ::Error::Multiple;</td></tr>
<tr><td class="h">297</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L297">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">sub fields { qw(errors); }  # arrayref of errors</td></tr>
<tr><td class="h">298</td><td colspan="7"></td></tr><tr><td class="h">299</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_bullets {</td></tr>
<tr><td class="h">300</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L300">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">301</td><td><div class="c0">0</div><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return join(&#39;&#39;, map { $_-&gt;as_bullets } @{ $self-&gt;{errors} });</td></tr>
<tr><td class="h">302</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">303</td><td colspan="7"></td></tr><tr><td class="h">304</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub log {</td></tr>
<tr><td class="h">305</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L305">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">306</td><td><div class="c0">0</div></td><td><div class="c0" title="-/-"><a href="cgi-bin-LJ-Error-pm--branch.html#L306">0</a></div></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return if $self-&gt;{_logged}++;</td></tr>
<tr><td class="h">307</td><td><div class="c0">0</div><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;foreach my $suberr (@{ $self-&gt;{errors} }) {</td></tr>
<tr><td class="h">308</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$suberr-&gt;log;</td></tr>
<tr><td class="h">309</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">310</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">311</td><td colspan="7"></td></tr><tr><td class="h">312</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package LJ::Error::WithSubError;</td></tr>
<tr><td class="h">313</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L313">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">sub fields { qw(main suberr); }</td></tr>
<tr><td class="h">314</td><td colspan="7"></td></tr><tr><td class="h">315</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_bullets {</td></tr>
<tr><td class="h">316</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L316">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">317</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{main}-&gt;as_bullets . &quot;&lt;ul&gt;&quot; . $self-&gt;{suberr}-&gt;as_bullets . &quot;&lt;/ul&gt;&quot;;</td></tr>
<tr><td class="h">318</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">319</td><td colspan="7"></td></tr><tr><td class="h">320</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub as_string {</td></tr>
<tr><td class="h">321</td><td><div class="c0">0</div></td><td></td><td></td><td><div class="c0"><a href="cgi-bin-LJ-Error-pm--subroutine.html#L321">0</a></div></td><td><div class="c0">0</div></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $self = shift;</td></tr>
<tr><td class="h">322</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;{main}-&gt;as_string . &quot;, due to: &quot; . $self-&gt;{suberr}-&gt;as_string;</td></tr>
<tr><td class="h">323</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">324</td><td colspan="7"></td></tr><tr><td class="h">325</td><td colspan="7"></td></tr><tr><td class="h">326</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
